<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÏÑ∏Í∑†Ï†Ñ Í¥ÄÏÑ∏Ï†ÑÏüÅ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 10px;
            background-color: #f4f4f4;
        }
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            width: 100%;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        @media (min-width: 768px) {
            .game-container {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }
        .board-wrapper {
            width: 100%;
            max-width: 600px;
            overflow-x: auto;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            margin: 0 auto;
        }
        .board {
            display: grid;
            gap: 2px;
            background-color: #ccc;
            padding: 5px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin: 0 auto;
            min-width: min-content;
        }
        .cell {
            width: 40px;
            height: 40px;
            background-color: #fff;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        @media (min-width: 576px) {
            .cell {
                width: 45px;
                height: 45px;
            }
        }
        @media (min-width: 768px) {
            .cell {
                width: 50px;
                height: 50px;
            }
        }
        .cell:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }
        .usa {
            background-color: #3c3b6e;
            border-radius: 50%;
            position: relative;
        }
        .usa::after {
            content: "USA";
            position: absolute;
            color: white;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .china {
            background-color: #de2910;
            position: relative;
        }
        .china::after {
           content: "‚òÖ";
           position: absolute;
           color: #ffde00;
           font-size: 24px;
        }
        /* ÏÉàÎ°úÏö¥ ÌîåÎ†àÏù¥Ïñ¥ Ïä§ÌÉÄÏùº: ROW */
        .row {
            background-color: #607D8B;
            position: relative;
            border-radius: 5px;
        }
        .row::after {
            content: "üåç";
            position: absolute;
            font-size: 20px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        /* ÏÉàÎ°úÏö¥ ÌîåÎ†àÏù¥Ïñ¥ Ïä§ÌÉÄÏùº: WTO */
        .wto {
            background-color: #2196F3;
            position: relative;
            border-radius: 5px;
        }
        .wto::after {
            content: "WTO";
            position: absolute;
            color: white;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        /* ÏÉàÎ°úÏö¥ ÌîåÎ†àÏù¥Ïñ¥ Ïä§ÌÉÄÏùº: IMF */
        .imf {
            background-color: #9C27B0;
            position: relative;
            border-radius: 5px;
        }
        .imf::after {
            content: "$";
            position: absolute;
            color: white;
            font-size: 20px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .wall {
            background-color: #555;
            position: relative;
        }
        .wall::before {
            content: "";
            position: absolute;
            width: 70%;
            height: 70%;
            background-color: #333;
            top: 15%;
            left: 15%;
        }
        .visited {
            background-color: #f0f0f0;
            position: relative;
            pointer-events: none;
        }
        .visited::after {
            content: "X";
            color: #999;
            font-size: 18px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
         .panel {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 250px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .wall {
            background-color: #555;
            position: relative;
        }
        .wall::before {
            content: "";
            position: absolute;
            width: 70%;
            height: 70%;
            background-color: #333;
            top: 15%;
            left: 15%;
        }
        .visited {
            background-color: #f0f0f0;
            position: relative;
            pointer-events: none;
        }
        .visited::after {
            content: "X";
            color: #999;
            font-size: 18px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
         .panel {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 250px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover:not(:disabled) {
            background-color: #45a049;
            transform: scale(1.05);
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        #message {
            margin: 10px 0;
            min-height: 20px;
            color: #d9534f;
        }
        #gameRules {
            margin-top: 20px;
            text-align: left;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        .lastMove {
            box-shadow: inset 0 0 0 3px yellow;
        }
        #turnCounter {
            font-weight: bold;
            color: #333;
            margin-top: 10px;
        }
        .map-selection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .map-option {
            width: 120px;
            height: 100px;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 5px;
        }
        .map-option:hover {
            border-color: #4CAF50;
            transform: scale(1.05);
        }
        .map-option.selected {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        .map-preview {
            width: 100px;
            height: 70px;
            margin-bottom: 5px;
            background-color: #ccc;
            position: relative;
        }
        .map-preview-5x5 {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="white" stroke="gray" stroke-width="1"/><line x1="5" y1="17" x2="95" y2="17" stroke="gray" stroke-width="1"/><line x1="5" y1="29" x2="95" y2="29" stroke="gray" stroke-width="1"/><line x1="5" y1="41" x2="95" y2="41" stroke="gray" stroke-width="1"/><line x1="5" y1="53" x2="95" y2="53" stroke="gray" stroke-width="1"/><line x1="23" y1="5" x2="23" y2="65" stroke="gray" stroke-width="1"/><line x1="41" y1="5" x2="41" y2="65" stroke="gray" stroke-width="1"/><line x1="59" y1="5" x2="59" y2="65" stroke="gray" stroke-width="1"/><line x1="77" y1="5" x2="77" y2="65" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-8x8 {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="white" stroke="gray" stroke-width="1"/><line x1="5" y1="12.5" x2="95" y2="12.5" stroke="gray" stroke-width="1"/><line x1="5" y1="20" x2="95" y2="20" stroke="gray" stroke-width="1"/><line x1="5" y1="27.5" x2="95" y2="27.5" stroke="gray" stroke-width="1"/><line x1="5" y1="35" x2="95" y2="35" stroke="gray" stroke-width="1"/><line x1="5" y1="42.5" x2="95" y2="42.5" stroke="gray" stroke-width="1"/><line x1="5" y1="50" x2="95" y2="50" stroke="gray" stroke-width="1"/><line x1="5" y1="57.5" x2="95" y2="57.5" stroke="gray" stroke-width="1"/><line x1="16.25" y1="5" x2="16.25" y2="65" stroke="gray" stroke-width="1"/><line x1="27.5" y1="5" x2="27.5" y2="65" stroke="gray" stroke-width="1"/><line x1="38.75" y1="5" x2="38.75" y2="65" stroke="gray" stroke-width="1"/><line x1="50" y1="5" x2="50" y2="65" stroke="gray" stroke-width="1"/><line x1="61.25" y1="5" x2="61.25" y2="65" stroke="gray" stroke-width="1"/><line x1="72.5" y1="5" x2="72.5" y2="65" stroke="gray" stroke-width="1"/><line x1="83.75" y1="5" x2="83.75" y2="65" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-usa {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><path d="M10,10 L90,10 L90,20 L80,20 L80,30 L70,30 L70,40 L80,40 L80,50 L70,50 L70,60 L10,60 Z" fill="white" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-china {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><path d="M30,10 L70,10 C85,10 90,30 90,40 C90,50 85,60 70,60 L30,60 C15,60 10,50 10,40 C10,30 15,10 30,10 Z" fill="white" stroke="gray" stroke-width="1"/></svg>');
        }
      /* ÏÉàÎ°úÏö¥ Îßµ ÎØ∏Î¶¨Î≥¥Í∏∞ */
        .map-preview-trident {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><path d="M40,5 L60,5 L60,25 L80,25 L80,45 L60,45 L60,65 L40,65 L40,45 L20,45 L20,25 L40,25 Z" fill="white" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-pacific {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="lightblue" stroke="gray" stroke-width="1"/><path d="M5,5 L20,10 L25,25 L15,35 L5,35 Z" fill="white" stroke="gray" stroke-width="1"/><path d="M70,5 L95,5 L95,20 L85,25 L75,20 L70,10 Z" fill="white" stroke="gray" stroke-width="1"/><path d="M5,45 L15,50 L15,65 L5,65 Z" fill="white" stroke="gray" stroke-width="1"/><path d="M75,50 L85,45 L95,45 L95,60 L80,65 L70,60 Z" fill="white" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-island {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="lightblue" stroke="gray" stroke-width="1"/><circle cx="50" cy="35" r="20" fill="white" stroke="gray" stroke-width="1"/><circle cx="15" cy="15" r="8" fill="white" stroke="gray" stroke-width="1"/><circle cx="85" cy="15" r="8" fill="white" stroke="gray" stroke-width="1"/><circle cx="15" cy="55" r="8" fill="white" stroke="gray" stroke-width="1"/><circle cx="85" cy="55" r="8" fill="white" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-maze {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="white" stroke="gray" stroke-width="1"/><path d="M20,5 L20,20 L35,20 L35,35 L20,35 L20,50 L35,50 L35,65 M50,5 L50,20 L65,20 L65,35 L50,35 L50,50 L65,50 L65,65 M80,5 L80,65" stroke="gray" stroke-width="2" fill="none" /></svg>');
        }
        /* Ïö∞Ï£º Ï†ïÍ±∞Ïû• Îßµ ÎØ∏Î¶¨Î≥¥Í∏∞ */
        .map-preview-spacestation {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="black" stroke="gray" stroke-width="1"/><path d="M50,15 L50,55 M30,35 L70,35" stroke="gray" stroke-width="10" fill="none"/><circle cx="50" cy="35" r="8" fill="white" stroke="gray" stroke-width="1"/><rect x="40" y="25" width="20" height="20" fill="gray" stroke="white" stroke-width="1"/></svg>');
        }
        .hidden-cell {
             background-color: #b0c4de; /* Ïó∞Ìïú Ï≤≠ÌöåÏÉâ(Light Steel Blue) */
             border: 1px solid #a0b0c0;
             visibility: visible; /* Î≥¥Ïù¥Í≤å ÏÑ§Ï†ï */
        }
        /* Ïö∞Ï£º Ï†ïÍ±∞Ïû• Îßµ Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        .space-station-bg .hidden-cell {
            background-color: #000000 !important;
            border-color: #000000 !important;
        }
        .mode-option {
            width: 200px;
            height: 150px;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 15px;
            margin: 10px;
            background-color: white;
        }
        .mode-option:hover {
            border-color: #4CAF50;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .mode-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        .mode-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .mode-desc {
            font-size: 14px;
            color: #666;
        }
        /* Îã§Ï§ë Î™®Îìú Í¥ÄÎ†® ÏÉàÎ°úÏö¥ Ïä§ÌÉÄÏùº */
        /* Îã§Ï§ë Î™®Îìú Îßµ ÏÑ†ÌÉù Ïª®ÌÖåÏù¥ÎÑà */
        .multi-map-selection {
          display: flex;
          flex-direction: row; /* Í∞ÄÎ°úÎ°ú Î∞∞Ïπò */
          justify-content: flex-start; /* Ï¢åÏ∏° Ï†ïÎ†¨ */
          align-items: center; /* ÏÑ∏Î°ú Ï§ëÏïô Ï†ïÎ†¨ */
          gap: 10px; /* ÏöîÏÜå Í∞Ñ Í∞ÑÍ≤© */
          margin: 20px 0;
          padding: 10px;
          overflow-x: auto; /* Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§ ÌôúÏÑ±Ìôî */
          width: 100%; /* Ïª®ÌÖåÏù¥ÎÑà ÎÑàÎπÑÎ•º Î∂ÄÎ™®Ïóê ÎßûÏ∂§ */
          box-sizing: border-box;
          white-space: nowrap; /* Ï§ÑÎ∞îÍøà Î∞©ÏßÄ */
        }

        /* Í∞Å Îßµ ÏòµÏÖò Ïä§ÌÉÄÏùº - Í∏∞Î≥∏ (Î™®Î∞îÏùº) */
        .multi-map-option {
          flex: 0 0 auto; /* ÌÅ¨Í∏∞ Í≥†Ï†ï */
          width: 90px; /* Î™®Î∞îÏùºÏóêÏÑú Îçî ÏûëÏùÄ ÎÑàÎπÑ */
          height: 80px; /* Î™®Î∞îÏùºÏóêÏÑú Îçî ÏûëÏùÄ ÎÜíÏù¥ */
          border: 2px solid #ccc;
          border-radius: 5px;
          cursor: pointer;
          display: inline-flex; /* inline-flexÎ°ú Î≥ÄÍ≤Ω */
          flex-direction: column;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
          padding: 5px;
          box-sizing: border-box;
        }

        .multi-map-option:hover {
          border-color: #4CAF50;
          transform: scale(1.05);
        }

        .multi-map-option.selected {
          border-color: #4CAF50;
          background-color: rgba(76, 175, 80, 0.1);
        }
        /* Îßµ ÎØ∏Î¶¨Î≥¥Í∏∞ Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ - Í∏∞Î≥∏ (Î™®Î∞îÏùº) */
        .multi-map-preview {
          width: 70px; /* Î™®Î∞îÏùºÏóêÏÑú Îçî ÏûëÏùÄ ÎØ∏Î¶¨Î≥¥Í∏∞ */
          height: 50px; /* Î™®Î∞îÏùºÏóêÏÑú Îçî ÏûëÏùÄ ÎÜíÏù¥ */
          margin-bottom: 5px;
          background-color: #f0f0f0;
          border-radius: 4px;
        }

        /* Îßµ Ïù¥Î¶Ñ ÌÖçÏä§Ìä∏ Ïä§ÌÉÄÏùº - Í∏∞Î≥∏ (Î™®Î∞îÏùº) */
        .multi-map-option span {
          font-size: 10px; /* Î™®Î∞îÏùºÏóêÏÑú Îçî ÏûëÏùÄ ÌÖçÏä§Ìä∏ */
          text-align: center;
          white-space: nowrap; /* ÌÖçÏä§Ìä∏ Ï§ÑÎ∞îÍøà Î∞©ÏßÄ */
        }

        /* Î™®Îã¨ Ìå®ÎÑê Ïä§ÌÉÄÏùº - Í∏∞Î≥∏ (Î™®Î∞îÏùº) */
        #multiMapModal .panel {
          width: 100%; /* Î™®Îã¨ ÎÑàÎπÑÎ•º ÌôîÎ©¥ ÌÅ¨Í∏∞Ïóê ÎßûÏ∂§ */
          max-width: 400px; /* ÏµúÎåÄ ÎÑàÎπÑ Ï†úÌïú */
          background: white;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          box-sizing: border-box;
        }

        /* Îç∞Ïä§ÌÅ¨ÌÜ± ÌôòÍ≤Ω (ÌôîÎ©¥ ÎÑàÎπÑ 768px Ïù¥ÏÉÅ) */
        @media (min-width: 768px) {
          .multi-map-option {
            width: 180px; /* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú Îçî ÌÅ∞ ÎÑàÎπÑ */
            height: 140px; /* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú Îçî ÌÅ∞ ÎÜíÏù¥ */
            padding: 10px; /* Îçî ÌÅ∞ Ìå®Îî© */
          }

          .multi-map-preview {
            width: 160px; /* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú Îçî ÌÅ∞ ÎØ∏Î¶¨Î≥¥Í∏∞ */
            height: 90px; /* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú Îçî ÌÅ∞ ÎÜíÏù¥ */
            margin-bottom: 8px;
          }

          .multi-map-option span {
            font-size: 14px; /* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú Îçî ÌÅ∞ ÌÖçÏä§Ìä∏ */
          }

          #multiMapModal .panel {
            max-width: 800px; /* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú Îçî ÎÑìÏùÄ Î™®Îã¨ */
          }

          .multi-map-selection {
            gap: 20px; /* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú Îçî ÌÅ∞ Í∞ÑÍ≤© */
            justify-content: center; /* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑúÎäî Ï§ëÏïô Ï†ïÎ†¨ */
            overflow-x: hidden; /* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑúÎäî Ïä§ÌÅ¨Î°§ ÎπÑÌôúÏÑ±Ìôî */
          }
        }
        /* Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0,0,0,0.5);
          align-items: center;
          justify-content: center;
          z-index: 100;
          padding: 10px;
          box-sizing: border-box;
        }
        .player-selection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        .player-option {
            width: 120px;
            height: 120px;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 10px;
            background-color: white;
        }
        .player-option:hover {
            border-color: #4CAF50;
            transform: scale(1.05);
        }
        .player-option.selected {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        .player-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 8px;
        }
        .usa-icon {
            background-color: #3c3b6e;
        }
        .china-icon {
            background-color: #de2910;
        }
        .row-icon {
            background-color: #607D8B;
        }
        .wto-icon {
            background-color: #2196F3;
        }
        .imf-icon {
            background-color: #9C27B0;
        }
        #scoresDisplay {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin: 10px 0;
        }
        .score-item {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
        }
        .usa-score {
            background-color: #3c3b6e;
        }
        .china-score {
            background-color: #de2910;
        }
        .row-score {
            background-color: #607D8B;
        }
        .wto-score {
            background-color: #2196F3;
        }
        .imf-score {
            background-color: #9C27B0;
        }
        #playerOrderDisplay {
            margin: 10px 0;
            padding: 5px;
            border-radius: 5px;
            background-color: #f5f5f5;
            font-size: 14px;
            line-height: 1.4;
        }

        /* ÏÉàÎ°úÏö¥ ÌäπÏàò Í∏∞Îä• Í¥ÄÎ†® Ïä§ÌÉÄÏùº */
        .special-turn-message {
            background-color: #ffe0b2;
            color: #e65100;
            padding: 8px 12px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(230, 81, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(230, 81, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(230, 81, 0, 0); }
        }
        
        .diagonal-available {
            box-shadow: inset 0 0 0 2px #ff9800;
        }
        
        .disputed-cell {
            box-shadow: inset 0 0 0 2px #ff0000;
        }
        
        .breakable-wall {
            box-shadow: inset 0 0 0 3px #ffeb3b;
            cursor: pointer;
        }
        
        .wall-break-mode .wall:not(.breakable-wall) {
            opacity: 0.5;
        }
        
        .special-button {
            background-color: #ff9800;
            margin-top: 10px;
        }
        
        .special-button:disabled {
            background-color: #ccc;
        }
        #specialFeaturesInfo {
            background-color: #e3f2fd;
            padding: 8px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 12px;
            text-align: left;
        }
        
        .special-feature-badge {
            display: inline-block;
            background-color: #ff9800;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            margin-left: 5px;
        }
        
        /* Ìù°Ïàò Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º */
        .capturing {
            animation: pulse-capture 0.2s ease-in-out;
            opacity: 0.5;
            transition: all 0.2s ease;
        }
        
        @keyframes pulse-capture {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 0.5; }
            100% { transform: scale(1); opacity: 0.8; }
        }
        
        /* ÏÖÄ Ìù°Ïàò Ïãú ÏßÄÏó∞ Ìö®Í≥ºÎ•º ÏúÑÌïú Ìä∏ÎûúÏßÄÏÖò */
        .cell {
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        
        /* Ïû•Î≤Ω ÎÜìÍ∏∞ Î™®Îìú Í¥ÄÎ†® Ïä§ÌÉÄÏùº */
        .place-wall-mode .cell:not(.wall):not(.usa):not(.china):not(.row):not(.wto):not(.imf):not(.visited):hover {
            background-color: #555;
            opacity: 0.7;
        }
        
        .place-wall-mode .cell.visited,
        .place-wall-mode .cell.usa,
        .place-wall-mode .cell.china,
        .place-wall-mode .cell.row,
        .place-wall-mode .cell.wto,
        .place-wall-mode .cell.imf,
        .place-wall-mode .cell.wall {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Ïû•Î≤Ω ÎÜìÍ∏∞ Í∞ÄÎä• ÏúÑÏπò Ïä§ÌÉÄÏùº */
        .placable-wall {
            box-shadow: inset 0 0 0 2px #4CAF50;
            cursor: pointer;
        }
        
        .place-wall-mode .cell:not(.placable-wall) {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .place-wall-mode .placable-wall:hover {
            background-color: #555;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <h1>ÏÑ∏Í∑†Ï†Ñ Í¥ÄÏÑ∏Ï†ÑÏüÅ</h1>
    
    <div class="game-container">
        <div class="board-wrapper">
            <div class="board" id="board"></div>
        </div>
        <div class="panel">
            <div id="turnInfo">Í≤åÏûÑ ÏãúÏûë</div>
            <div id="scoresDisplay"></div>
            <div id="playerOrderDisplay"></div>
            <div id="turnCounter">ÌÑ¥: 1/25</div>
            <div id="specialTurnMessage" class="special-turn-message" style="display: none;">ÌäπÎ≥Ñ ÌÑ¥: ÎåÄÍ∞ÅÏÑ† Ïù¥ÎèôÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§!</div>
            <div id="message"></div>
            <div id="specialFeatures" style="display: none;">
                <button id="breakWallBtn" class="special-button">Ïû•Î≤Ω ÌååÍ¥¥</button>
                <button id="placeWallBtn" class="special-button">Ïû•Î≤Ω ÎÜìÍ∏∞</button>
            </div>
            <button id="restartBtn">Í≤åÏûÑ Ïû¨ÏãúÏûë</button>
            
            <div id="gameRules">
                <strong>Í≤åÏûÑ Í∑úÏπô:</strong>
                <ul>
                    <li>Í∞Å ÌîåÎ†àÏù¥Ïñ¥Îäî ÏûêÏã†Ïùò Ï∞®Î°ÄÏóê Ïù∏Ï†ëÌïú ÏÖÄÏóê ÎßêÏùÑ ÎÜìÏùÑ Ïàò ÏûàÏäµÎãàÎã§.</li>
                    <li>Î™®Îì† ÎßêÏùÄ ÏÉÅÌïòÏ¢åÏö∞Î°úÎßå ÏõÄÏßÅÏùº Ïàò ÏûàÏäµÎãàÎã§.</li>
                    <li>ÏÉÅÎåÄÎ∞© ÎßêÍ≥º Ï†ëÏ¥âÌïòÎ©¥ ÏÉÅÎåÄÎ∞© ÎßêÏù¥ ÏûêÏã†Ïùò ÎßêÎ°ú Î∞îÎÄùÎãàÎã§.</li>
                    <li><strong>ÌïúÎ≤à ÎßêÏùÑ ÎÜìÏùÄ Í≥≥ÏóêÎäî Îã§Ïãú ÎßêÏùÑ ÎÜìÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.</strong></li>
                    <li>ÏµúÎåÄ ÌÑ¥Ïù¥ ÏßÄÎÇòÍ±∞ÎÇò, Î™®Îì† ÏÖÄÏù¥ Ï†êÎ†πÎêòÍ±∞ÎÇò, Ìïú ÌîåÎ†àÏù¥Ïñ¥Ïùò Ï†êÏàòÍ∞Ä 0Ïù¥ ÎêòÎ©¥ Í≤åÏûÑÏù¥ Ï¢ÖÎ£åÎê©ÎãàÎã§.</li>
                </ul>
            </div>
            <div id="specialFeaturesInfo" style="display: none;">
                <strong>ÌäπÏàò Í∏∞Îä• (Îã§Ï§ë Î™®Îìú):</strong>
                <ul>
                    <li>ÌäπÎ≥Ñ ÌÑ¥: Îß§ 5ÌÑ¥ÎßàÎã§ ÎåÄÍ∞ÅÏÑ† Ïù¥ÎèôÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.</li>
                    <li>Î∂ÑÏüÅ ÏßÄÏó≠: Îπ®Í∞ÑÏÉâ ÌÖåÎëêÎ¶¨ ÏÖÄÏùÄ Ïù¥ÎØ∏ Ï†êÎ†πÎêòÏóàÎçîÎùºÎèÑ Îã§Ïãú Ï†êÎ†πÌï† Ïàò ÏûàÎäî Î∂ÑÏüÅ ÏßÄÏó≠ÏûÖÎãàÎã§.</li>
                    <li>Ïû•Î≤Ω ÌååÍ¥¥: Í∞Å ÌîåÎ†àÏù¥Ïñ¥Îäî Í≤åÏûÑ Ï§ë Ìïú Î≤àÏùò Ïû•Î≤ΩÏùÑ ÌååÍ¥¥Ìï† Ïàò ÏûàÏúºÎÇò, Î∞îÎ°ú Ïù¥ÎèôÏùÄ Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</li>
                    <li>Ïû•Î≤Ω ÎÜìÍ∏∞: Í∞Å ÌîåÎ†àÏù¥Ïñ¥Îäî Í≤åÏûÑ Ï§ë Ìïú Î≤àÏùò Ïû•Î≤ΩÏùÑ ÏûêÏã†Ïùò Îßê Ï£ºÎ≥ÄÏóêÎßå ÎÜìÏùÑ Ïàò ÏûàÏäµÎãàÎã§.</li>
                </ul>
            </div>
        </div>
    </div>
    <!-- Î™®Îìú ÏÑ†ÌÉù Î™®Îã¨ -->
    <div class="modal" id="modeModal">
        <div class="panel" style="width: 450px;">
            <h2>Í≤åÏûÑ Î™®Îìú ÏÑ†ÌÉù</h2>
            <div style="display: flex; justify-content: center; gap: 20px;">
                <div class="mode-option" id="oneVsOneMode">
                    <div class="mode-icon">üë•</div>
                    <div class="mode-title">ÏÜîÎ°ú Î™®Îìú</div>
                    <div class="mode-desc">Ïª¥Ìì®ÌÑ∞ÏôÄ 1:1Î°ú ÎåÄÍ≤∞Ìï©ÎãàÎã§</div>
                </div>
                <div class="mode-option" id="multiMode">
                    <div class="mode-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <div class="mode-title">Îã§Ï§ë Î™®Îìú</div>
                    <div class="mode-desc">Ïó¨Îü¨ ÏÑ∏Î†•Ïù¥ Ìï®Íªò ÌîåÎ†àÏù¥Ìï©ÎãàÎã§</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Í∏∞Ï°¥ Îßµ ÏÑ†ÌÉù Î™®Îã¨ (ÏÜîÎ°ú Î™®Îìú) -->
    <div class="modal" id="mapModal">
        <div class="panel" style="width: 350px;">
            <h2>Îßµ ÏÑ†ÌÉù</h2>
            <div class="map-selection">
                <div class="map-option selected" data-map="standard">
                    <div class="map-preview map-preview-5x5"></div>
                    <span>5x5 Í∏∞Î≥∏</span>
                </div>
                <div class="map-option" data-map="large">
                    <div class="map-preview map-preview-8x8"></div>
                    <span>8x8 ÌÅ∞Îßµ</span>
                </div>
                <div class="map-option" data-map="usa">
                    <div class="map-preview map-preview-usa"></div>
                    <span>ÎØ∏Íµ≠ Îßµ</span>
                </div>
                <div class="map-option" data-map="china">
                    <div class="map-preview map-preview-china"></div>
                    <span>Ï§ëÍµ≠ Îßµ</span>
                </div>
            </div>
            <p>ÌîåÎ†àÏù¥Ìï† Íµ≠Í∞ÄÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî:</p>
            <button id="selectUSA">ÎØ∏Íµ≠</button>
            <button id="selectChina">Ï§ëÍµ≠</button>
        </div>
    </div>
<!-- Îã§Ï§ë Îßµ ÏÑ†ÌÉù Î™®Îã¨ (ÏàòÏ†ïÎê®) -->
    <div class="modal" id="multiMapModal">
        <div class="panel" style="width: 450px;">
            <h2>Îã§Ï§ë Î™®Îìú Îßµ ÏÑ†ÌÉù</h2>
            <div class="multi-map-selection" style="flex-wrap: wrap; max-width: 420px;">
                <div class="multi-map-option selected" data-map="trident" style="width: 180px; margin-bottom: 15px;">
                    <div class="multi-map-preview map-preview-trident"></div>
                    <span>ÏÇºÏßÄÏ∞Ω Îßµ (3Ïù∏)</span>
                </div>
                <div class="multi-map-option" data-map="pacific" style="width: 180px; margin-bottom: 15px;">
                    <div class="multi-map-preview map-preview-pacific"></div>
                    <span>ÌÉúÌèâÏñë Î∂ÑÏßÄÎèÑ Îßµ (4Ïù∏)</span>
                </div>
                <div class="multi-map-option" data-map="islandMap" style="width: 180px; margin-bottom: 15px;">
                    <div class="multi-map-preview map-preview-island"></div>
                    <span>ÏÑ¨ Îßµ (4Ïù∏)</span>
                </div>
                <div class="multi-map-option" data-map="mazeMap" style="width: 180px; margin-bottom: 15px;">
                    <div class="multi-map-preview map-preview-maze"></div>
                    <span>ÎØ∏Î°ú Îßµ (3Ïù∏)</span>
                </div>
                <!-- Ïö∞Ï£º Ï†ïÍ±∞Ïû• Îßµ Ï∂îÍ∞Ä -->
                <div class="multi-map-option" data-map="spaceStation" style="width: 180px; margin-bottom: 15px;">
                    <div class="multi-map-preview map-preview-spacestation"></div>
                    <span>Ïö∞Ï£º Ï†ïÍ±∞Ïû• Îßµ (4Ïù∏)</span>
                </div>
            </div>
            <button id="nextToPlayerSelect">Îã§Ïùå</button>
            <button id="backToModeSelect">Îí§Î°ú</button>
        </div>
    </div>
    <!-- 3Ïù∏ ÌîåÎ†àÏù¥Ïñ¥ ÏÑ†ÌÉù Î™®Îã¨ (ÏÇºÏßÄÏ∞Ω Îßµ) -->
    <div class="modal" id="tridentPlayerModal">
        <div class="panel" style="width: 450px;">
            <h2>ÌîåÎ†àÏù¥Ïñ¥ ÏÑ†ÌÉù</h2>
            <p>ÌîåÎ†àÏù¥Ìï† ÏÑ∏Î†•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî:</p>
            <div class="player-selection">
                <div class="player-option" data-player="usa">
                    <div class="player-icon usa-icon">USA</div>
                    <span>ÎØ∏Íµ≠</span>
                </div>
                <div class="player-option" data-player="china">
                    <div class="player-icon china-icon">‚òÖ</div>
                    <span>Ï§ëÍµ≠</span>
                </div>
                <div class="player-option" data-player="row">
                    <div class="player-icon row-icon">üåç</div>
                    <span>ROW</span>
                </div>
            </div>
            <button id="startTridentGame">Í≤åÏûÑ ÏãúÏûë</button>
            <button id="backToMultiMapSelect">Îí§Î°ú</button>
        </div>
    </div>
    
    <!-- 4Ïù∏ ÌîåÎ†àÏù¥Ïñ¥ ÏÑ†ÌÉù Î™®Îã¨ (ÌÉúÌèâÏñë Î∂ÑÏßÄÎèÑ Îßµ) -->
    <div class="modal" id="pacificPlayerModal">
        <div class="panel" style="width: 520px;">
            <h2>ÌîåÎ†àÏù¥Ïñ¥ ÏÑ†ÌÉù</h2>
            <p>ÌîåÎ†àÏù¥Ìï† ÏÑ∏Î†•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî:</p>
            <div class="player-selection">
                <div class="player-option" data-player="usa">
                    <div class="player-icon usa-icon">USA</div>
                    <span>ÎØ∏Íµ≠</span>
                </div>
                <div class="player-option" data-player="china">
                    <div class="player-icon china-icon">‚òÖ</div>
                    <span>Ï§ëÍµ≠</span>
                </div>
                <div class="player-option" data-player="wto">
                    <div class="player-icon wto-icon">WTO</div>
                    <span>WTO</span>
                </div>
                <div class="player-option" data-player="imf">
                    <div class="player-icon imf-icon">$</div>
                    <span>IMF</span>
                </div>
            </div>
            <button id="startPacificGame">Í≤åÏûÑ ÏãúÏûë</button>
            <button id="backToMultiMapSelect2">Îí§Î°ú</button>
        </div>
    </div>
    
    <!-- Í≤åÏûÑ Í≤∞Í≥º Î™®Îã¨ -->
    <div class="modal" id="resultModal" style="display: none;">
        <div class="panel">
            <h2 id="resultTitle">Í≤åÏûÑ Ï¢ÖÎ£å!</h2>
            <p id="resultDesc"></p>
            <button id="newGameBtn">ÏÉà Í≤åÏûÑ</button>
        </div>
    </div>
<script>
// Í≤åÏûÑ ÏÉÅÌÉú
        const game = {
            board: [], // Î≥¥Îìú ÏÉÅÌÉú (usa, china, wall, ÎòêÎäî ÎπàÏπ∏)
            visitedCells: [], // Î∞©Î¨∏Ìïú ÏÖÄ (true, false)
            size: { width: 5, height: 5 }, // Í∏∞Î≥∏ Îßµ ÌÅ¨Í∏∞
            currentPlayer: 'usa',
            humanPlayer: '',
            computerPlayers: [], // Îã§Ï§ë Î™®ÎìúÎ•º ÏúÑÌïú Ïª¥Ìì®ÌÑ∞ ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïó¥
            scores: { usa: 1, china: 1 }, // Í∏∞Î≥∏ Ï†êÏàò (Îã§Ï§ë Î™®ÎìúÏóêÏÑúÎäî ÌôïÏû•Îê®)
            turnCount: 1,
            maxTurns: 25, // ÏµúÎåÄ ÌÑ¥ Ïàò
            lastMove: { x: -1, y: -1 },  // ÎßàÏßÄÎßâ Ïù¥Îèô ÏúÑÏπò
            moveHistory: [],              // Ïù¥Îèô Í∏∞Î°ù
            mapType: 'standard',          // Îßµ ÌÉÄÏûÖ (standard, large, usa, china, trident, pacific)
            activeCells: [],              // ÌôúÏÑ±ÌôîÎêú ÏÖÄ
            gameMode: '',                 // Í≤åÏûÑ Î™®Îìú (oneVsOne, multi)
            multiMode: '',                // Îã§Ï§ë Î™®Îìú ÌÉÄÏûÖ (trident, pacific)
            playerOrder: [],              // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú Î∞∞Ïó¥
            isGameOver: false,            // Í≤åÏûÑ Ï¢ÖÎ£å ÏÉÅÌÉú
            
            // ÌäπÏàò Í∏∞Îä• Í¥ÄÎ†® Î≥ÄÏàò
            isSpecialTurn: false,         // ÌäπÎ≥Ñ ÌÑ¥ Ïó¨Î∂Ä (ÎåÄÍ∞ÅÏÑ† Ïù¥Îèô)
            disputedCells: [],            // Î∂ÑÏüÅ ÏßÄÏó≠ ÏÖÄ Î™©Î°ù [{x, y}, ...]
            wallBreakUsed: {},            // ÌîåÎ†àÏù¥Ïñ¥Î≥Ñ Ïû•Î≤Ω ÌååÍ¥¥ ÏÇ¨Ïö© Ïó¨Î∂Ä
            wallBreakMode: false,         // Ïû•Î≤Ω ÌååÍ¥¥ Î™®Îìú ÌôúÏÑ±Ìôî Ïó¨Î∂Ä
            breakableWalls: [],           // ÌååÍ¥¥ Í∞ÄÎä•Ìïú Î≤Ω Î™©Î°ù [{x, y}, ...]
            
            // Ïû•Î≤Ω ÎÜìÍ∏∞ Í¥ÄÎ†® ÏÉàÎ°úÏö¥ Î≥ÄÏàò
            wallPlaceUsed: {},            // ÌîåÎ†àÏù¥Ïñ¥Î≥Ñ Ïû•Î≤Ω ÎÜìÍ∏∞ ÏÇ¨Ïö© Ïó¨Î∂Ä
            wallPlaceMode: false,         // Ïû•Î≤Ω ÎÜìÍ∏∞ Î™®Îìú ÌôúÏÑ±Ìôî Ïó¨Î∂Ä
            placableWallPositions: []     // Ïû•Î≤ΩÏùÑ ÎÜìÏùÑ Ïàò ÏûàÎäî ÏúÑÏπò Î∞∞Ïó¥
        };
        // Îßµ ÏÑ§Ï†ï
        const mapConfigs = {
            standard: {
                width: 5,
                height: 5,
                cellSize: 55,
                wallCount: { min: 2, max: 4 },
                maxTurns: 25
            },
            large: {
                width: 8,
                height: 8,
                cellSize: 45,
                wallCount: { min: 4, max: 8 },
                maxTurns: 64
            },
            usa: {
                width: 10,
                height: 8,
                cellSize: 40,
                wallCount: { min: 3, max: 6 },
                maxTurns: 50
            },
            china: {
                width: 10,
                height: 9,
                cellSize: 40,
                wallCount: { min: 3, max: 6 },
                maxTurns: 50
            },
            // ÏÇºÏßÄÏ∞Ω Îßµ (1:1:1 Î™®Îìú)
            trident: {
                width: 11,
                height: 11,
                cellSize: 38,
                wallCount: { min: 5, max: 10 },
                maxTurns: 81,
                disputedCellCount: 3     // Ï∂îÍ∞Ä: Î∂ÑÏüÅ ÏßÄÏó≠ ÏÖÄ Í∞úÏàò
            },
            // ÌÉúÌèâÏñë Î∂ÑÏßÄÎèÑ Îßµ (1:1:1:1 Î™®Îìú)
            pacific: {
                width: 8,
                height: 8,
                cellSize: 45,
                wallCount: { min: 3, max: 6 },
                maxTurns: 64,
                disputedCellCount: 4     // Ï∂îÍ∞Ä: Î∂ÑÏüÅ ÏßÄÏó≠ ÏÖÄ Í∞úÏàò
            },
            // ÏÑ¨Îßµ (14x14 - 4Ïù∏ Î™®ÎìúÎ°ú ÏàòÏ†ï)
            islandMap: {
                width: 14,
                height: 14,
                cellSize: 32,
                wallCount: { min: 5, max: 10 },
                maxTurns: 130,
                disputedCellCount: 4     // Ï∂îÍ∞Ä: Î∂ÑÏüÅ ÏßÄÏó≠ ÏÖÄ Í∞úÏàò
            },
            // ÎØ∏Î°úÎßµ (14x14 - 3Ïù∏ Î™®ÎìúÎ°ú ÏàòÏ†ï)
            mazeMap: {
                width: 10,
                height: 10,
                cellSize: 38,
                wallCount: { min: 3, max: 6 },
                maxTurns: 60,
                disputedCellCount: 0     // ÎØ∏Î°úÎßµÏùÄ Î∂ÑÏüÅ ÏßÄÏó≠ ÏóÜÏùå
            },
            // Ïö∞Ï£º Ï†ïÍ±∞Ïû• Îßµ Ï∂îÍ∞Ä
            spaceStation: {
                width: 15, 
                height: 15,
                cellSize: 25,
                wallCount: { min: 6, max: 12 },
                maxTurns: 120,
                disputedCellCount: 5
            }
        };
        // Î∂ÑÏüÅ ÏßÄÏó≠ Í≥†Ï†ï ÏúÑÏπò Ï†ïÏùò
        const disputedCellPositions = {
            trident: [
                {x: 5, y: 5},   // Ï§ëÏïô
                {x: 2, y: 8},    // ÏôºÏ™Ω ÌïòÎã®Î∂Ä
                {x: 8, y: 8}     // Ïò§Î•∏Ï™Ω ÌïòÎã®Î∂Ä
            ],
            pacific: [
                {x: 3, y: 1},    // Î∂ÅÎØ∏-ÏïÑÏãúÏïÑ ÏÇ¨Ïù¥
                {x: 1, y: 4},    // Î∂ÅÎØ∏-ÎÇ®ÎØ∏ ÏÇ¨Ïù¥
                {x: 6, y: 4},    // ÏïÑÏãúÏïÑ-Ìò∏Ï£º ÏÇ¨Ïù¥
                {x: 4, y: 6}     // ÎÇ®ÎØ∏-Ìò∏Ï£º ÏÇ¨Ïù¥
            ],
            islandMap: [
                {x: 7, y: 4},    // Ï§ëÏïô ÏÑ¨ ÏÉÅÎã®
                {x: 4, y: 7},    // Ï§ëÏïô ÏÑ¨ ÏôºÏ™Ω
                {x: 10, y: 7},   // Ï§ëÏïô ÏÑ¨ Ïò§Î•∏Ï™Ω
                {x: 7, y: 10}    // Ï§ëÏïô ÏÑ¨ ÌïòÎã®
            ],
            // Ïö∞Ï£º Ï†ïÍ±∞Ïû• Îßµ Î∂ÑÏüÅ ÏßÄÏó≠ Ï∂îÍ∞Ä
            spaceStation: [
                {x: 7, y: 7},   // Ï§ëÏïô
                {x: 3, y: 7},   // ÏôºÏ™Ω Ï§ëÏïô
                {x: 11, y: 7},  // Ïò§Î•∏Ï™Ω Ï§ëÏïô
                {x: 7, y: 3},   // ÏúÑÏ™Ω Ï§ëÏïô
                {x: 7, y: 11}   // ÏïÑÎûòÏ™Ω Ï§ëÏïô
            ]
        };

        // ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥
        const playerInfo = {
            usa: { name: 'ÎØ∏Íµ≠', displayName: 'ÎØ∏Íµ≠', emoji: 'USA', color: '#3c3b6e' },
            china: { name: 'Ï§ëÍµ≠', displayName: 'Ï§ëÍµ≠', emoji: '‚òÖ', color: '#de2910' },
            row: { name: 'ROW', displayName: 'ROW', emoji: 'üåç', color: '#607D8B' },
            wto: { name: 'WTO', displayName: 'WTO', emoji: 'WTO', color: '#2196F3' },
            imf: { name: 'IMF', displayName: 'IMF', emoji: '$', color: '#9C27B0' }
        };
        // ÎØ∏Íµ≠ Îßµ ÌòïÌÉú (1ÏùÄ ÌôúÏÑ± ÏÖÄ, 0ÏùÄ ÎπÑÌôúÏÑ± ÏÖÄ)
        const usaMapTemplate = [
            [0,0,0,0,0,0,0,0,0,0],
            [0,1,1,1,1,1,1,1,1,0],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,0],
            [0,1,1,1,1,1,1,0,0,0],
            [0,0,0,0,0,0,0,0,0,0]
        ];

        // Ï§ëÍµ≠ Îßµ ÌòïÌÉú (1ÏùÄ ÌôúÏÑ± ÏÖÄ, 0ÏùÄ ÎπÑÌôúÏÑ± ÏÖÄ)
        const chinaMapTemplate = [
            [0,0,0,1,1,1,1,0,0,0],
            [0,0,1,1,1,1,1,1,0,0],
            [0,1,1,1,1,1,1,1,1,0],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [0,1,1,1,1,1,1,1,1,0],
            [0,0,1,1,1,1,1,1,0,0],
            [0,0,0,1,1,1,1,0,0,0]
        ];

        // ÏÇºÏßÄÏ∞Ω Îßµ ÌòïÌÉú (1ÏùÄ ÌôúÏÑ± ÏÖÄ, 0ÏùÄ ÎπÑÌôúÏÑ± ÏÖÄ)
        const tridentMapTemplate = [
            [0,0,0,0,0,1,0,0,0,0,0],
            [0,0,0,0,1,1,1,0,0,0,0],
            [0,0,0,0,1,1,1,0,0,0,0],
            [0,0,0,1,1,1,1,1,0,0,0],
            [0,0,0,1,1,1,1,1,0,0,0],
            [0,0,1,1,1,1,1,1,1,0,0],
            [0,0,1,1,1,1,1,1,1,0,0],
            [0,1,1,1,1,1,1,1,1,1,0],
            [1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,0,0,0,0,0,1,1,1],
            [1,1,0,0,0,0,0,0,0,1,1]
        ];

        // ÌÉúÌèâÏñë Î∂ÑÏßÄÎèÑ Îßµ ÌòïÌÉú (1ÏùÄ ÌôúÏÑ± ÏÖÄ, 0ÏùÄ ÎπÑÌôúÏÑ± ÏÖÄ, Í∞Å ÎåÄÎ•ôÏóê ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïπò)
        const pacificBasinMapTemplate = [
            [1,1,1,1,1,1,1,1],
            [1,0,1,1,1,1,0,1],
            [1,1,1,1,1,1,1,1],
            [1,1,1,0,0,1,1,1],
            [1,1,1,0,0,1,1,1],
            [1,1,1,1,1,1,1,1],
            [1,0,1,1,1,1,0,1],
            [1,1,1,1,1,1,1,1]
        ];
        // ÏàòÏ†ïÎêú ÏÑ¨Îßµ ÌÖúÌîåÎ¶ø (14x14 - 4Ïù∏ Î™®Îìú, Î™®Îì† ÏûëÏùÄ ÏÑ¨ÏóêÏÑú Ï§ëÏïô ÏÑ¨ÏúºÎ°ú Í∞ÄÎäî Í≤ΩÎ°ú Ï∂îÍ∞ÄÎê®)
        const islandMapTemplate = [
            [0,0,0,0,1,1,1,1,1,1,0,0,0,0],
            [0,0,0,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,1,1,0,0,1,1,0,0,1,1,0,0],
            [0,1,1,0,0,0,1,1,0,0,0,1,1,0],
            [1,1,0,0,0,1,1,1,1,0,0,0,1,1],
            [1,1,0,0,1,1,1,1,1,1,0,0,1,1],
            [1,1,1,0,1,1,1,1,1,1,1,1,1,1], 
            [1,1,1,0,1,1,1,1,1,1,0,1,1,1], 
            [1,1,0,0,1,1,1,1,1,1,0,0,1,1],
            [1,1,0,1,1,1,1,1,1,1,0,1,1,1], 
            [0,1,1,1,0,1,1,1,1,0,1,1,1,0], 
            [0,0,1,1,0,0,1,1,0,0,1,1,0,0],
            [0,0,0,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,0,0,1,1,1,1,1,1,0,0,0,0]
        ];

        // Îçî Î≥µÏû°Ìïú ÎØ∏Î°úÎßµ ÌÖúÌîåÎ¶ø - 
        const mazeMapTemplate = [
            [1,1,1,1,1,1,1,1,1,1],
            [1,0,0,1,0,0,1,0,0,1],
            [1,0,1,1,1,1,1,1,0,1],
            [1,0,1,0,0,1,0,1,0,1],
            [1,1,1,0,1,1,1,1,1,1],
            [1,0,1,1,1,0,0,1,0,1],
            [1,0,1,0,1,1,1,1,1,1],
            [1,1,1,1,1,0,0,1,0,1],
            [1,0,0,0,1,1,0,1,0,1],
            [1,1,1,1,1,1,1,1,1,1]
        ];

        // Ïö∞Ï£º Ï†ïÍ±∞Ïû• Îßµ ÌÖúÌîåÎ¶ø (15x15 - 4Ïù∏ Î™®Îìú)
        const spaceStationMapTemplate = [
            [0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
            [0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
            [0,0,0,1,1,1,0,1,0,1,1,1,0,0,0],
            [0,0,1,1,0,0,0,1,0,0,0,1,1,0,0],
            [0,1,1,0,1,1,1,1,1,1,1,0,1,1,0],
            [0,1,1,0,1,0,1,1,1,0,1,0,1,1,0],
            [1,1,0,0,1,1,1,1,1,1,1,0,0,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,0,0,1,1,1,1,1,1,1,0,0,1,1],
            [0,1,1,0,1,0,1,1,1,0,1,0,1,1,0],
            [0,1,1,0,1,1,1,1,1,1,1,0,1,1,0],
            [0,0,1,1,0,0,0,1,0,0,0,1,1,0,0],
            [0,0,0,1,1,1,0,1,0,1,1,1,0,0,0],
            [0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
            [0,0,0,0,0,0,1,1,1,0,0,0,0,0,0]
        ];
        // DOM ÏöîÏÜå
        const boardEl = document.getElementById('board');
        const turnInfoEl = document.getElementById('turnInfo');
        const mapModalEl = document.getElementById('mapModal');
        const scoresDisplayEl = document.getElementById('scoresDisplay');
        const turnCounterEl = document.getElementById('turnCounter');
        const messageEl = document.getElementById('message');
        const modeModalEl = document.getElementById('modeModal');
        const multiMapModalEl = document.getElementById('multiMapModal');
        const tridentPlayerModalEl = document.getElementById('tridentPlayerModal');
        const pacificPlayerModalEl = document.getElementById('pacificPlayerModal');
        const resultModalEl = document.getElementById('resultModal');
        const resultTitleEl = document.getElementById('resultTitle');
        const resultDescEl = document.getElementById('resultDesc');
        const playerOrderDisplayEl = document.getElementById('playerOrderDisplay');
        const specialTurnMessageEl = document.getElementById('specialTurnMessage');
        const specialFeaturesEl = document.getElementById('specialFeatures');
        const breakWallBtnEl = document.getElementById('breakWallBtn');
        const placeWallBtnEl = document.getElementById('placeWallBtn');
        const specialFeaturesInfoEl = document.getElementById('specialFeaturesInfo');

        // Í∏∞Î≥∏ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.getElementById('oneVsOneMode').addEventListener('click', () => selectGameMode('oneVsOne'));
        document.getElementById('multiMode').addEventListener('click', () => selectGameMode('multi'));
        document.getElementById('selectUSA').addEventListener('click', () => selectCountry('usa'));
        document.getElementById('selectChina').addEventListener('click', () => selectCountry('china'));
        document.getElementById('restartBtn').addEventListener('click', showModeModal);
        document.getElementById('newGameBtn').addEventListener('click', showModeModal);
        breakWallBtnEl.addEventListener('click', toggleWallBreakMode);
        placeWallBtnEl.addEventListener('click', toggleWallPlaceMode);
        
        // Îßµ ÏòµÏÖò ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
        document.querySelectorAll('.map-option').forEach(option => {
            option.addEventListener('click', function() {
                // Î™®Îì† ÏòµÏÖòÏóêÏÑú selected ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                document.querySelectorAll('.map-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                // ÌÅ¥Î¶≠Ìïú ÏòµÏÖòÏóê selected ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                this.classList.add('selected');
                
                // ÏÑ†ÌÉùÎêú Îßµ ÌÉÄÏûÖ Ï†ÄÏû•
                game.mapType = this.dataset.map;
            });
        });

        // Îã§Ï§ë Î™®Îìú Îßµ ÏòµÏÖò ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.querySelectorAll('.multi-map-option').forEach(option => {
            option.addEventListener('click', function() {
                // Î™®Îì† ÏòµÏÖòÏóêÏÑú selected ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                document.querySelectorAll('.multi-map-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                // ÌÅ¥Î¶≠Ìïú ÏòµÏÖòÏóê selected ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                this.classList.add('selected');
                
                // ÏÑ†ÌÉùÎêú Îã§Ï§ë Î™®Îìú Îßµ ÌÉÄÏûÖ Ï†ÄÏû•
                game.multiMode = this.dataset.map;
            });
        });

        // Îã§Ï§ë Î™®Îìú Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.getElementById('nextToPlayerSelect').addEventListener('click', showPlayerSelectionModal);
        document.getElementById('backToModeSelect').addEventListener('click', showModeModal);
        document.getElementById('backToMultiMapSelect').addEventListener('click', showMultiMapModal);
        document.getElementById('backToMultiMapSelect2').addEventListener('click', showMultiMapModal);
        document.getElementById('startTridentGame').addEventListener('click', startMultiGame);
        document.getElementById('startPacificGame').addEventListener('click', startMultiGame);

        // ÌîåÎ†àÏù¥Ïñ¥ ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.querySelectorAll('.player-option').forEach(option => {
            option.addEventListener('click', function() {
                const modalId = this.closest('.modal').id;
                const playerOptions = document.querySelectorAll(`#${modalId} .player-option`);
                
                // Î™®Îì† ÏòµÏÖòÏóêÏÑú selected ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                playerOptions.forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // ÌÅ¥Î¶≠Ìïú ÏòµÏÖòÏóê selected ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                this.classList.add('selected');
            });
        });
       // Í≤åÏûÑ Î™®Îìú ÏÑ†ÌÉù Î™®Îã¨ ÌëúÏãú
        function showModeModal() {
            modeModalEl.style.display = 'flex';
            mapModalEl.style.display = 'none';
            multiMapModalEl.style.display = 'none';
            tridentPlayerModalEl.style.display = 'none';
            pacificPlayerModalEl.style.display = 'none';
            resultModalEl.style.display = 'none';
            
            // Í≤åÏûÑ Î™®Îìú Ï¥àÍ∏∞Ìôî
            game.gameMode = '';
            game.multiMode = '';
        }

        // Í≤åÏûÑ Î™®Îìú ÏÑ†ÌÉù
        function selectGameMode(mode) {
            game.gameMode = mode;
            modeModalEl.style.display = 'none';
            
            if (mode === 'oneVsOne') {
                showMapModal();
            } else if (mode === 'multi') {
                showMultiMapModal();
            }
        }

        // Îßµ Î™®Îã¨ ÌëúÏãú (ÏÜîÎ°ú Î™®Îìú)
        function showMapModal() {
            // Í∏∞Î≥∏ Îßµ ÏÑ†ÌÉù
            document.querySelectorAll('.map-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`.map-option[data-map="standard"]`).classList.add('selected');
            game.mapType = 'standard';
            
            mapModalEl.style.display = 'flex';
            resultModalEl.style.display = 'none';
        }

        // Îã§Ï§ë Î™®Îìú Îßµ Î™®Îã¨ ÌëúÏãú
        function showMultiMapModal() {
            // Í∏∞Î≥∏ Îã§Ï§ë Îßµ ÏÑ†ÌÉù
            document.querySelectorAll('.multi-map-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`.multi-map-option[data-map="trident"]`).classList.add('selected');
            game.multiMode = 'trident';
            
            multiMapModalEl.style.display = 'flex';
            tridentPlayerModalEl.style.display = 'none';
            pacificPlayerModalEl.style.display = 'none';
            modeModalEl.style.display = 'none';
        }
        // ÌîåÎ†àÏù¥Ïñ¥ ÏÑ†ÌÉù Î™®Îã¨ ÌëúÏãú
        function showPlayerSelectionModal() {
            multiMapModalEl.style.display = 'none';
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.player-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            if (game.multiMode === 'trident' || game.multiMode === 'mazeMap') {
                tridentPlayerModalEl.style.display = 'flex';
                document.querySelector('#tridentPlayerModal .player-option[data-player="usa"]').classList.add('selected');
            } else if (game.multiMode === 'pacific' || game.multiMode === 'islandMap' || game.multiMode === 'spaceStation') {
                pacificPlayerModalEl.style.display = 'flex';
                document.querySelector('#pacificPlayerModal .player-option[data-player="usa"]').classList.add('selected');
            }
        }

        // Íµ≠Í∞Ä ÏÑ†ÌÉù (ÏÜîÎ°ú Î™®Îìú)
        function selectCountry(country) {
            game.humanPlayer = country;
            game.computerPlayers = [country === 'usa' ? 'china' : 'usa'];
            
            // ÏÑ†ÌÉùÎêú Îßµ ÌÉÄÏûÖ Ï†ÅÏö©
            const config = mapConfigs[game.mapType];
            game.size = { width: config.width, height: config.height };
            game.maxTurns = config.maxTurns;
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú ÏÑ§Ï†ï
            game.playerOrder = shuffleArray(['usa', 'china']);
            
            // ÌÉÄÏù¥ÌãÄ ÏóÖÎç∞Ïù¥Ìä∏
            document.title = `ÏÑ∏Í∑†Ï†Ñ Í¥ÄÏÑ∏Ï†ÑÏüÅ ${config.width}x${config.height}`;
            
            // Ïû•Î≤Ω ÌååÍ¥¥ Îä•Î†• Ï¥àÍ∏∞Ìôî (ÏÜîÎ°úÎ™®ÎìúÏóêÏÑúÎèÑ Ï†ÅÏö©)
            game.wallBreakUsed = {};
            game.wallPlaceUsed = {}; // Ïû•Î≤Ω ÎÜìÍ∏∞ Îä•Î†• Ï¥àÍ∏∞ÌôîÎèÑ Ï∂îÍ∞Ä
            game.playerOrder.forEach(player => {
                game.wallBreakUsed[player] = false;
                game.wallPlaceUsed[player] = false;
            });
            
            mapModalEl.style.display = 'none';
            initGame();
            
            // Ïª¥Ìì®ÌÑ∞ Ï∞®Î°ÄÏùº Í≤ΩÏö∞
            if (game.currentPlayer !== game.humanPlayer) {
                setTimeout(computerTurn, 1000);
            }
        }
        // Îã§Ï§ë Î™®Îìú Í≤åÏûÑ ÏãúÏûë
        function startMultiGame() {
            let selectedPlayerEl;
            
            if (game.multiMode === 'trident') {
                tridentPlayerModalEl.style.display = 'none';
                selectedPlayerEl = document.querySelector('#tridentPlayerModal .player-option.selected');
                game.mapType = 'trident';
                // Ìä∏ÎùºÏù¥ÎçòÌä∏ Î™®ÎìúÏóêÏÑúÎäî 3Î™ÖÏùò ÌîåÎ†àÏù¥Ïñ¥, ÏàúÏÑúÎ•º ÎûúÎç§Ìôî
                game.playerOrder = shuffleArray(['usa', 'china', 'row']);
            } else if (game.multiMode === 'pacific') {
                pacificPlayerModalEl.style.display = 'none';
                selectedPlayerEl = document.querySelector('#pacificPlayerModal .player-option.selected');
                game.mapType = 'pacific';
                
                // ÌÉúÌèâÏñë Î™®ÎìúÏóêÏÑúÎäî 4Î™ÖÏùò ÌîåÎ†àÏù¥Ïñ¥, ÏàúÏÑúÎ•º ÎûúÎç§Ìôî
                game.playerOrder = shuffleArray(['usa', 'china', 'wto', 'imf']);
            } else if (game.multiMode === 'islandMap') {
                pacificPlayerModalEl.style.display = 'none';
                selectedPlayerEl = document.querySelector('#pacificPlayerModal .player-option.selected');
                game.mapType = 'islandMap';
                
                // ÏÑ¨Îßµ Î™®ÎìúÏóêÏÑúÎäî 4Î™ÖÏùò ÌîåÎ†àÏù¥Ïñ¥, ÏàúÏÑúÎ•º ÎûúÎç§Ìôî
                game.playerOrder = shuffleArray(['usa', 'china', 'wto', 'imf']);
            } else if (game.multiMode === 'mazeMap') {
                tridentPlayerModalEl.style.display = 'none';
                selectedPlayerEl = document.querySelector('#tridentPlayerModal .player-option.selected');
                game.mapType = 'mazeMap';
                
                // ÎØ∏Î°úÎßµ Î™®ÎìúÏóêÏÑúÎäî 3Î™ÖÏùò ÌîåÎ†àÏù¥Ïñ¥, ÏàúÏÑúÎ•º ÎûúÎç§Ìôî
                game.playerOrder = shuffleArray(['usa', 'china', 'row']);
            } else if (game.multiMode === 'spaceStation') {
                pacificPlayerModalEl.style.display = 'none';
                selectedPlayerEl = document.querySelector('#pacificPlayerModal .player-option.selected');
                game.mapType = 'spaceStation';
                
                // Ïö∞Ï£º Ï†ïÍ±∞Ïû• Î™®ÎìúÏóêÏÑúÎäî 4Î™ÖÏùò ÌîåÎ†àÏù¥Ïñ¥, ÏàúÏÑúÎ•º ÎûúÎç§Ìôî
                game.playerOrder = shuffleArray(['usa', 'china', 'wto', 'imf']);
            }
            
            // ÏÇ¨Îûå ÌîåÎ†àÏù¥Ïñ¥ ÏÑ§Ï†ï
            game.humanPlayer = selectedPlayerEl ? selectedPlayerEl.dataset.player : game.playerOrder[0];
            
            // Ïª¥Ìì®ÌÑ∞ ÌîåÎ†àÏù¥Ïñ¥ ÏÑ§Ï†ï (ÏÇ¨Îûå ÌîåÎ†àÏù¥Ïñ¥Î•º Ï†úÏô∏Ìïú Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥)
            game.computerPlayers = game.playerOrder.filter(player => player !== game.humanPlayer);
            
            // Îßµ ÏÑ§Ï†ï Ï†ÅÏö©
            const config = mapConfigs[game.mapType];
            game.size = { width: config.width, height: config.height };
            game.maxTurns = config.maxTurns;
            
            // ÌÉÄÏù¥ÌãÄ ÏóÖÎç∞Ïù¥Ìä∏
            document.title = `ÏÑ∏Í∑†Ï†Ñ Í¥ÄÏÑ∏Ï†ÑÏüÅ - Îã§Ï§ë Î™®Îìú ${config.width}x${config.height}`;
            
            // Ïû•Î≤Ω ÌååÍ¥¥ Îä•Î†• Ï¥àÍ∏∞Ìôî
            game.wallBreakUsed = {};
            game.wallPlaceUsed = {}; // Ïû•Î≤Ω ÎÜìÍ∏∞ Îä•Î†• Ï¥àÍ∏∞ÌôîÎèÑ Ï∂îÍ∞Ä
            game.playerOrder.forEach(player => {
                game.wallBreakUsed[player] = false;
                game.wallPlaceUsed[player] = false;
            });
            
            initGame();
            
            // Ïª¥Ìì®ÌÑ∞ Ï∞®Î°ÄÏùº Í≤ΩÏö∞
            if (game.currentPlayer !== game.humanPlayer) {
                setTimeout(computerTurn, 1000);
            }
        }
// Í≤åÏûÑ Ï¥àÍ∏∞Ìôî
        function initGame() {
            const config = mapConfigs[game.mapType];
            game.isGameOver = false;
            
            // Î≥¥Îìú Ï¥àÍ∏∞Ìôî
            game.board = Array(config.height).fill().map(() => Array(config.width).fill(''));
            
            // Î∞©Î¨∏Ìïú ÏÖÄ Ï¥àÍ∏∞Ìôî (Î™®Îëê falseÎ°ú ÏÑ§Ï†ï)
            game.visitedCells = Array(config.height).fill().map(() => Array(config.width).fill(false));
            
            // ÌôúÏÑ± ÏÖÄ Ï¥àÍ∏∞Ìôî
            game.activeCells = Array(config.height).fill().map(() => Array(config.width).fill(true));
            
            // ÌäπÏàò Í∏∞Îä• Î≥ÄÏàò Ï¥àÍ∏∞Ìôî
            game.isSpecialTurn = false;
            game.disputedCells = [];
            game.wallBreakMode = false;
            game.wallPlaceMode = false; // Ïû•Î≤Ω ÎÜìÍ∏∞ Î™®Îìú Ï¥àÍ∏∞Ìôî
            game.breakableWalls = [];
            game.placableWallPositions = []; // Ïû•Î≤Ω ÎÜìÍ∏∞ Í∞ÄÎä•Ìïú ÏúÑÏπò Ï¥àÍ∏∞Ìôî
            
            // Îßµ ÌÉÄÏûÖÏóê Îî∞Î•∏ ÌôúÏÑ± ÏÖÄ ÏÑ§Ï†ï
            if (game.mapType === 'usa') {
                setActiveCellsFromTemplate(usaMapTemplate);
            } else if (game.mapType === 'china') {
                setActiveCellsFromTemplate(chinaMapTemplate);
            } else if (game.mapType === 'trident') {
                setActiveCellsFromTemplate(tridentMapTemplate);
            } else if (game.mapType === 'pacific') {
                setActiveCellsFromTemplate(pacificBasinMapTemplate);
            } else if (game.mapType === 'islandMap') {
                setActiveCellsFromTemplate(islandMapTemplate);
            } else if (game.mapType === 'mazeMap') {
                setActiveCellsFromTemplate(mazeMapTemplate);
            } else if (game.mapType === 'spaceStation') {
                setActiveCellsFromTemplate(spaceStationMapTemplate);
            }
            
            // Ï¥àÍ∏∞ Ï†êÏàò ÏÑ§Ï†ï
            initializeScores();
            
            // Ï¥àÍ∏∞ Î∞∞Ïπò ÏÑ§Ï†ï
            placeInitialPieces();
            
            // Îßµ ÌÉÄÏûÖÏóê Îî∞Î•∏ Î≤Ω Î∞∞Ïπò
            const wallCount = Math.floor(Math.random() * 
                (config.wallCount.max - config.wallCount.min + 1)) + config.wallCount.min;
            placeRandomWalls(wallCount);
            
            // Îã§Ï§ë Î™®ÎìúÏóêÏÑúÎßå Î∂ÑÏüÅ ÏßÄÏó≠ Î∞∞Ïπò
            if (game.gameMode === 'multi' && config.disputedCellCount > 0) {
                placeDisputedCells();
            }
            
            // Í≤åÏûÑ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            game.currentPlayer = game.playerOrder[0]; // Ï≤´ Î≤àÏß∏ ÌîåÎ†àÏù¥Ïñ¥Î∂ÄÌÑ∞ ÏãúÏûë
            game.turnCount = 1;
            game.lastMove = { x: -1, y: -1 };
            game.moveHistory = [];
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            renderBoard();
            updateInfo();
            updateSpecialFeatures();
            
            // Í≤∞Í≥º Î™®Îã¨ Ïà®Í∏∞Í∏∞
            resultModalEl.style.display = 'none';
            messageEl.textContent = '';
        }
        
        // Î∂ÑÏüÅ ÏßÄÏó≠ Î∞∞Ïπò
        function placeDisputedCells() {
            if (!disputedCellPositions[game.mapType]) return;
            
            // Îßµ ÌÉÄÏûÖÏóê Îî∞Î•∏ Î∂ÑÏüÅ ÏßÄÏó≠ ÏúÑÏπò ÏÑ§Ï†ï
            const positions = disputedCellPositions[game.mapType];
            
            // Î∂ÑÏüÅ ÏßÄÏó≠ ÏÑ§Ï†ï
            game.disputedCells = [];
            
            for (let i = 0; i < positions.length; i++) {
                const { x, y } = positions[i];
                // Ïú†Ìö®Ìïú ÏúÑÏπòÏù∏ÏßÄ ÌôïÏù∏
                if (x >= 0 && x < game.size.width && y >= 0 && y < game.size.height && 
                    game.activeCells[y][x]) {
                    game.disputedCells.push({ x, y });
                }
            }
        }
        // ÌäπÏàò Í∏∞Îä• UI ÏóÖÎç∞Ïù¥Ìä∏
        function updateSpecialFeatures() {
            // Îã§Ï§ë Î™®Îìú ÎòêÎäî ÏÜîÎ°ú Î™®Îìú Î™®ÎëêÏóêÏÑú Ïû•Î≤Ω ÌååÍ¥¥ Í∏∞Îä• ÌëúÏãú
            if (game.gameMode === 'multi' || game.gameMode === 'oneVsOne') {
                specialFeaturesEl.style.display = 'block';
                
                // Îã§Ï§ë Î™®ÎìúÏóêÏÑúÎßå ÌäπÏàò Í∏∞Îä• ÏÑ§Î™Ö ÌëúÏãú
                specialFeaturesInfoEl.style.display = game.gameMode === 'multi' ? 'block' : 'none';
                
                // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥Ïùò Ïû•Î≤Ω ÌååÍ¥¥ Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                if (!game.wallBreakUsed) game.wallBreakUsed = {}; // Ï¥àÍ∏∞Ìôî ÏïàÎêú Í≤ΩÏö∞ Ï≤òÎ¶¨
                if (!game.wallBreakUsed[game.currentPlayer]) game.wallBreakUsed[game.currentPlayer] = false;
                
                breakWallBtnEl.disabled = game.wallBreakUsed[game.currentPlayer] || 
                                         game.currentPlayer !== game.humanPlayer;
                
                // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥Ïùò Ïû•Î≤Ω ÎÜìÍ∏∞ Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                if (!game.wallPlaceUsed) game.wallPlaceUsed = {}; // Ï¥àÍ∏∞Ìôî ÏïàÎêú Í≤ΩÏö∞ Ï≤òÎ¶¨
                if (!game.wallPlaceUsed[game.currentPlayer]) game.wallPlaceUsed[game.currentPlayer] = false;
                
                // Îã§Ï§ë Î™®ÎìúÏóêÏÑúÎßå Ïû•Î≤Ω ÎÜìÍ∏∞ Î≤ÑÌäº ÌôúÏÑ±Ìôî
                placeWallBtnEl.style.display = game.gameMode === 'multi' ? 'inline-block' : 'none';
                
                placeWallBtnEl.disabled = game.wallPlaceUsed[game.currentPlayer] || 
                                         game.currentPlayer !== game.humanPlayer;
                
                // ÌäπÎ≥Ñ ÌÑ¥ ÌôïÏù∏ (Îã§Ï§ë Î™®ÎìúÏóêÏÑúÎßå 5Ïùò Î∞∞Ïàò ÌÑ¥Ïóê ÎåÄÍ∞ÅÏÑ† Ïù¥Îèô)
                game.isSpecialTurn = game.gameMode === 'multi' && game.turnCount % 5 === 0;
                
                if (game.isSpecialTurn) {
                    specialTurnMessageEl.style.display = 'block';
                } else {
                    specialTurnMessageEl.style.display = 'none';
                }
            } else {
                specialFeaturesEl.style.display = 'none';
                specialFeaturesInfoEl.style.display = 'none';
                specialTurnMessageEl.style.display = 'none';
                game.isSpecialTurn = false;
            }
        }
        
        // Ïû•Î≤Ω ÌååÍ¥¥ Î™®Îìú ÌÜ†Í∏Ä
        function toggleWallBreakMode() {
            if (game.isGameOver || game.currentPlayer !== game.humanPlayer) return;
            
            // Ïù¥ÎØ∏ ÏÇ¨Ïö©ÌñàÏúºÎ©¥ Î¶¨ÌÑ¥
            if (game.wallBreakUsed[game.humanPlayer]) {
                messageEl.textContent = 'Ïù¥ÎØ∏ Ïû•Î≤Ω ÌååÍ¥¥ Îä•Î†•ÏùÑ ÏÇ¨Ïö©ÌñàÏäµÎãàÎã§.';
                return;
            }
            
            // Ïû•Î≤Ω ÎÜìÍ∏∞ Î™®ÎìúÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏúºÎ©¥ ÎπÑÌôúÏÑ±Ìôî
            if (game.wallPlaceMode) {
                game.wallPlaceMode = false;
                boardEl.classList.remove('place-wall-mode');
                placeWallBtnEl.textContent = 'Ïû•Î≤Ω ÎÜìÍ∏∞';
            }
            
            if (!game.wallBreakMode) {
                // Ïû•Î≤Ω ÌååÍ¥¥ Î™®Îìú ÌôúÏÑ±Ìôî
                game.wallBreakMode = true;
                boardEl.classList.add('wall-break-mode');
                messageEl.textContent = 'ÌååÍ¥¥Ìï† Ïû•Î≤ΩÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî. Ï∑®ÏÜåÌïòÎ†§Î©¥ Îã§Ïãú Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî.';
                breakWallBtnEl.textContent = 'Ïû•Î≤Ω ÌååÍ¥¥ Ï∑®ÏÜå';
                
                // ÌååÍ¥¥ Í∞ÄÎä•Ìïú Î≤Ω Ï∞æÍ∏∞ (ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥Ïùò ÎßêÍ≥º Ïù∏Ï†ëÌïú Î≤Ω)
                findBreakableWalls();
                
                if (game.breakableWalls.length === 0) {
                    messageEl.textContent = 'Ïù∏Ï†ëÌïú Ïû•Î≤ΩÏù¥ ÏóÜÏäµÎãàÎã§.';
                    game.wallBreakMode = false;
                    boardEl.classList.remove('wall-break-mode');
                    breakWallBtnEl.textContent = 'Ïû•Î≤Ω ÌååÍ¥¥';
                } else {
                    // ÌååÍ¥¥ Í∞ÄÎä•Ìïú Î≤Ω ÌïòÏù¥ÎùºÏù¥Ìä∏
                    renderBoard();
                }
            } else {
                // Ïû•Î≤Ω ÌååÍ¥¥ Î™®Îìú ÎπÑÌôúÏÑ±Ìôî
                game.wallBreakMode = false;
                boardEl.classList.remove('wall-break-mode');
                messageEl.textContent = '';
                breakWallBtnEl.textContent = 'Ïû•Î≤Ω ÌååÍ¥¥';
                renderBoard();
            }
        }
        
        // Ïû•Î≤ΩÏùÑ ÎÜìÏùÑ Ïàò ÏûàÎäî ÏúÑÏπò Ï∞æÍ∏∞ Ìï®Ïàò (ÏÉàÎ°ú Ï∂îÍ∞Ä)
        function findPlacableWallPositions() {
            const placablePositions = [];
            const player = game.currentPlayer;
            
            // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥Ïùò Îßê ÏúÑÏπò Ï∞æÍ∏∞
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    if (game.board[y][x] === player) {
                        // ÏÉÅÌïòÏ¢åÏö∞ Ïù∏Ï†ë ÏÖÄ ÌôïÏù∏
                        const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
                        
                        for (const [dx, dy] of directions) {
                            const nx = x + dx;
                            const ny = y + dy;
                            
                            // Î≤îÏúÑ ÌôïÏù∏
                            if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                                // Îπà ÏÖÄÏù¥Í≥† ÌôúÏÑ± ÏÖÄÏù∏ÏßÄ ÌôïÏù∏
                                if (game.activeCells[ny][nx] && game.board[ny][nx] === '' && !game.visitedCells[ny][nx]) {
                                    // Ï§ëÎ≥µ Î∞©ÏßÄ ÌôïÏù∏
                                    const posExists = placablePositions.some(pos => 
                                        pos.x === nx && pos.y === ny);
                                    
                                    if (!posExists) {
                                        placablePositions.push({ x: nx, y: ny });
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            return placablePositions;
        }
        
        // Ïû•Î≤Ω ÎÜìÍ∏∞ Î™®Îìú ÌÜ†Í∏Ä (ÏàòÏ†ïÎê®)
        function toggleWallPlaceMode() {
            if (game.isGameOver || game.currentPlayer !== game.humanPlayer) return;
            
            // Ïù¥ÎØ∏ ÏÇ¨Ïö©ÌñàÏúºÎ©¥ Î¶¨ÌÑ¥
            if (game.wallPlaceUsed[game.humanPlayer]) {
                messageEl.textContent = 'Ïù¥ÎØ∏ Ïû•Î≤Ω ÎÜìÍ∏∞ Îä•Î†•ÏùÑ ÏÇ¨Ïö©ÌñàÏäµÎãàÎã§.';
                return;
            }
            
            // Ïû•Î≤Ω ÌååÍ¥¥ Î™®ÎìúÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏúºÎ©¥ ÎπÑÌôúÏÑ±Ìôî
            if (game.wallBreakMode) {
                game.wallBreakMode = false;
                boardEl.classList.remove('wall-break-mode');
                breakWallBtnEl.textContent = 'Ïû•Î≤Ω ÌååÍ¥¥';
            }
            
            if (!game.wallPlaceMode) {
                // Ïû•Î≤ΩÏùÑ ÎÜìÏùÑ Ïàò ÏûàÎäî ÏúÑÏπòÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
                const placableWallPositions = findPlacableWallPositions();
                
                if (placableWallPositions.length === 0) {
                    messageEl.textContent = 'Ïû•Î≤ΩÏùÑ ÎÜìÏùÑ Ïàò ÏûàÎäî ÏúÑÏπòÍ∞Ä ÏóÜÏäµÎãàÎã§.';
                    return;
                }
                
                // Ïû•Î≤Ω ÎÜìÍ∏∞ Î™®Îìú ÌôúÏÑ±Ìôî
                game.wallPlaceMode = true;
                game.placableWallPositions = placableWallPositions; // Í∞ÄÎä•Ìïú ÏúÑÏπò Ï†ÄÏû•
                boardEl.classList.add('place-wall-mode');
                messageEl.textContent = 'Ïû•Î≤ΩÏùÑ ÎÜìÏùÑ Í≥≥ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî. Ï∑®ÏÜåÌïòÎ†§Î©¥ Îã§Ïãú Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî.';
                placeWallBtnEl.textContent = 'Ïû•Î≤Ω ÎÜìÍ∏∞ Ï∑®ÏÜå';
                
                // Í∞ÄÎä•Ìïú ÏúÑÏπò ÌïòÏù¥ÎùºÏù¥Ìä∏
                renderBoard();
            } else {
                // Ïû•Î≤Ω ÎÜìÍ∏∞ Î™®Îìú ÎπÑÌôúÏÑ±Ìôî
                game.wallPlaceMode = false;
                game.placableWallPositions = [];
                boardEl.classList.remove('place-wall-mode');
                messageEl.textContent = '';
                placeWallBtnEl.textContent = 'Ïû•Î≤Ω ÎÜìÍ∏∞';
                renderBoard();
            }
        }
        
        // Ïû•Î≤Ω ÎÜìÍ∏∞ Ïã§Ìñâ (ÏàòÏ†ïÎê®)
        function placeWall(x, y) {
            if (game.isGameOver || !game.wallPlaceMode) return;
            
            // Ïú†Ìö®Ìïú ÏúÑÏπòÏù∏ÏßÄ ÌôïÏù∏ - ÏÜîÎ°ú Î™®ÎìúÏôÄ Îã§Ï§ë Î™®Îìú Î™®Îëê Í≥†Î†§
            if (game.placableWallPositions && game.placableWallPositions.length > 0) {
                // Îã§Ï§ë Î™®ÎìúÏóêÏÑúÎäî ÎØ∏Î¶¨ Í≥ÑÏÇ∞Îêú ÏúÑÏπòÎßå ÌóàÏö©
                const isPlacable = game.placableWallPositions.some(pos => 
                    pos.x === x && pos.y === y);
                
                if (!isPlacable) {
                    messageEl.textContent = 'Ïù¥ ÏúÑÏπòÏóêÎäî Ïû•Î≤ΩÏùÑ ÎÜìÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. ÏûêÏã†Ïùò Îßê Ï£ºÎ≥ÄÏóêÎßå ÎÜìÏùÑ Ïàò ÏûàÏäµÎãàÎã§.';
                    return;
                }
            } else {
                // ÏÜîÎ°ú Î™®ÎìúÏóêÏÑúÎäî Í∏∞Î≥∏ Í≤ÄÏÇ¨Îßå ÏàòÌñâ
                if (game.board[y][x] !== '' || game.visitedCells[y][x]) {
                    messageEl.textContent = 'Ïù¥ ÏúÑÏπòÏóêÎäî Ïû•Î≤ΩÏùÑ ÎÜìÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.';
                    return;
                }
            }
            
            // Ïû•Î≤Ω ÎÜìÍ∏∞
            game.board[y][x] = 'wall';
            game.visitedCells[y][x] = true;
            
            // Ïû•Î≤Ω ÎÜìÍ∏∞ ÏÇ¨Ïö© ÌëúÏãú
            game.wallPlaceUsed[game.currentPlayer] = true;
            game.wallPlaceMode = false;
            boardEl.classList.remove('place-wall-mode');
            placeWallBtnEl.textContent = 'Ïû•Î≤Ω ÎÜìÍ∏∞';
            
            messageEl.textContent = 'Ïû•Î≤ΩÏùÑ ÎÜìÏïòÏäµÎãàÎã§.';
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            renderBoard();
            updateSpecialFeatures();
            
            // ÌÑ¥ Ï¢ÖÎ£å
            endTurn();
        }
        
        // ÌååÍ¥¥ Í∞ÄÎä•Ìïú Î≤Ω Ï∞æÍ∏∞
        function findBreakableWalls() {
            game.breakableWalls = [];
            const player = game.currentPlayer;
            
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // ÌîåÎ†àÏù¥Ïñ¥ ÎßêÏù¥ ÏûàÎäî ÏÖÄ Ï∞æÍ∏∞
                    if (game.board[y][x] === player) {
                        // ÏÉÅÌïòÏ¢åÏö∞ Ïù∏Ï†ë ÏÖÄ ÌôïÏù∏
                        const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
                        
                        for (const [dx, dy] of directions) {
                            const nx = x + dx;
                            const ny = y + dy;
                            
                            // Î≤îÏúÑ ÌôïÏù∏
                            if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                                // Ïù∏Ï†ëÌïú Î≤Ω Ï∞æÍ∏∞
                                if (game.board[ny][nx] === 'wall' && game.activeCells[ny][nx]) {
                                    // Ï§ëÎ≥µ Î∞©ÏßÄ ÌôïÏù∏
                                    const wallExists = game.breakableWalls.some(wall => 
                                        wall.x === nx && wall.y === ny);
                                    
                                    if (!wallExists) {
                                        game.breakableWalls.push({ x: nx, y: ny });
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        
        // Î≤Ω ÌååÍ¥¥ Ïã§Ìñâ
        function breakWall(x, y) {
            if (game.isGameOver || !game.wallBreakMode) return;
            
            // ÌååÍ¥¥ Í∞ÄÎä•Ìïú Î≤ΩÏù∏ÏßÄ ÌôïÏù∏
            const isBreakable = game.breakableWalls.some(wall => 
                wall.x === x && wall.y === y);
            
            if (!isBreakable) {
                messageEl.textContent = 'Ïù¥ Ïû•Î≤ΩÏùÄ ÌååÍ¥¥Ìï† Ïàò ÏóÜÏäµÎãàÎã§.';
                return;
            }
            
            // Î≤Ω Ï†úÍ±∞ - Îπà ÏÖÄÎ°ú ÎßåÎì§Í≥† Î∞©Î¨∏ÌïòÏßÄ ÏïäÏùÄ ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
            game.board[y][x] = '';
            game.visitedCells[y][x] = false; // Î∞òÎìúÏãú falseÎ°ú ÏÑ§Ï†ïÌïòÏó¨ Ïù¥Îèô Í∞ÄÎä•ÌïòÍ≤å Ìï®
            
            // Ïû•Î≤Ω ÌååÍ¥¥ ÏÇ¨Ïö© ÌëúÏãú
            game.wallBreakUsed[game.currentPlayer] = true;
            game.wallBreakMode = false;
            boardEl.classList.remove('wall-break-mode');
            breakWallBtnEl.textContent = 'Ïû•Î≤Ω ÌååÍ¥¥'; // Î≤ÑÌäº ÌÖçÏä§Ìä∏ ÏõêÎ≥µ
            
            // Ïù¥Î≤à ÌÑ¥Ïóê Ïû•Î≤Ω ÌååÍ¥¥Î•º ÌñàÏùåÏùÑ ÌëúÏãú (ÏÉà Ïû•Î≤Ω ÏÉùÏÑ± Î∞©ÏßÄÏö©)
            game.wallBrokenThisTurn = true;
            
            messageEl.textContent = 'Ïû•Î≤Ω ÌååÍ¥¥ Îä•Î†•ÏùÑ ÏÇ¨Ïö©ÌñàÏäµÎãàÎã§. Îã§Ïùå ÌÑ¥Ïóê Ïù¥Îèô Í∞ÄÎä•Ìï©ÎãàÎã§.';
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            renderBoard();
            updateSpecialFeatures();
            
            // ÌÑ¥ Ï¢ÖÎ£å
            endTurn();
        }
// Ïù∏Ï†ëÌïú ÏÖÄ ÌôïÏù∏ (ÏàòÏ†ïÎê® - ÎåÄÍ∞ÅÏÑ† Ïû•Î≤Ω Í±¥ÎÑàÎõ∞Í∏∞ Î∞©ÏßÄ)
        function hasAdjacentCell(x, y, player) {
            // Í∏∞Î≥∏ Î∞©Ìñ• (ÏÉÅÌïòÏ¢åÏö∞)
            const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
            
            // ÌäπÎ≥Ñ ÌÑ¥Ïù¥Î©¥ ÎåÄÍ∞ÅÏÑ† Î∞©Ìñ•ÎèÑ Ï∂îÍ∞Ä
            if (game.isSpecialTurn) {
                directions.push([-1, -1], [-1, 1], [1, -1], [1, 1]);
            }
            
            for (const [dx, dy] of directions) {
                const nx = x + dx;
                const ny = y + dy;
                
                if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                    // ÎåÄÍ∞ÅÏÑ† Ïù¥ÎèôÏù∏ Í≤ΩÏö∞ Ïû•Î≤Ω Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä
                    if (Math.abs(dx) === 1 && Math.abs(dy) === 1) {
                        // ÎåÄÍ∞ÅÏÑ† Í≤ΩÎ°úÏóê Ïû•Î≤ΩÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
                        // ÎèÑÏ∞©Ìï† ÏúÑÏπòÏóê Ïû•Î≤ΩÏù¥ ÏûàÎäîÏßÄÎßå ÌôïÏù∏
                        const blockPath = game.board[ny][nx] === 'wall';
                        if (blockPath) {
                            continue; // ÎèÑÏ∞©Ìï† ÎåÄÍ∞ÅÏÑ† ÏúÑÏπòÏóê Ïû•Î≤ΩÏù¥ ÏûàÏúºÎ©¥ Ïù¥Îèô Î∂àÍ∞Ä
                        }
                    }
                    
                    if (game.board[ny][nx] === player) {
                        return true;
                    }
                }
            }
            
            return false;
        }

        // Ï£ºÎ≥Ä ÏÉÅÎåÄÎ∞© ÏÖÄ Í∞úÏàò ÏÑ∏Í∏∞ (ÎåÄÍ∞ÅÏÑ† Ïû•Î≤Ω Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä)
        function countAdjacentOpponentCells(x, y, player = game.currentPlayer) {
            // Í∏∞Î≥∏ Î∞©Ìñ• (ÏÉÅÌïòÏ¢åÏö∞)
            const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
            
            // ÌäπÎ≥Ñ ÌÑ¥Ïù¥Î©¥ ÎåÄÍ∞ÅÏÑ† Î∞©Ìñ•ÎèÑ Ï∂îÍ∞Ä
            if (game.isSpecialTurn) {
                directions.push([-1, -1], [-1, 1], [1, -1], [1, 1]);
            }
            
            let count = 0;
            
            for (const [dx, dy] of directions) {
                const nx = x + dx;
                const ny = y + dy;
                
                // Î≤îÏúÑ ÌôïÏù∏
                if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                    // ÎåÄÍ∞ÅÏÑ† Ïù¥ÎèôÏù∏ Í≤ΩÏö∞ Ïû•Î≤Ω Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä
                    if (Math.abs(dx) === 1 && Math.abs(dy) === 1) {
                        // ÎåÄÍ∞ÅÏÑ† Í≤ΩÎ°úÏóê Ïû•Î≤ΩÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
                        const blockPath = game.board[ny][nx] === 'wall';
                        if (blockPath) {
                            continue; // Ïû•Î≤ΩÏù¥ ÏûàÎäî ÎåÄÍ∞ÅÏÑ† Î∞©Ìñ•ÏùÄ Í±¥ÎÑàÎúÄ
                        }
                    }
                    
                    // ÏÉÅÎåÄÎ∞© ÏÖÄÎßå Ïπ¥Ïö¥Ìä∏
                    const cellValue = game.board[ny][nx];
                    if (cellValue && cellValue !== player && cellValue !== 'wall') {
                        count++;
                    }
                }
            }
            
            return count;
        }

        // Ï£ºÎ≥Ä ÏÉÅÎåÄÎ∞© ÏÖÄ Ìù°Ïàò (ÏàòÏ†ïÎê® - ÎåÄÍ∞ÅÏÑ† Î∞©Ìñ• ÏßÄÏõê Î∞è Ïû•Î≤Ω Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä, Ìù°Ïàò Ìö®Í≥º Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†ÅÏö©)
        function absorbAdjacentCells(x, y) {
            const player = game.currentPlayer;
            // Í∏∞Î≥∏ Î∞©Ìñ• (ÏÉÅÌïòÏ¢åÏö∞)
            const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
            
            // ÌäπÎ≥Ñ ÌÑ¥Ïù¥Î©¥ ÎåÄÍ∞ÅÏÑ† Î∞©Ìñ•ÎèÑ Ï∂îÍ∞Ä
            if (game.isSpecialTurn) {
                directions.push([-1, -1], [-1, 1], [1, -1], [1, 1]);
            }
            
            let capturedCells = 0;
            let cellsToCapture = []; // Ìù°ÏàòÌï† ÏÖÄ Î™©Î°ù Ï†ÄÏû•
            
            for (const [dx, dy] of directions) {
                const nx = x + dx;
                const ny = y + dy;
                
                // Î≤îÏúÑ ÌôïÏù∏
                if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                    // ÎåÄÍ∞ÅÏÑ† Ïù¥ÎèôÏù∏ Í≤ΩÏö∞ Ïû•Î≤Ω Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä
                    if (Math.abs(dx) === 1 && Math.abs(dy) === 1) {
                        // ÎåÄÍ∞ÅÏÑ† Í≤ΩÎ°úÏóê Ïû•Î≤ΩÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
                        const blockPath = game.board[ny][nx] === 'wall';
                        if (blockPath) {
                            continue; // Ïû•Î≤ΩÏù¥ ÏûàÎäî ÎåÄÍ∞ÅÏÑ† Î∞©Ìñ•ÏùÄ Í±¥ÎÑàÎúÄ
                        }
                    }
                    
                    // ÏÉÅÎåÄÎ∞© ÏÖÄÎßå Î≥ÄÍ≤Ω
                    const opponent = game.board[ny][nx];
                    if (opponent && opponent !== player && opponent !== 'wall') {
                        cellsToCapture.push({x: nx, y: ny, opponent: opponent});
                        capturedCells++;
                    }
                }
            }
            
            // Ìù°ÏàòÌï† ÏÖÄÏù¥ ÏûàÏúºÎ©¥ ÏßÄÏó∞ Ìö®Í≥ºÏôÄ Ìï®Íªò Ï≤òÎ¶¨
            if (cellsToCapture.length > 0) {
                captureWithDelay(cellsToCapture, 0, player);
            }
            
            return capturedCells;
        }

        // ÏßÄÏó∞ Ìö®Í≥ºÏôÄ Ìï®Íªò ÏÖÄ Ìù°ÏàòÌïòÎäî Ìï®Ïàò
        function captureWithDelay(cellsToCapture, index, player) {
            if (index >= cellsToCapture.length) return;
            
            const cell = cellsToCapture[index];
            
            // Ï†êÏàò ÏóÖÎç∞Ïù¥Ìä∏
            game.scores[player]++;
            game.scores[cell.opponent]--;
            
            // ÏÖÄ ÏÜåÏú†Í∂å Î≥ÄÍ≤Ω
            game.board[cell.y][cell.x] = player;
            
            // ÏÖÄ UI ÏóÖÎç∞Ïù¥Ìä∏ (Ìù°Ïàò Ìö®Í≥º ÏãúÍ∞ÅÌôîÎ•º ÏúÑÌï¥)
            const cellElement = document.querySelector(`.cell[data-x="${cell.x}"][data-y="${cell.y}"]`);
            if (cellElement) {
                // Í∏∞Ï°¥ ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                cellElement.classList.remove(cell.opponent);
                
                // Ìù°Ïàò Ìö®Í≥º Ïï†ÎãàÎ©îÏù¥ÏÖò ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                cellElement.classList.add('capturing');
                
                // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ ÏÉà ÏÜåÏú†Ïûê ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                setTimeout(() => {
                    cellElement.classList.remove('capturing');
                    cellElement.classList.add(player);
                    
                    // Ï†êÏàò ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                    updateScoresDisplay();
                    
                    // Îã§Ïùå ÏÖÄ Ï≤òÎ¶¨
                    captureWithDelay(cellsToCapture, index + 1, player);
                }, 200); // Í∞Å ÏÖÄÎßàÎã§ 200ms ÏßÄÏó∞
            } else {
                // ÏÖÄ ÏöîÏÜåÎ•º Ï∞æÏßÄ Î™ªÌïú Í≤ΩÏö∞ Îã§Ïùå ÏÖÄ Ï≤òÎ¶¨
                captureWithDelay(cellsToCapture, index + 1, player);
            }
        }
       
        // ÏÖÄ ÌÅ¥Î¶≠ Ï≤òÎ¶¨ Ìï®Ïàò ÏàòÏ†ï (Ìù°Ïàò Ìö®Í≥º ÏßÄÏó∞ÏúºÎ°ú Ïù∏Ìïú UI ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏ†ê Ï°∞Ï†ï Î∞è Ïû•Î≤Ω ÎÜìÍ∏∞ Í∏∞Îä• Ï∂îÍ∞Ä)
        function handleCellClick(x, y) {
            if (game.isGameOver || game.currentPlayer !== game.humanPlayer) {
                return;
            }
            
            // Ïû•Î≤Ω ÌååÍ¥¥ Î™®ÎìúÏù∏ Í≤ΩÏö∞
            if (game.wallBreakMode) {
                if (game.board[y][x] === 'wall') {
                    breakWall(x, y);
                } else {
                    messageEl.textContent = 'Ïû•Î≤ΩÎßå ÌååÍ¥¥Ìï† Ïàò ÏûàÏäµÎãàÎã§.';
                }
                return;
            }
            
            // Ïû•Î≤Ω ÎÜìÍ∏∞ Î™®ÎìúÏù∏ Í≤ΩÏö∞
            if (game.wallPlaceMode) {
                placeWall(x, y);
                return;
            }
            
            const value = game.board[y][x];
            
            // Î≤ΩÏù¥ÎÇò ÏûêÍ∏∞ ÏòÅÏó≠ÏùÄ ÏÑ†ÌÉù Î∂àÍ∞Ä
            if (value === 'wall' || value === game.currentPlayer) {
                return;
            }
            
            // Î∂ÑÏüÅ ÏßÄÏó≠Ïù¥ ÏïÑÎãàÍ≥† Ïù¥ÎØ∏ Î∞©Î¨∏Ìïú ÏÖÄÏù∏ÏßÄ ÌôïÏù∏
            const isDisputedCell = game.disputedCells.some(cell => cell.x === x && cell.y === y);
            
            if (!isDisputedCell && game.visitedCells[y][x]) {
                messageEl.textContent = 'Ïù¥ÎØ∏ Î∞©Î¨∏Ìïú Í≥≥ÏûÖÎãàÎã§. Îã§Î•∏ Í≥≥ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.';
                return;
            }
            
            // Ïù∏Ï†ëÌïú ÏÖÄ ÌôïÏù∏
            if (!hasAdjacentCell(x, y, game.currentPlayer)) {
                messageEl.textContent = 'Ïù∏Ï†ëÌïú Ïπ∏ÏóêÎßå ÎÜìÏùÑ Ïàò ÏûàÏäµÎãàÎã§.';
                return;
            }
            
            // Îπà ÏÖÄÏù¥ÎÇò ÏÉÅÎåÄÎ∞© ÏòÅÏó≠ Ï†êÎ†π
            if (value === '' || game.playerOrder.includes(value)) {
                // ÏÉÅÎåÄÎ∞© ÏòÅÏó≠Ïù¥Î©¥ Ï†êÏàò Ï°∞Ï†ï
                if (value && value !== game.currentPlayer) {
                    game.scores[value]--;
                }
                
                // ÏÑ†ÌÉùÌïú ÏÖÄ Ï†êÎ†π
                game.board[y][x] = game.currentPlayer;
                game.scores[game.currentPlayer]++;
                
                // Î∞©Î¨∏Ìïú ÏÖÄÎ°ú ÌëúÏãú (Î∂ÑÏüÅ ÏßÄÏó≠ÏùÄ ÏòàÏô∏)
                if (!isDisputedCell) {
                    game.visitedCells[y][x] = true;
                }
                
                // ÏÑ∏Í∑†Ï†Ñ Î∞©ÏãùÏúºÎ°ú Ï£ºÎ≥Ä ÏÉÅÎåÄÎ∞© ÏÖÄ Ìù°Ïàò (Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†ÅÏö©)
                const capturedCells = absorbAdjacentCells(x, y);
                
                // ÎßàÏßÄÎßâ Ïù¥Îèô ÏúÑÏπò Í∏∞Î°ù
                game.lastMove = { x, y };
                
                // Ïù¥Îèô Í∏∞Î°ù Ï∂îÍ∞Ä
                game.moveHistory.push({ x, y, player: game.currentPlayer });
                
                if (capturedCells > 0) {
                    messageEl.textContent = `${capturedCells}Í∞úÏùò ÏÉÅÎåÄÎ∞© ÎßêÏùÑ Ìù°ÏàòÌï©ÎãàÎã§...`;
                } else {
                    messageEl.textContent = '';
                }
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                renderBoard();
                updateInfo();
                
                // Ìù°Ïàò Ïï†ÎãàÎ©îÏù¥ÏÖòÏù¥ ÎÅùÎÇ† ÎïåÍπåÏßÄ Í∏∞Îã§Î¶∞ ÌõÑ ÌÑ¥ Ï¢ÖÎ£å
                // ÏÖÄ Ïàò √ó 200ms + Ïó¨Ïú†ÏãúÍ∞Ñ 300ms
                const delayTime = capturedCells > 0 ? capturedCells * 200 + 300 : 100;
                
                setTimeout(() => {
                    // Ï†êÏàò Ïû¨Í≥ÑÏÇ∞
                    recalculateScores();
                    
                    // Î©îÏãúÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                    if (capturedCells > 0) {
                        messageEl.textContent = `${capturedCells}Í∞úÏùò ÏÉÅÎåÄÎ∞© ÎßêÏùÑ Ìù°ÏàòÌñàÏäµÎãàÎã§!`;
                    }
                    
                    // Î™®Îì† Ìù°ÏàòÍ∞Ä ÎÅùÎÇ¨ÏùÑ Îïå ÌÑ¥ Ï¢ÖÎ£å
                    setTimeout(() => {
                        endTurn(); // ÌÑ¥ Ï¢ÖÎ£å Ï≤òÎ¶¨
                    }, 300);
                }, delayTime);
            }
        }
// Ïª¥Ìì®ÌÑ∞ ÌÑ¥ ÏàòÏ†ï - ÏÜçÎèÑ Ï°∞Ï†à Î∞è Ìù°Ïàò Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†ÅÏö©, Ïû•Î≤Ω ÎÜìÍ∏∞ Í∏∞Îä• Ï∂îÍ∞Ä
        function computerTurn() {
            if (game.isGameOver || !game.computerPlayers.includes(game.currentPlayer)) {
                return;
            }
            
            // Îã§Ï§ë Î™®ÎìúÏóêÏÑú AI ÌîåÎ†àÏù¥Ïñ¥Ïùò Ïû•Î≤Ω ÎÜìÍ∏∞ Îä•Î†• ÏÇ¨Ïö© Í≤∞Ï†ï
            if (game.gameMode === 'multi' && !game.wallPlaceUsed[game.currentPlayer]) {
            if (Math.random() < 0.3) {
                // Ïû•Î≤ΩÏùÑ ÎÜìÏùÑ Ïàò ÏûàÎäî ÏúÑÏπò Ï∞æÍ∏∞
                const placableWallPositions = findPlacableWallPositions();
                
                if (placableWallPositions.length > 0) {
                    // Ï†ÑÎûµÏ†ÅÏúºÎ°ú Ïû•Î≤Ω Î∞∞Ïπò - ÏûêÏã†Ïùò Îßê Ï£ºÎ≥ÄÏóêÏÑú ÏÑ†ÌÉù
                    const scoredPositions = placableWallPositions.map(pos => {
                        // Ïû•Î≤Ω Î∞∞Ïπò Í∞ÄÏ§ëÏπò Í≥ÑÏÇ∞
                        let score = 0;
                        
                        // Ï£ºÎ≥Ä ÌîåÎ†àÏù¥Ïñ¥ ÌôïÏù∏
                        const directions = [[-1, 0], [1, 0], [0, -1], [0, 1], [-1, -1], [-1, 1], [1, -1], [1, 1]];
                        
                        // ÏÉÅÎåÄÎ∞© Îßê Í∑ºÏ≤òÏù∏ÏßÄ ÌôïÏù∏
                        let opponentNearby = false;
                        // ÏûêÏã†Ïùò Îßê Í∑ºÏ≤òÏù∏ÏßÄ ÌôïÏù∏
                        let selfNearby = false;
                        // Í∏∞Ï°¥ Ïû•Î≤Ω Í∑ºÏ≤òÏù∏ÏßÄ ÌôïÏù∏
                        let wallNearby = false;
                        
                        for (const [dx, dy] of directions) {
                            const nx = pos.x + dx;
                            const ny = pos.y + dy;
                            if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                                const cell = game.board[ny][nx];
                                // ÏÉÅÎåÄÎ∞© ÎßêÏóê Í∞ÄÍπùÍ≤å Î∞∞Ïπò
                                if (cell && cell !== game.currentPlayer && cell !== 'wall') {
                                    score += 2;
                                    opponentNearby = true;
                                }
                                // ÏûêÏã†Ïùò Îßê Í∑ºÏ≤ò ÌôïÏù∏
                                else if (cell === game.currentPlayer) {
                                    selfNearby = true;
                                }
                                // Í∏∞Ï°¥ Ïû•Î≤Ω Í∑ºÏ≤ò ÌôïÏù∏
                                else if (cell === 'wall') {
                                    wallNearby = true;
                                    score -= 3; // Í∏∞Ï°¥ Ïû•Î≤Ω Í∑ºÏ≤òÎäî ÌîºÌïòÎèÑÎ°ù ÌéòÎÑêÌã∞
                                }
                            }
                        }
                        
                        // Ïû•Î≤ΩÏùÑ ÌååÍ¥¥ÌïòÍ≥† Ïã∂ÏùÑ Ïàò ÏûàÎäî ÏúÑÏπòÎäî ÌîºÌïòÍ∏∞
                        if (selfNearby && opponentNearby) {
                            score += 5; // ÏûêÏã†Í≥º ÏÉÅÎåÄÎ∞© ÏÇ¨Ïù¥Ïóê Ïû•Î≤Ω ÎÜìÍ∏∞
                        }
                        
                        // Ïù¥ÎØ∏ Ïû•Î≤ΩÏù¥ ÏûàÎäî Í≥≥ Í∑ºÏ≤òÎäî ÌîºÌïòÍ∏∞
                        if (wallNearby) {
                            score -= 3;
                        }
                        
                        // Í∞ÄÏû•ÏûêÎ¶¨Ïóê Í∞ÄÍπåÏö∏ÏàòÎ°ù Ï†êÏàò Ï¶ùÍ∞Ä
                        if (pos.x === 0 || pos.x === game.size.width - 1 || pos.y === 0 || pos.y === game.size.height - 1) {
                            score += 1;
                        }
                        
                        return {...pos, score};
                    });
                    
                    // ÏµúÏÜå Ï†êÏàò ÏûÑÍ≥ÑÍ∞í ÏÑ§Ï†ï
                    const minScoreThreshold = 2;
                    
                    // Ï†êÏàòÍ∞Ä ÏûÑÍ≥ÑÍ∞íÎ≥¥Îã§ ÎÜíÏùÄ ÏúÑÏπòÎßå ÌïÑÌÑ∞ÎßÅ
                    const goodPositions = scoredPositions.filter(pos => pos.score >= minScoreThreshold);
                    
                    if (goodPositions.length > 0) {
                        // Ï†êÏàòÎ≥ÑÎ°ú Ï†ïÎ†¨
                        goodPositions.sort((a, b) => b.score - a.score);
                        
                        // ÏÉÅÏúÑ 3Í∞ú Ï§ëÏóêÏÑú ÏÑ†ÌÉù (Îã§ÏñëÏÑ±ÏùÑ ÏúÑÌï¥)
                        const selectedIndex = Math.floor(Math.random() * Math.min(3, goodPositions.length));
                        const cell = goodPositions[selectedIndex];
                        
                        // Ïû•Î≤Ω Î∞∞Ïπò
                        game.board[cell.y][cell.x] = 'wall';
                        game.visitedCells[cell.y][cell.x] = true;
                        game.wallPlaceUsed[game.currentPlayer] = true;
                        
                        messageEl.textContent = `Ïª¥Ìì®ÌÑ∞(${playerInfo[game.currentPlayer].displayName})Í∞Ä Ïû•Î≤ΩÏùÑ ÎÜìÏïòÏäµÎãàÎã§!`;
                        
                        // UI ÏóÖÎç∞Ïù¥Ìä∏
                        renderBoard();
                        updateSpecialFeatures();
                        
                        // ÌÑ¥ Ï¢ÖÎ£å - ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ Ï∂îÍ∞Ä
                        setTimeout(() => {
                            endTurn();
                        }, 800);
                        return;
                    }
                }
            }
        }
            
            // AI ÌîåÎ†àÏù¥Ïñ¥Ïùò Ïû•Î≤Ω ÌååÍ¥¥ Îä•Î†• ÏÇ¨Ïö© Í≤∞Ï†ï
            if ((game.gameMode === 'multi' || game.gameMode === 'oneVsOne') && !game.wallBreakUsed[game.currentPlayer]) {
            // 50% ÌôïÎ•†Î°ú Ïû•Î≤Ω ÌååÍ¥¥ ÏãúÎèÑ (ÌôïÎ•† Ï°∞Ï†ï)
            if (Math.random() < 0.5) {
                // ÌååÍ¥¥ Í∞ÄÎä•Ìïú Ïû•Î≤Ω Ï∞æÍ∏∞
                findBreakableWalls();
                
                if (game.breakableWalls.length > 0) {
                    // Ï†ÑÎûµÏ†ÅÏúºÎ°ú Ïû•Î≤Ω ÏÑ†ÌÉù (Í∞ÄÏû• ÎßéÏùÄ Ïù¥ÎèôÏÑ±ÏùÑ Ï†úÍ≥µÌïòÎäî Î≤Ω)
                    let bestWall = null;
                    let bestScore = 0; // ÏµúÏÜå Ï†êÏàò ÏûÑÍ≥ÑÍ∞í ÏÑ§Ï†ï
                    
                    for (const wall of game.breakableWalls) {
                        const score = countNewAccessibleCells(wall.x, wall.y);
                        
                        // ÎßàÏßÄÎßâ ÌÑ¥Ïóê ÎÜìÏùÄ Ïû•Î≤ΩÏù∏ÏßÄ ÌôïÏù∏ (ÏûêÏã†Ïù¥ ÎÜìÏùÄ Ïû•Î≤Ω ÌååÍ¥¥ Î∞©ÏßÄ)
                        let isRecentlyPlaced = false;
                        if (game.moveHistory.length > 0) {
                            const lastMove = game.moveHistory[game.moveHistory.length - 1];
                            if (lastMove.player !== game.currentPlayer && 
                                game.wallPlaceUsed[lastMove.player] && 
                                Math.abs(wall.x - lastMove.x) <= 1 && 
                                Math.abs(wall.y - lastMove.y) <= 1) {
                                isRecentlyPlaced = true;
                            }
                        }
                        
                        // ÏµúÍ∑ºÏóê ÎÜìÏùÄ Ïû•Î≤ΩÏù¥Í±∞ÎÇò Ï†ëÍ∑ºÏÑ±Ïù¥ ÎÇÆÏúºÎ©¥ Í±¥ÎÑàÎõ∞Í∏∞
                        if (isRecentlyPlaced || score <= 1) {
                            continue;
                        }
                        
                        if (score > bestScore) {
                            bestScore = score;
                            bestWall = wall;
                        }
                    }
                    
                    // Ï¢ãÏùÄ Ï†êÏàòÍ∞Ä ÏûàÏùÑ ÎïåÎßå ÌååÍ¥¥
                    if (bestWall && bestScore >= 2) {
                        // Ïû•Î≤Ω ÌååÍ¥¥
                        game.board[bestWall.y][bestWall.x] = '';
                        game.visitedCells[bestWall.y][bestWall.x] = false;
                        
                        // Ïû•Î≤Ω ÌååÍ¥¥ ÏÇ¨Ïö© ÌëúÏãú
                        game.wallBreakUsed[game.currentPlayer] = true;
                        
                        // Ïù¥Î≤à ÌÑ¥Ïóê Ïû•Î≤Ω ÌååÍ¥¥Î•º ÌñàÏùåÏùÑ ÌëúÏãú (ÏÉà Ïû•Î≤Ω ÏÉùÏÑ± Î∞©ÏßÄÏö©)
                        game.wallBrokenThisTurn = true;
                        
                        messageEl.textContent = `Ïª¥Ìì®ÌÑ∞(${playerInfo[game.currentPlayer].displayName})Í∞Ä Ïû•Î≤ΩÏùÑ ÌååÍ¥¥ÌñàÏäµÎãàÎã§!`;
                        
                        // UI ÏóÖÎç∞Ïù¥Ìä∏
                        renderBoard();
                        updateSpecialFeatures();
                        
                        // ÌÑ¥ Ï¢ÖÎ£å - ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ Ï∂îÍ∞Ä
                        setTimeout(() => {
                            endTurn();
                        }, 800);
                        return;
                    }
                }
            }
        }
            
            // Í∞ÄÎä•Ìïú Ïù¥Îèô Ï∞æÍ∏∞
            const validMoves = findValidMoves(game.currentPlayer);
            
            if (validMoves.length > 0) {
                // Ï†êÏàò Í∏∞Ï§Ä Ï†ïÎ†¨
                validMoves.sort((a, b) => b.score - a.score);
                
                // ÏµúÍ≥† Ï†êÏàò Ïù¥Îèô ÏÑ†ÌÉù (Ï†ÑÎûµÏ†Å ÎûúÎç§ÏÑ± Í∞êÏÜå)
                let selectedIndex = 0;
                
                // 15% ÌôïÎ•†Î°úÎßå ÎûúÎç§ ÏöîÏÜå Ï†ÅÏö© (Í∏∞Ï°¥Î≥¥Îã§ ÎÇÆÏùÄ ÌôïÎ•†)
                if (Math.random() < 0.15 && validMoves.length > 1) {
                    // ÏÉÅÏúÑ 3Í∞ú Ï§ëÏóêÏÑúÎßå ÏÑ†ÌÉùÌïòÎèÑÎ°ù Ï†úÌïú
                    selectedIndex = Math.floor(Math.random() * Math.min(3, validMoves.length));
                }
                
                const move = validMoves[selectedIndex];
                
                // ÏÉÅÎåÄÎ∞© ÏòÅÏó≠Ïù¥Î©¥ Ï†êÏàò Ï°∞Ï†ï
                const opponent = game.board[move.y][move.x];
                if (opponent && opponent !== game.currentPlayer) {
                    game.scores[opponent]--;
                }
                
                // Ïù¥Îèô Ïã§Ìñâ
                game.board[move.y][move.x] = game.currentPlayer;
                game.scores[game.currentPlayer]++;
                
                // Î∞©Î¨∏Ìïú ÏÖÄÎ°ú ÌëúÏãú (Î∂ÑÏüÅ ÏßÄÏó≠ÏùÄ ÏòàÏô∏)
                const isDisputedCell = game.disputedCells.some(cell => 
                    cell.x === move.x && cell.y === move.y);
                
                if (!isDisputedCell) {
                    game.visitedCells[move.y][move.x] = true;
                }
                
                // ÎßàÏßÄÎßâ Ïù¥Îèô ÏúÑÏπò Í∏∞Î°ù
                game.lastMove = { x: move.x, y: move.y };
                
                // Ïù¥Îèô Í∏∞Î°ù Ï∂îÍ∞Ä
                game.moveHistory.push({ x: move.x, y: move.y, player: game.currentPlayer });
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                renderBoard();
                updateInfo();
                
                // Ï£ºÎ≥Ä ÏÉÅÎåÄÎ∞© ÏÖÄ Ìù°Ïàò (Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†ÅÏö©)
                const capturedCells = absorbAdjacentCells(move.x, move.y);
                
                if (capturedCells > 0) {
                    messageEl.textContent = `Ïª¥Ìì®ÌÑ∞(${playerInfo[game.currentPlayer].displayName})Í∞Ä ${capturedCells}Í∞úÏùò ÎßêÏùÑ Ìù°ÏàòÌïòÍ≥† ÏûàÏäµÎãàÎã§...`;
                    
                    // Ìù°Ïàò Ïï†ÎãàÎ©îÏù¥ÏÖòÏù¥ ÎÅùÎÇ† ÎïåÍπåÏßÄ Í∏∞Îã§Î¶∞ ÌõÑ ÌÑ¥ Ï¢ÖÎ£å
                    // ÏÖÄ Ïàò √ó 200ms + Ïó¨Ïú†ÏãúÍ∞Ñ 500ms
                    const delayTime = capturedCells * 200 + 500;
                    
                    setTimeout(() => {
                        messageEl.textContent = `Ïª¥Ìì®ÌÑ∞(${playerInfo[game.currentPlayer].displayName})Í∞Ä ${capturedCells}Í∞úÏùò ÎßêÏùÑ Ìù°ÏàòÌñàÏäµÎãàÎã§!`;
                        
                        // Ï†êÏàò Ïû¨Í≥ÑÏÇ∞
                        recalculateScores();
                        
                        // Î™®Îì† Ìù°ÏàòÍ∞Ä ÎÅùÎÇ¨ÏùÑ Îïå ÌÑ¥ Ï¢ÖÎ£å
                        setTimeout(() => {
                            endTurn();
                        }, 500);
                    }, delayTime);
                } else {
                    messageEl.textContent = `Ïª¥Ìì®ÌÑ∞(${playerInfo[game.currentPlayer].displayName})Í∞Ä Ïù¥ÎèôÌñàÏäµÎãàÎã§`;
                    
                    // ÌÑ¥ Ï¢ÖÎ£å - ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ Ï∂îÍ∞Ä
                    setTimeout(() => {
                        endTurn();
                    }, 800);
                }
            } else {
                messageEl.textContent = `Ïª¥Ìì®ÌÑ∞(${playerInfo[game.currentPlayer].displayName})Í∞Ä Ïù¥ÎèôÌï† Í≥≥Ïù¥ ÏóÜÏäµÎãàÎã§`;
                // ÌÑ¥ Ï¢ÖÎ£å - ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ Ï∂îÍ∞Ä
                setTimeout(() => {
                    endTurn();
                }, 800);
            }
        }
        // Ïú†Ìö®Ìïú Ïù¥Îèô Î™©Î°ù Ï∞æÍ∏∞ (ÏàòÏ†ïÎê®)
        function findValidMoves(player) {
            const validMoves = [];
            
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // ÌôúÏÑ± ÏÖÄÏù∏ÏßÄ ÌôïÏù∏
                    if (!game.activeCells[y][x]) continue;
                    
                    // Î∂ÑÏüÅ ÏßÄÏó≠Ïù∏ÏßÄ ÌôïÏù∏
                    const isDisputedCell = game.disputedCells.some(cell => cell.x === x && cell.y === y);
                    
                    // Î∂ÑÏüÅ ÏßÄÏó≠Ïù¥ ÏïÑÎãàÎ©¥ÏÑú Ïù¥ÎØ∏ Î∞©Î¨∏Ìïú ÏÖÄÏù¥Î©¥ Ï†úÏô∏
                    if (!isDisputedCell && game.visitedCells[y][x]) continue;
                    
                    // Îπà Ïπ∏Ïù¥ÎÇò ÏÉÅÎåÄ ÏòÅÏó≠Ïù∏ÏßÄ ÌôïÏù∏
                    if (game.board[y][x] === '' || 
                        (game.board[y][x] !== player && game.board[y][x] !== 'wall')) {
                        
                        // Ïù∏Ï†ëÌïú ÏÖÄ ÌôïÏù∏
                        if (hasAdjacentCell(x, y, player)) {
                            // Ï†êÏàò Í≥ÑÏÇ∞: ÏñºÎßàÎÇò ÎßéÏùÄ ÏÉÅÎåÄ ÏÖÄÏùÑ Ìù°ÏàòÌï† Ïàò ÏûàÎäîÏßÄ
                            let absorptionScore = countAdjacentOpponentCells(x, y, player);
                            
                            // Í∏∞Î≥∏ Ï†êÏàò + Ìù°Ïàò Ï†êÏàò
                            let score = 1 + absorptionScore * 2; // Ìù°Ïàò Ï†êÏàò Í∞ÄÏ§ëÏπò 2Î∞∞ Ï¶ùÍ∞Ä
                            
                            // ÏÉÅÎåÄÎ∞© ÏòÅÏó≠Ïù¥Î©¥ Ï∂îÍ∞Ä Ï†êÏàò
                            if (game.board[y][x] && game.board[y][x] !== player) {
                                score += 2; // Í∏∞Ï°¥ 1ÏóêÏÑú 2Î°ú Ï¶ùÍ∞Ä
                                
                                // Ï†êÏàòÍ∞Ä Í∞ÄÏû• ÎÜíÏùÄ ÌîåÎ†àÏù¥Ïñ¥Î•º Í≥µÍ≤©ÌïòÎ©¥ Ï∂îÍ∞Ä Ï†êÏàò
                                const maxScore = Math.max(...Object.values(game.scores));
                                if (game.scores[game.board[y][x]] === maxScore) {
                                    score += 4; // 1Îì± Í≥µÎûµ Í∞ÄÏ§ëÏπò Ï¶ùÍ∞Ä
                                }
                            }
        
                            // Ï†ÑÎûµÏ†Å Ï†êÏàò Ï°∞Ï†ï
                            // 1. ÏΩîÎÑàÎÇò Í∞ÄÏû•ÏûêÎ¶¨Îäî Í∞ÄÏπòÍ∞Ä ÎÜíÏùå
                            if ((x === 0 || x === game.size.width-1) && (y === 0 || y === game.size.height-1)) {
                                // ÏΩîÎÑà
                                score += 5; // Í∏∞Ï°¥ 3ÏóêÏÑú 5Î°ú Ï¶ùÍ∞Ä
                            } else if (x === 0 || x === game.size.width-1 || y === 0 || y === game.size.height-1) {
                                // Í∞ÄÏû•ÏûêÎ¶¨
                                score += 3; // Í∏∞Ï°¥ 1ÏóêÏÑú 3ÏúºÎ°ú Ï¶ùÍ∞Ä
                            }
                            
                            // 2. Î∂ÑÏüÅ ÏßÄÏó≠ÏùÄ Ï†ÑÎûµÏ†ÅÏúºÎ°ú Ï§ëÏöîÌï®
                            if (isDisputedCell) {
                                score += 6; // Í∏∞Ï°¥ 4ÏóêÏÑú 6ÏúºÎ°ú Ï¶ùÍ∞Ä
                            }
                            
                            // 3. ÎåÄÍ∞ÅÏÑ† Ïù¥ÎèôÏù¥ Í∞ÄÎä•Ìïú ÌäπÎ≥Ñ ÌÑ¥ÏóêÏÑúÎäî ÎåÄÍ∞ÅÏÑ† Ïù¥ÎèôÏóê Î≥¥ÎÑàÏä§
                            if (game.isSpecialTurn) {
                                // ÎåÄÍ∞ÅÏÑ† Î∞©Ìñ• ÌôïÏù∏
                                const isDiagonalMove = game.moveHistory.length > 0 && 
                                    Math.abs(x - game.lastMove.x) === 1 && 
                                    Math.abs(y - game.lastMove.y) === 1;
                                
                                if (isDiagonalMove) {
                                    score += 3; // Í∏∞Ï°¥ 2ÏóêÏÑú 3ÏúºÎ°ú Ï¶ùÍ∞Ä
                                }
                            }
                            
                            // 4. Í≤åÏûÑ ÏßÑÌñâ ÏÉÅÌô©Ïóê Îî∞Î•∏ Ï†ÑÎûµ Î≥ÄÍ≤Ω
                            if (game.turnCount > 10) {
                                // Í≤åÏûÑ ÌõÑÎ∞òÏóêÎäî Îçî Í≥µÍ≤©Ï†ÅÏúºÎ°ú
                                
                                // Ï†êÏàòÍ∞Ä Í∞ÄÏû• ÎÜíÏùÄ ÌîåÎ†àÏù¥Ïñ¥ Ï∞æÍ∏∞
                                const maxScore = Math.max(...Object.values(game.scores));
                                const topPlayers = game.playerOrder.filter(p => game.scores[p] === maxScore);
                                
                                if (game.scores[player] < maxScore) {
                                    // ÏßÄÍ≥† ÏûàÏùÑ ÎïåÎäî Îçî ÏúÑÌóòÌïú Ïù¥ÎèôÎèÑ Í∞êÏàò
                                    score += absorptionScore * 2; // Ìù°Ïàò Ï†êÏàòÎ•º Îëê Î∞∞Î°ú
                                    
                                    // 1Îì± ÌîåÎ†àÏù¥Ïñ¥Î•º Í≥µÍ≤©Ìï† Í∏∞ÌöåÍ∞Ä ÏûàÏúºÎ©¥ Ï∂îÍ∞Ä Ï†êÏàò
                                    if (game.board[y][x] && topPlayers.includes(game.board[y][x])) {
                                        score += 8; // Í∏∞Ï°¥ 5ÏóêÏÑú 8Î°ú Ï¶ùÍ∞Ä
                                    }
                                } else if (topPlayers.includes(player)) {
                                    // 1Îì±Ïùº ÎïåÎäî Î∞©Ïñ¥Ï†ÅÏúºÎ°ú
                                    // ÏΩîÎÑàÎÇò Í∞ÄÏû•ÏûêÎ¶¨ ÏÑ†Ìò∏
                                    if ((x === 0 || x === game.size.width-1) || (y === 0 || y === game.size.height-1)) {
                                        score += 4; // Í∏∞Ï°¥ 2ÏóêÏÑú 4Î°ú Ï¶ùÍ∞Ä
                                    }
                                }
                            }
                            
                            // 5. ÏïàÏ†ÑÌïú Ïù¥Îèô ÏÑ†Ìò∏ (Ïù∏Ï†ëÌïú Î≤ΩÏù¥ ÎßéÏùÄ ÏúÑÏπò)
                            let wallCount = 0;
                            const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
                            for (const [dx, dy] of directions) {
                                const nx = x + dx;
                                const ny = y + dy;
                                if (nx < 0 || ny < 0 || nx >= game.size.width || ny >= game.size.height || 
                                    game.board[ny][nx] === 'wall') {
                                    wallCount++;
                                }
                            }
                            score += wallCount * 2; // Ïù∏Ï†ëÌïú Î≤ΩÎßàÎã§ +2Ï†ê
                            
                            // Îã§Ï§ë Î™®ÎìúÏóêÏÑúÏùò Ï∂îÍ∞Ä Ï†ÑÎûµ
                            if (game.gameMode === 'multi') {
                                // ÏïΩÌïú ÌîåÎ†àÏù¥Ïñ¥ Í≥µÎûµ
                                const weakPlayers = game.playerOrder.filter(p => 
                                    p !== player && game.scores[p] > 0 && game.scores[p] < game.scores[player] / 2);
                                
                                if (game.board[y][x] && weakPlayers.includes(game.board[y][x])) {
                                    score += 5; // ÏïΩÌïú ÌîåÎ†àÏù¥Ïñ¥ Í≥µÎûµÏóê Ï∂îÍ∞Ä Ï†êÏàò
                                }
                            }
                            
                            validMoves.push({x, y, score});
                        }
                    }
                }
            }
            
            return validMoves;
        }
        // Ïû•Î≤Ω Ï†úÍ±∞ ÌõÑ ÏÉàÎ°ú Ï†ëÍ∑º Í∞ÄÎä•Ìïú ÏÖÄ Ïàò Í≥ÑÏÇ∞
        function countNewAccessibleCells(wallX, wallY) {
            let count = 0;
            
            // ÌòÑÏû¨ ÏÉÅÌÉú Î∞±ÏóÖ
            const originalBoard = JSON.parse(JSON.stringify(game.board));
            const originalVisitedCells = JSON.parse(JSON.stringify(game.visitedCells));
            
            // ÏãúÎÆ¨Î†àÏù¥ÏÖò: Ïû•Î≤Ω Ï†úÍ±∞
            game.board[wallY][wallX] = '';
            game.visitedCells[wallY][wallX] = false;
            
            // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥Ïùò Ïù¥Îèô Í∞ÄÎä• ÏúÑÏπò ÌôïÏù∏
            const player = game.currentPlayer;
            
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // ÌôúÏÑ± ÏÖÄÏù∏ÏßÄ ÌôïÏù∏
                    if (!game.activeCells[y][x]) continue;
                    
                    // Îπà Ïπ∏Ïù¥Ïñ¥Ïïº Ìï®
                    if (game.board[y][x] === '' && !game.visitedCells[y][x]) {
                        // Ïù∏Ï†ëÌïú ÏÖÄ ÌôïÏù∏
                        if (hasAdjacentCell(x, y, player)) {
                            count++;
                        }
                    }
                }
            }
            
            // ÏÉÅÌÉú Î≥µÏõê
            game.board = originalBoard;
            game.visitedCells = originalVisitedCells;
            
            return count;
        }
// ÌôúÏÑ± ÏÖÄ ÌÖúÌîåÎ¶ø ÏÑ§Ï†ï
        function setActiveCellsFromTemplate(template) {
            for (let y = 0; y < template.length; y++) {
                for (let x = 0; x < template[y].length; x++) {
                    game.activeCells[y][x] = template[y][x] === 1;
                    if (!game.activeCells[y][x]) {
                        game.visitedCells[y][x] = true; // ÎπÑÌôúÏÑ± ÏÖÄÏùÄ Î∞©Î¨∏Ìïú Í≤ÉÏúºÎ°ú ÌëúÏãú
                    }
                }
            }
        }

        // Ï¥àÍ∏∞ Ï†êÏàò ÏÑ§Ï†ï
        function initializeScores() {
            game.scores = {};
            
            // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Ïùò Ï†êÏàò Ï¥àÍ∏∞Ìôî
            game.playerOrder.forEach(player => {
                game.scores[player] = 0;
            });
        }
        // Ï¥àÍ∏∞ Î∞∞Ïπò ÏÑ§Ï†ï
        function placeInitialPieces() {
            if (game.mapType === 'standard') {
                // Í∏∞Î≥∏ ÎßµÏóêÏÑúÎäî Î™®ÏÑúÎ¶¨Ïóê ÎûúÎç§ÌïòÍ≤å Î∞∞Ïπò
                const startPositions = [
                    {x: 0, y: 0},
                    {x: game.size.width-1, y: game.size.height-1}
                ];
                
                // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú ÎûúÎç§Ìôî
                const shuffledPlayers = shuffleArray([...game.playerOrder]);
                
                // Ï¥àÍ∏∞ Ï†êÏàò Ï¥àÍ∏∞Ìôî
                game.playerOrder.forEach(player => {
                    game.scores[player] = 0;
                });
                
                // Í∞Å ÏúÑÏπòÏóê ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïπò
                for (let i = 0; i < shuffledPlayers.length; i++) {
                    const pos = startPositions[i];
                    const player = shuffledPlayers[i];
                    
                    game.board[pos.y][pos.x] = player;
                    game.visitedCells[pos.y][pos.x] = true;
                    game.scores[player]++;
                }
            } 
            else if (game.mapType === 'large') {
                // 8x8 ÎßµÏùò Í≤ΩÏö∞ XÏûê ÌòïÌÉúÎ°ú Îëê Í∞úÏî© Î∞∞Ïπò
                const startPositions = [
                    [{x: 0, y: 0}, {x: game.size.width-1, y: game.size.height-1}],
                    [{x: game.size.width-1, y: 0}, {x: 0, y: game.size.height-1}]
                ];
                
                // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú ÎûúÎç§Ìôî
                const shuffledPlayers = shuffleArray([...game.playerOrder]);
                
                // Ï¥àÍ∏∞ Ï†êÏàò Ï¥àÍ∏∞Ìôî
                game.playerOrder.forEach(player => {
                    game.scores[player] = 0;
                });
                
                // Í∞Å ÏúÑÏπòÏóê ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïπò
                for (let i = 0; i < shuffledPlayers.length; i++) {
                    const positions = startPositions[i];
                    const player = shuffledPlayers[i];
                    
                    // Í∞Å ÌîåÎ†àÏù¥Ïñ¥Îäî ÎåÄÍ∞ÅÏÑ† Î∞òÎåÄÌé∏Ïóê 2Í∞úÏî© Î∞∞Ïπò
                    for (const pos of positions) {
                        game.board[pos.y][pos.x] = player;
                        game.visitedCells[pos.y][pos.x] = true;
                        game.scores[player]++;
                    }
                }
            } 
            else if (game.mapType === 'usa' || game.mapType === 'china') {
                // ÌîåÎ†àÏù¥Ïñ¥ ÎûúÎç§ÌïòÍ≤å ÏÑ†ÌÉù
                const shuffledPlayers = shuffleArray([...game.playerOrder]);
                placeFourCornerPieces(shuffledPlayers);
            }
            else if (game.mapType === 'trident') {
                // ÏÇºÏßÄÏ∞Ω ÎßµÏóêÏÑúÎäî Í∞Å Í∞ÄÏßÄ ÎÅùÏóê ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïπò
                const activeCells = findActiveCellsEdges();
                
                // ÏãúÏûë ÏúÑÏπò Ï†ïÏùò
                const startPositions = [
                    // Î∂ÅÏ™Ω ÎÅù
                    activeCells.find(cell => cell.y === 0),
                    // ÏôºÏ™Ω ÌïòÎã® ÎÅù
                    activeCells.find(cell => 
                        cell.y === game.size.height - 1 && cell.x < game.size.width / 2),
                    // Ïò§Î•∏Ï™Ω ÌïòÎã® ÎÅù
                    activeCells.filter(cell => 
                        cell.y === game.size.height - 1 && cell.x >= game.size.width / 2)
                        .sort((a, b) => b.x - a.x)[0]
                ];
                
                // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú ÎûúÎç§Ìôî
                const shuffledPlayers = shuffleArray([...game.playerOrder]);
                
                // Ï¥àÍ∏∞ Ï†êÏàò Ï¥àÍ∏∞Ìôî
                game.playerOrder.forEach(player => {
                    game.scores[player] = 0;
                });
                
                // Í∞Å ÏúÑÏπòÏóê ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïπò
                for (let i = 0; i < shuffledPlayers.length; i++) {
                    const pos = startPositions[i];
                    const player = shuffledPlayers[i];
                    
                    if (pos) {
                        game.board[pos.y][pos.x] = player;
                        game.visitedCells[pos.y][pos.x] = true;
                        game.scores[player]++;
                    }
                }
            }
            else if (game.mapType === 'pacific') {
                // ÌÉúÌèâÏñë Î∂ÑÏßÄÎèÑ ÎßµÏóêÏÑúÎäî Í∞Å ÎåÄÎ•ôÏóê ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïπò
                const activeCells = findActiveCellsEdges();
                
                // ÏãúÏûë ÏúÑÏπò Ï†ïÏùò
                const startPositions = [
                    // Î∂ÅÎØ∏(ÏôºÏ™Ω ÏÉÅÎã®)
                    activeCells.find(cell => 
                        cell.y === 0 && cell.x < game.size.width / 3),
                    // ÏïÑÏãúÏïÑ(Ïò§Î•∏Ï™Ω ÏÉÅÎã®)
                    activeCells.filter(cell => 
                        cell.y === 0 && cell.x >= game.size.width * 2 / 3)
                        .sort((a, b) => b.x - a.x)[0],
                    // Ìò∏Ï£º(Ïò§Î•∏Ï™Ω ÌïòÎã®)
                    activeCells.filter(cell => 
                        cell.y === game.size.height - 1 && cell.x >= game.size.width * 2 / 3)
                        .sort((a, b) => b.x - a.x)[0],
                    // ÎÇ®ÎØ∏(ÏôºÏ™Ω ÌïòÎã®)
                    activeCells.find(cell => 
                        cell.y === game.size.height - 1 && cell.x < game.size.width / 3)
                ];
                
                // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú ÎûúÎç§Ìôî
                const shuffledPlayers = shuffleArray([...game.playerOrder]);
                
                // Ï¥àÍ∏∞ Ï†êÏàò Ï¥àÍ∏∞Ìôî
                game.playerOrder.forEach(player => {
                    game.scores[player] = 0;
                });
                
                // Í∞Å ÏúÑÏπòÏóê ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïπò
                for (let i = 0; i < shuffledPlayers.length; i++) {
                    const pos = startPositions[i];
                    const player = shuffledPlayers[i];
                    
                    if (pos) {
                        game.board[pos.y][pos.x] = player;
                        game.visitedCells[pos.y][pos.x] = true;
                        game.scores[player]++;
                    }
                }
            }
            else if (game.mapType === 'islandMap') {
                // ÏÑ¨Îßµ Ï†ÑÏö© Ï¥àÍ∏∞ Î∞∞Ïπò Ìï®Ïàò Ìò∏Ï∂ú
                placeInitialPiecesIslandMap();
            }
            else if (game.mapType === 'mazeMap') {
                // ÎØ∏Î°úÎßµ Ï†ÑÏö© Ï¥àÍ∏∞ Î∞∞Ïπò Ìï®Ïàò Ìò∏Ï∂ú
                placeInitialPiecesMazeMap();
            }
            else if (game.mapType === 'spaceStation') {
                // Ïö∞Ï£º Ï†ïÍ±∞Ïû• Îßµ Ï†ÑÏö© Ï¥àÍ∏∞ Î∞∞Ïπò Ìï®Ïàò Ìò∏Ï∂ú
                placeInitialPiecesSpaceStation();
            }
        }

        // Ïö∞Ï£º Ï†ïÍ±∞Ïû• Îßµ ÌîåÎ†àÏù¥Ïñ¥ Ï¥àÍ∏∞ Î∞∞Ïπò Ìï®Ïàò
        function placeInitialPiecesSpaceStation() {
            // Ïö∞Ï£º Ï†ïÍ±∞Ïû• ÎßµÏóêÏÑú Í∞Å ÌîåÎ†àÏù¥Ïñ¥ ÏúÑÏπò Ï†ïÏùò
            const startPositions = [
                {x: 1, y: 7},    // ÏôºÏ™Ω
                {x: 13, y: 7},   // Ïò§Î•∏Ï™Ω
                {x: 7, y: 1},    // ÏúÑ
                {x: 7, y: 13}    // ÏïÑÎûò
            ];
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú ÎûúÎç§Ìôî
            const shuffledPlayers = shuffleArray([...game.playerOrder]);
            
            // Ï¥àÍ∏∞ Ï†êÏàò Ï¥àÍ∏∞Ìôî
            game.playerOrder.forEach(player => {
                game.scores[player] = 0;
            });
            
            // Í∞Å ÏúÑÏπòÏóê ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïπò
            for (let i = 0; i < shuffledPlayers.length; i++) {
                const pos = startPositions[i];
                const player = shuffledPlayers[i];
                
                // ÎßêÏùÑ ÌôïÏã§Ìûà Î∞∞ÏπòÌïòÍ∏∞ ÏúÑÌï¥ ÌôúÏÑ± ÏÖÄ Ïó¨Î∂Ä Ï≤¥ÌÅ¨ ÌõÑ Î∞∞Ïπò
                if (game.activeCells[pos.y][pos.x]) {
                    game.board[pos.y][pos.x] = player;
                    game.visitedCells[pos.y][pos.x] = true;
                    game.scores[player]++;
                }
            }
        }
        // ÌîåÎ†àÏù¥Ïñ¥ Ï¥àÍ∏∞ Î∞∞ÏπòÎ•º ÏàòÏ†ïÌïòÎäî Ìï®Ïàò - ÏÑ¨ÎßµÏö©
        function placeInitialPiecesIslandMap() {
            // ÏÑ¨ÎßµÏóêÏÑú Í∞Å ÌîåÎ†àÏù¥Ïñ¥ ÏúÑÏπò Ï†ïÏùò
            const startPositions = [
                {x: 2, y: 2},     // ÏôºÏ™Ω ÏÉÅÎã® ÏûëÏùÄ ÏÑ¨
                {x: 11, y: 2},    // Ïò§Î•∏Ï™Ω ÏÉÅÎã® ÏûëÏùÄ ÏÑ¨
                {x: 2, y: 11},    // ÏôºÏ™Ω ÌïòÎã® ÏûëÏùÄ ÏÑ¨
                {x: 11, y: 11}    // Ïò§Î•∏Ï™Ω
            ];
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú ÎûúÎç§Ìôî
            const shuffledPlayers = shuffleArray([...game.playerOrder]);
            
            // Ï¥àÍ∏∞ Ï†êÏàò Ï¥àÍ∏∞Ìôî
            game.playerOrder.forEach(player => {
                game.scores[player] = 0;
            });
            
            // Í∞Å ÏúÑÏπòÏóê ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïπò
            for (let i = 0; i < shuffledPlayers.length; i++) {
                const pos = startPositions[i];
                const player = shuffledPlayers[i];
                
                // ÎßêÏùÑ ÌôïÏã§Ìûà Î∞∞ÏπòÌïòÍ∏∞ ÏúÑÌï¥ ÌôúÏÑ± ÏÖÄ Ïó¨Î∂Ä Ï≤¥ÌÅ¨ ÌõÑ Î∞∞Ïπò
                if (game.activeCells[pos.y][pos.x]) {
                    game.board[pos.y][pos.x] = player;
                    game.visitedCells[pos.y][pos.x] = true;
                    game.scores[player]++;
                } else {
                    // ÎßåÏïΩ ÏßÄÏ†ïÎêú ÏúÑÏπòÍ∞Ä ÎπÑÌôúÏÑ± ÏÖÄÏù¥Î©¥ Í∑ºÏ≤òÏùò ÌôúÏÑ± ÏÖÄ Ï∞æÍ∏∞
                    for (let dy = -1; dy <= 1; dy++) {
                        for (let dx = -1; dx <= 1; dx++) {
                            const nx = pos.x + dx;
                            const ny = pos.y + dy;
                            if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height && 
                                game.activeCells[ny][nx] && !game.visitedCells[ny][nx]) {
                                game.board[ny][nx] = player;
                                game.visitedCells[ny][nx] = true;
                                game.scores[player]++;
                                return; // ÎßêÏùÑ ÎÜìÏïòÏúºÎ©¥ Ìï®Ïàò Ï¢ÖÎ£å
                            }
                        }
                    }
                }
            }
        }

        // ÌîåÎ†àÏù¥Ïñ¥ Ï¥àÍ∏∞ Î∞∞ÏπòÎ•º ÏàòÏ†ïÌïòÎäî Ìï®Ïàò - ÎØ∏Î°úÎßµÏö©
        function placeInitialPiecesMazeMap() {
            // ÎØ∏Î°úÎßµÏóêÏÑú Í∞Å ÌîåÎ†àÏù¥Ïñ¥ ÏúÑÏπò Ï†ïÏùò
            const startPositions = [
                {x: 2, y: 2},     // ÏôºÏ™Ω ÏÉÅÎã®
                {x: 7, y: 2},     // Ïò§Î•∏Ï™Ω ÏÉÅÎã®
                {x: 2, y: 7}      // ÏôºÏ™Ω ÌïòÎã®
            ];
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú ÎûúÎç§Ìôî
            const shuffledPlayers = shuffleArray([...game.playerOrder]);
            
            // Ï¥àÍ∏∞ Ï†êÏàò Ï¥àÍ∏∞Ìôî
            game.playerOrder.forEach(player => {
                game.scores[player] = 0;
            });
            
            // Í∞Å ÏúÑÏπòÏóê ÌîåÎ†àÏù¥Ïñ¥ Î∞∞Ïπò
            for (let i = 0; i < shuffledPlayers.length; i++) {
                const pos = startPositions[i];
                const player = shuffledPlayers[i];
                
                // ÏÖÄÏù¥ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÎäîÏßÄ ÌôïÏù∏
                if (game.activeCells[pos.y][pos.x]) {
                    game.board[pos.y][pos.x] = player;
                    game.visitedCells[pos.y][pos.x] = true;
                    game.scores[player]++;
                }
            }
        }
        // Î∞∞Ïó¥ ÎûúÎç§ ÏÑûÍ∏∞ Ìï®Ïàò (Fisher-Yates ÏïåÍ≥†Î¶¨Ï¶ò)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // XÏûê ÌòïÌÉúÎ°ú ÏΩîÎÑàÏóê Îßê Î∞∞Ïπò
        function placeFourCornerPieces(players) {
            let activeCellsList = [];
            
            // ÌôúÏÑ± ÏÖÄ Î™©Î°ù ÏÉùÏÑ±
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    if (game.activeCells[y][x]) {
                        activeCellsList.push({x, y});
                    }
                }
            }
            
            // ÎßµÏùò ÎÑ§ Î™®ÏÑúÎ¶¨Ïóê Í∞ÄÍπåÏö¥ ÌôúÏÑ± ÏÖÄ Ï∞æÍ∏∞
            let topLeft = null, topRight = null, bottomLeft = null, bottomRight = null;
            let minTLDist = Infinity, minTRDist = Infinity, minBLDist = Infinity, minBRDist = Infinity;
            
            for (const cell of activeCellsList) {
                // ÏôºÏ™Ω ÏÉÅÎã®ÍπåÏßÄÏùò Í±∞Î¶¨
                const tlDist = Math.sqrt(cell.x * cell.x + cell.y * cell.y);
                // Ïò§Î•∏Ï™Ω ÏÉÅÎã®ÍπåÏßÄÏùò Í±∞Î¶¨
                const trDist = Math.sqrt((game.size.width - 1 - cell.x) * (game.size.width - 1 - cell.x) + cell.y * cell.y);
                // ÏôºÏ™Ω ÌïòÎã®ÍπåÏßÄÏùò Í±∞Î¶¨
                const blDist = Math.sqrt(cell.x * cell.x + (game.size.height - 1 - cell.y) * (game.size.height - 1 - cell.y));
                // Ïò§Î•∏Ï™Ω ÌïòÎã®ÍπåÏßÄÏùò Í±∞Î¶¨
                const brDist = Math.sqrt((game.size.width - 1 - cell.x) * (game.size.width - 1 - cell.x) + (game.size.height - 1 - cell.y) * (game.size.height - 1 - cell.y));
                
                if (tlDist < minTLDist) {
                    minTLDist = tlDist;
                    topLeft = cell;
                }
                if (trDist < minTRDist) {
                    minTRDist = trDist;
                    topRight = cell;
                }
                if (blDist < minBLDist) {
                    minBLDist = blDist;
                    bottomLeft = cell;
                }
                if (brDist < minBRDist) {
                    minBRDist = brDist;
                    bottomRight = cell;
                }
            }
            
            // XÏûê ÌòïÌÉúÎ°ú Î∞∞Ïπò (ÎØ∏Íµ≠Í≥º Ï§ëÍµ≠Ïù¥ ÎåÄÍ∞ÅÏÑ†ÏúºÎ°ú ÎßàÏ£ºÎ≥¥Í≤å)
            if (topLeft && bottomRight && topRight && bottomLeft) {
                game.board[topLeft.y][topLeft.x] = players[0];
                game.board[bottomRight.y][bottomRight.x] = players[0];
                game.visitedCells[topLeft.y][topLeft.x] = true;
                game.visitedCells[bottomRight.y][bottomRight.x] = true;
                
                game.board[topRight.y][topRight.x] = players[1];
                game.board[bottomLeft.y][bottomLeft.x] = players[1];
                game.visitedCells[topRight.y][topRight.x] = true;
                game.visitedCells[bottomLeft.y][bottomLeft.x] = true;
                
                // Ï†êÏàò Ï¥àÍ∏∞Ìôî (Í∞Å 2Í∞úÏî©)
                players.forEach(player => {
                    game.scores[player] = 2;
                });
            } else {
                // ÏòàÏÉÅÏπò Î™ªÌïú ÏÉÅÌô©Ïóê ÎåÄÎπÑÌïú Í∏∞Î≥∏ Î∞∞Ïπò
                const centerX = Math.floor(game.size.width / 2);
                const centerY = Math.floor(game.size.height / 2);
                
                game.board[centerY-1][centerX-1] = players[0];
                game.board[centerY+1][centerX+1] = players[0];
                game.visitedCells[centerY-1][centerX-1] = true;
                game.visitedCells[centerY+1][centerX+1] = true;
                
                game.board[centerY-1][centerX+1] = players[1];
                game.board[centerY+1][centerX-1] = players[1];
                game.visitedCells[centerY-1][centerX+1] = true;
                game.visitedCells[centerY+1][centerX-1] = true;
                
                // Ï†êÏàò Ï¥àÍ∏∞Ìôî (Í∞Å 2Í∞úÏî©)
                players.forEach(player => {
                    game.scores[player] = 2;
                });
            }
        }
        // ÌôúÏÑ± ÏÖÄÏùò Í∞ÄÏû•ÏûêÎ¶¨ Ï∞æÍ∏∞
        function findActiveCellsEdges() {
            const edges = [];
            
            // Î™®Îì† ÌôúÏÑ± ÏÖÄ Ï§ëÏóêÏÑú Í∞ÄÏû•ÏûêÎ¶¨Ïóê ÏûàÎäî ÏÖÄ Ï∞æÍ∏∞
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    if (game.activeCells[y][x]) {
                        // Í∞ÄÏû•ÏûêÎ¶¨ Ï≤¥ÌÅ¨: ÏÉÅÌïòÏ¢åÏö∞ Ï§ë ÌïòÎÇòÎùºÎèÑ ÎπÑÌôúÏÑ± ÏÖÄÏù¥ ÏûàÍ±∞ÎÇò Î≥¥Îìú Î∞ñÏù¥Î©¥ Í∞ÄÏû•ÏûêÎ¶¨
                        const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
                        let isEdge = false;
                        
                        for (const [dx, dy] of directions) {
                            const nx = x + dx;
                            const ny = y + dy;
                            
                            if (nx < 0 || ny < 0 || nx >= game.size.width || ny >= game.size.height || 
                                !game.activeCells[ny][nx]) {
                                isEdge = true;
                                break;
                            }
                        }
                        
                        if (isEdge) {
                            edges.push({x, y});
                        }
                    }
                }
            }
            
            return edges;
        }

        // ÎûúÎç§ Î≤Ω Î∞∞Ïπò
        function placeRandomWalls(count) {
            let wallsPlaced = 0;
            let attempts = 0;
            const maxAttempts = 100; // Î¨¥Ìïú Î£®ÌîÑ Î∞©ÏßÄ
            
            while (wallsPlaced < count && attempts < maxAttempts) {
                attempts++;
                const x = Math.floor(Math.random() * game.size.width);
                const y = Math.floor(Math.random() * game.size.height);
                
                // Ï¥àÍ∏∞ ÏúÑÏπòÎÇò Ïù¥ÎØ∏ Î≤ΩÏù¥ ÏûàÎäî Í≥≥, ÎπÑÌôúÏÑ± ÏÖÄÏùÄ Ï†úÏô∏
                if (!game.activeCells[y][x] || game.visitedCells[y][x]) {
                    continue;
                }
                
                // Î≤Ω Î∞∞Ïπò
                game.board[y][x] = 'wall';
                game.visitedCells[y][x] = true; // Î≤ΩÎèÑ Î∞©Î¨∏Ìïú ÏÖÄÎ°ú ÌëúÏãú
                wallsPlaced++;
            }
        }
        // Î≥¥Îìú Î†åÎçîÎßÅ Ìï®Ïàò ÏàòÏ†ï
        function renderBoard() {
            boardEl.innerHTML = '';
            const config = mapConfigs[game.mapType];
            
            // Î≥¥Îìú ÌÅ¨Í∏∞ Í≥ÑÏÇ∞ Î∞è Ïä§ÌÉÄÏùº ÏÑ§Ï†ï
            let cellSize;
            const boardWrapper = document.querySelector('.board-wrapper');
            const maxBoardWidth = boardWrapper.clientWidth - 20;
            const maxBoardHeight = window.innerHeight * 0.7;
            
            // ÏÖÄ ÌÅ¨Í∏∞ Í≥ÑÏÇ∞ Î°úÏßÅ
            if (game.mapType === 'islandMap') {
                cellSize = Math.min(
                    Math.floor(maxBoardWidth / config.width),
                    Math.floor(maxBoardHeight / config.height)
                );
                cellSize = Math.max(20, cellSize);
            } else {
                const maxCellSize = 50;
                const minCellSize = 30;
                cellSize = Math.min(maxCellSize, Math.max(minCellSize, 
                    Math.min(
                        Math.floor(maxBoardWidth / config.width),
                        Math.floor(maxBoardHeight / config.height)
                    )
                ));
            }
            
            // Î≥¥Îìú Ïä§ÌÉÄÏùº ÏÑ§Ï†ï
            boardEl.style.gridTemplateColumns = `repeat(${config.width}, ${cellSize}px)`;
            boardEl.style.gridTemplateRows = `repeat(${config.height}, ${cellSize}px)`;
            
            // Ïö∞Ï£º Ï†ïÍ±∞Ïû• Îßµ Î∞∞Í≤Ω ÌÅ¥ÎûòÏä§
            if (game.mapType === 'spaceStation') {
                boardEl.classList.add('space-station-bg');
            } else {
                boardEl.classList.remove('space-station-bg');
            }
            
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    const cell = document.createElement('div');
                    
                    // ÏÖÄ Ïä§ÌÉÄÏùº ÏÑ§Ï†ï
                    cell.style.width = `${cellSize}px`;
                    cell.style.height = `${cellSize}px`;
                    
                    if (cellSize < 30) {
                        cell.style.fontSize = '8px';
                    } else if (cellSize < 40) {
                        cell.style.fontSize = '10px';
                    }
                    
                    // ÌôúÏÑ± ÏÖÄÏù∏ÏßÄ ÌôïÏù∏
                    if (!game.activeCells[y][x]) {
                        cell.className = 'hidden-cell';
                        boardEl.appendChild(cell);
                        continue;
                    }
                    
                    cell.className = 'cell';
                    cell.setAttribute('data-x', x);
                    cell.setAttribute('data-y', y);
                    
                    // Ïû•Î≤Ω ÎÜìÍ∏∞ Î™®ÎìúÏóêÏÑú ÎÜìÏùÑ Ïàò ÏûàÎäî ÏúÑÏπò ÌëúÏãú
                    if (game.wallPlaceMode && game.placableWallPositions) {
                        const isPlacable = game.placableWallPositions.some(pos => 
                            pos.x === x && pos.y === y);
                        
                        if (isPlacable) {
                            cell.classList.add('placable-wall');
                        }
                    }
                    
                    // Î∂ÑÏüÅ ÏßÄÏó≠ ÌëúÏãú
                    const isDisputedCell = game.disputedCells.some(cell => cell.x === x && cell.y === y);
                    if (isDisputedCell) {
                        cell.classList.add('disputed-cell');
                    }
                    
                    // ÌäπÎ≥Ñ ÌÑ¥ ÎåÄÍ∞ÅÏÑ† Ïù¥Îèô ÌëúÏãú
                    if (game.isSpecialTurn && !game.visitedCells[y][x] && game.currentPlayer === game.humanPlayer) {
                        let isDiagonalAdjacentCell = false;
                        const diagonalDirections = [[-1, -1], [-1, 1], [1, -1], [1, 1]];
                        
                        for (const [dx, dy] of diagonalDirections) {
                            const nx = x + dx;
                            const ny = y + dy;
                            
                            if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                                if (game.board[ny][nx] === game.currentPlayer) {
                                    isDiagonalAdjacentCell = true;
                                    break;
                                }
                            }
                        }
                        
                        if (isDiagonalAdjacentCell) {
                            cell.classList.add('diagonal-available');
                        }
                    }
                    
                    const value = game.board[y][x];
                    if (value && value !== 'wall') {
                        cell.classList.add(value);
                    } else if (value === 'wall') {
                        cell.classList.add('wall');
                        
                        if (game.wallBreakMode) {
                            const isBreakable = game.breakableWalls.some(wall => 
                                wall.x === x && wall.y === y);
                                
                            if (isBreakable) {
                                cell.classList.add('breakable-wall');
                            }
                        }
                    } else if (game.visitedCells[y][x]) {
                        cell.classList.add('visited');
                    }
                    
                    if (x === game.lastMove.x && y === game.lastMove.y) {
                        cell.classList.add('lastMove');
                    }
                    
                    cell.addEventListener('click', () => handleCellClick(x, y));
                    boardEl.appendChild(cell);
                }
            }
        }
        
        // Í≤åÏûÑ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateInfo() {
            // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            turnInfoEl.textContent = `${playerInfo[game.currentPlayer].displayName}Ïùò ÌÑ¥`;
            
            // Ï†êÏàò Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateScoresDisplay();
            
            // ÌÑ¥ Ïπ¥Ïö¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            turnCounterEl.textContent = `ÌÑ¥: ${game.turnCount}/${game.maxTurns}`;
        
            // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updatePlayerOrderDisplay();
        }
        
        // ÌîåÎ†àÏù¥Ïñ¥ ÏàúÏÑú ÌëúÏãú Ìï®Ïàò Ï∂îÍ∞Ä
        function updatePlayerOrderDisplay() {
            if (!playerOrderDisplayEl) return;
            
            let orderText = 'Í≤åÏûÑ ÏàúÏÑú: ';
            game.playerOrder.forEach((player, index) => {
                orderText += playerInfo[player].displayName;
                if (index < game.playerOrder.length - 1) {
                    orderText += ' ‚Üí ';
                }
            });
            playerOrderDisplayEl.textContent = orderText;
        }
        
        // Ï†êÏàò ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateScoresDisplay() {
            scoresDisplayEl.innerHTML = '';
            
            // Ï†êÏàò ÏïÑÏù¥ÌÖú ÏÉùÏÑ± Î∞è ÌëúÏãú
            for (const player of game.playerOrder) {
                const scoreItem = document.createElement('div');
                scoreItem.className = `score-item ${player}-score`;
                scoreItem.textContent = `${playerInfo[player].displayName}: ${game.scores[player]}`;
                scoresDisplayEl.appendChild(scoreItem);
            }
        }
        
        // Îã§Ïùå ÌîåÎ†àÏù¥Ïñ¥Î°ú Î≥ÄÍ≤Ω
        function changeToNextPlayer() {
            // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥Ïùò Ïù∏Îç±Ïä§ Ï∞æÍ∏∞
            const currentIndex = game.playerOrder.indexOf(game.currentPlayer);
            
            // Îã§Ïùå ÌîåÎ†àÏù¥Ïñ¥ Í≤∞Ï†ï
            const nextIndex = (currentIndex + 1) % game.playerOrder.length;
            game.currentPlayer = game.playerOrder[nextIndex];
            
            // ÌÑ¥ Ïàò Ï¶ùÍ∞Ä (Ï≤´ Î≤àÏß∏ ÌîåÎ†àÏù¥Ïñ¥ Ï∞®Î°ÄÍ∞Ä ÎêòÎ©¥)
            if (nextIndex === 0) {
                game.turnCount++;
            }
        }
        
        // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Îçî Ïù¥ÎèôÌï† Ïàò ÏóÜÎäîÏßÄ ÌôïÏù∏
        function allPlayersStuck() {
            // Îπà ÏÖÄÏù¥ ÏûàÎäîÏßÄ Î®ºÏ†Ä ÌôïÏù∏
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // ÌôúÏÑ± ÏÖÄÏù¥Î©¥ÏÑú ÏïÑÏßÅ Î∞©Î¨∏ÌïòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞(Îπà ÏÖÄ)Í∞Ä ÏûàÎã§Î©¥
                    if (game.activeCells[y][x] && !game.visitedCells[y][x]) {
                        // Ïñ¥Îñ§ ÌîåÎ†àÏù¥Ïñ¥Îì† Ïù¥ ÏÖÄÏóê ÎÜìÏùÑ Ïàò ÏûàÎäîÏßÄ ÌôïÏù∏
                        for (const player of game.playerOrder) {
                            if (game.scores[player] > 0 && hasAdjacentCell(x, y, player)) {
                                return false; // Ï†ÅÏñ¥ÎèÑ Ìïú ÌîåÎ†àÏù¥Ïñ¥Îäî Ïù¥ÎèôÌï† Ïàò ÏûàÏùå
                            }
                        }
                    }
                }
            }
            
            // Î™®Îì† Îπà ÏÖÄÏùÑ Í≤ÄÏÇ¨ÌñàÎäîÎç∞ ÏïÑÎ¨¥ÎèÑ ÎÜìÏùÑ Ïàò ÏóÜÏúºÎ©¥ true
            return true;
        }
        // Ïù¥Îèô Í∞ÄÎä•Ìïú ÏúÑÏπòÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
        function hasValidMove(player) {
            // Ï†êÏàòÍ∞Ä 0Ïù¥Î©¥ Ïù¥Îèô Î∂àÍ∞Ä
            if (game.scores[player] === 0) {
                return false;
            }
            
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // ÌôúÏÑ± ÏÖÄÏù∏ÏßÄ ÌôïÏù∏
                    if (game.activeCells[y][x]) {
                        // Î∂ÑÏüÅ ÏßÄÏó≠Ïù∏ÏßÄ ÌôïÏù∏
                        const isDisputedCell = game.disputedCells.some(cell => cell.x === x && cell.y === y);
                        
                        // Î∞©Î¨∏ÌïòÏßÄ ÏïäÏùÄ ÏÖÄÏù¥Í±∞ÎÇò Î∂ÑÏüÅ ÏßÄÏó≠Ïù¥Í≥†, Îπà ÏÖÄÏù¥Í±∞ÎÇò Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠Ïù∏ Í≤ΩÏö∞
                        if ((isDisputedCell || !game.visitedCells[y][x]) && 
                            (game.board[y][x] === '' || 
                            (game.board[y][x] !== player && game.board[y][x] !== 'wall')) && 
                            hasAdjacentCell(x, y, player)) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }
        
        // ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ïû•Î≤ΩÏùÑ Î∂ÄÏà† Ïàò ÏûàÎäîÏßÄ ÌôïÏù∏ÌïòÎäî Ìï®Ïàò Ï∂îÍ∞Ä
        function hasBreakableWalls(player) {
            // Ïù¥ÎØ∏ Ïû•Î≤Ω ÌååÍ¥¥Î•º ÏÇ¨Ïö©ÌñàÏúºÎ©¥ false
            if (game.wallBreakUsed[player]) return false;
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏúÑÏπò Í≤ÄÏÉâ
            const playerCells = [];
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    if (game.board[y][x] === player) {
                        playerCells.push({x, y});
                    }
                }
            }
            
            // Í∞Å ÌîåÎ†àÏù¥Ïñ¥ ÏúÑÏπòÏóêÏÑú Ïù∏Ï†ëÌïú Î≤Ω ÌôïÏù∏
            for (const cell of playerCells) {
                const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
                for (const [dx, dy] of directions) {
                    const nx = cell.x + dx;
                    const ny = cell.y + dy;
                    
                    if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                        if (game.board[ny][nx] === 'wall') {
                            return true; // Î∂ÄÏà† Ïàò ÏûàÎäî Î≤ΩÏù¥ ÏûàÏùå
                        }
                    }
                }
            }
            
            return false; // Î∂ÄÏà† Ïàò ÏûàÎäî Î≤ΩÏù¥ ÏóÜÏùå
        }
        
        // ÌÑ¥ Ï¢ÖÎ£å Ìï®Ïàò ÏàòÏ†ï - Í≤åÏûÑ Ï¢ÖÎ£å Ï°∞Í±¥ Í∞ïÌôî
        function endTurn() {
            // Ï†êÏàòÎ•º Ïû¨Í≥ÑÏÇ∞
            recalculateScores();
            
            // Í≤åÏûÑ Ï¢ÖÎ£å Ï°∞Í±¥ Ï≤¥ÌÅ¨
            if (checkGameOver()) {
                return;
            }
            
            // Ïû•Î≤Ω ÌååÍ¥¥ Í¥ÄÎ†® ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            game.wallBrokenThisTurn = false;
            
            // Îã§Ïùå ÌîåÎ†àÏù¥Ïñ¥Î°ú Î≥ÄÍ≤Ω
            changeToNextPlayer();
            
            // ÌäπÎ≥Ñ ÌÑ¥ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            if (game.gameMode === 'multi') {
                game.isSpecialTurn = game.turnCount % 5 === 0;
            }
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            renderBoard();
            updateInfo();
            updateSpecialFeatures();
            
            // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ïù¥ÎèôÌï† Ïàò ÏûàÎäîÏßÄ ÌôïÏù∏
            const currentPlayerCanMove = hasValidMove(game.currentPlayer);
            
            // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ïù¥ÎèôÌï† Ïàò ÏóÜÏúºÎ©¥ Îã§Ïùå ÌîåÎ†àÏù¥Ïñ¥Î°ú
            if (!currentPlayerCanMove) {
                // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ïù¥ÎèôÌï† Ïàò ÏóÜÏúºÎ©¥ Í≤åÏûÑ Ï¢ÖÎ£å
                if (allPlayersStuck()) {
                    messageEl.textContent = 'Î™®Îì† Ïù¥ÎèôÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§...';
                    gameOver(); // Ï¶âÏãú Í≤åÏûÑ Ï¢ÖÎ£å (setTimeout Ï†úÍ±∞)
                    return;
                }
                
                // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Ïùò Ïù¥Îèô Í∞ÄÎä• Ïó¨Î∂Ä ÌôïÏù∏ (Î™®Îì† Ïû•Î≤Ω Î∂ÄÏàòÍ∏∞ Î≤ÑÌäºÏù¥ ÏÇ¨Ïö©ÎêòÏóàÍ±∞ÎÇò Îçî Ïù¥ÏÉÅ Ïù¥ÎèôÌï† Í≥≥Ïù¥ ÏóÜÏúºÎ©¥ Í≤åÏûÑ Ï¢ÖÎ£å)
                let allPlayersStuckOrNoOptions = true;
                for (const player of game.playerOrder) {
                    if (hasValidMove(player) || 
                        ((game.gameMode === 'multi' || game.gameMode === 'oneVsOne') && !game.wallBreakUsed[player] && hasBreakableWalls(player)) ||
                        (game.gameMode === 'multi' && !game.wallPlaceUsed[player])) {
                        allPlayersStuckOrNoOptions = false;
                        break;
                    }
                }
                
                if (allPlayersStuckOrNoOptions) {
                    messageEl.textContent = 'Îçî Ïù¥ÏÉÅ Í∞ÄÎä•Ìïú Ïù¥ÎèôÏù¥ ÏóÜÏäµÎãàÎã§.';
                    gameOver();
                    return;
                }
                
                messageEl.textContent = 'Ïù¥ÎèôÌï† Í≥≥Ïù¥ ÏóÜÏäµÎãàÎã§. ÌÑ¥ÏùÑ ÎÑòÍπÅÎãàÎã§.';
                endTurn(); // Îã§Ïùå ÌÑ¥ÏúºÎ°ú
                return;
            }
            
            // Ïª¥Ìì®ÌÑ∞ Ï∞®Î°ÄÏùº Í≤ΩÏö∞ - ÎîúÎ†àÏù¥ Ï¶ùÍ∞Ä
            if (game.computerPlayers.includes(game.currentPlayer)) {
                setTimeout(computerTurn, 1500); // 1.5Ï¥àÎ°ú Ï¶ùÍ∞Ä (Í∏∞Ï°¥ 1Ï¥à)
            }
        }
        
        // Í≤åÏûÑ Ï¢ÖÎ£å Ï°∞Í±¥ ÌôïÏù∏ (ÏàòÏ†ïÎê®)
        function checkGameOver() {
            // ÏµúÎåÄ ÌÑ¥Ïóê ÎèÑÎã¨ÌñàÎäîÏßÄ ÌôïÏù∏
            if (game.turnCount > game.maxTurns) {
                gameOver();
                return true;
            }
            
            // ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ìïú Î™ÖÎßå ÎÇ®ÏïòÎäîÏßÄ ÌôïÏù∏
            let activePlayers = 0;
            for (const player of game.playerOrder) {
                if (game.scores[player] > 0) {
                    activePlayers++;
                }
            }
            
            if (activePlayers <= 1) {
                gameOver();
                return true;
            }
            
            // Î≥¥ÎìúÍ∞Ä ÏôÑÏ†ÑÌûà Í∞ÄÎìù Ï∞ºÎäîÏßÄ ÌôïÏù∏
            // Îπà ÏÖÄÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
            let hasEmptyCell = false;
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // ÌôúÏÑ± ÏÖÄÏù¥Î©¥ÏÑú ÏïÑÏßÅ Î∞©Î¨∏ÌïòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞Í∞Ä ÏûàÎã§Î©¥ Î≥¥ÎìúÍ∞Ä Í∞ÄÎìù Ï∞®ÏßÄ ÏïäÏùå
                    if (game.activeCells[y][x] && !game.visitedCells[y][x]) {
                        hasEmptyCell = true;
                        break;
                    }
                }
                if (hasEmptyCell) break;
            }
            
            // Îπà ÏÖÄÏù¥ ÏóÜÏùÑ ÎïåÎßå Í≤åÏûÑ Ï¢ÖÎ£å
            if (!hasEmptyCell) {
                gameOver();
                return true;
            }
            
            // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Îçî Ïù¥ÏÉÅ Ïù¥ÎèôÌï† Ïàò ÏóÜÎäî ÏÉÅÌÉúÏù∏ÏßÄ ÌôïÏù∏
            if (allPlayersStuck()) {
                gameOver();
                return true;
            }
            
            return false;
        }
        
        // Î≥¥ÎìúÍ∞Ä Í∞ÄÎìù Ï∞ºÎäîÏßÄ ÌôïÏù∏
        function isBoardFull() {
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // ÌôúÏÑ± ÏÖÄÏù¥Î©¥ÏÑú ÏïÑÏßÅ Î∞©Î¨∏ÌïòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞Í∞Ä ÏûàÎã§Î©¥ Î≥¥ÎìúÍ∞Ä Í∞ÄÎìù Ï∞®ÏßÄ ÏïäÏùå
                    if (game.activeCells[y][x] && !game.visitedCells[y][x]) {
                        return false; // ÏïÑÏßÅ Î∞©Î¨∏ÌïòÏßÄ ÏïäÏùÄ ÌôúÏÑ± ÏÖÄÏù¥ ÏûàÏùå
                    }
                }
            }
            return true; // Î™®Îì† ÌôúÏÑ± ÏÖÄÏù¥ Î∞©Î¨∏Îê®
        }
        // Ï†êÏàò Ïû¨Í≥ÑÏÇ∞
        function recalculateScores() {
            const scores = {};
            
            // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Ïùò Ï†êÏàò Ï¥àÍ∏∞Ìôî
            game.playerOrder.forEach(player => {
                scores[player] = 0;
            });
            
            // Î≥¥ÎìúÎ•º Í≤ÄÏÇ¨ÌïòÏó¨ Ï†êÏàò Í≥ÑÏÇ∞
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    const cell = game.board[y][x];
                    if (game.playerOrder.includes(cell)) {
                        scores[cell]++;
                    }
                }
            }
            
            game.scores = scores;
        }
        // Í≤åÏûÑ Ï¢ÖÎ£å Ìï®ÏàòÎ•º ÏàòÏ†ïÌï©ÎãàÎã§
        function gameOver() {
            game.isGameOver = true;
            
            // ÏµúÏ¢Ö Ï†êÏàò Ïû¨Í≥ÑÏÇ∞
            recalculateScores();
            
            // Ï†êÏàò Í∏∞Ï§ÄÏúºÎ°ú ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ†¨ (ÎÜíÏùÄ Ï†êÏàòÍ∞Ä ÏÉÅÏúÑ)
            const rankedPlayers = [...game.playerOrder].sort((a, b) => 
                game.scores[b] - game.scores[a]);
            
            const winner = rankedPlayers[0];
            const isMultiWinner = rankedPlayers.length > 1 && 
                game.scores[rankedPlayers[0]] === game.scores[rankedPlayers[1]];
            
            // Í≤åÏûÑ Ï¢ÖÎ£å Ïù¥Ïú† ÌååÏïÖ
            let reason = "";
            if (game.turnCount >= game.maxTurns) {
                reason = `${game.maxTurns}ÌÑ¥Ïù¥ Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§. `;
            } else if (isBoardFull()) {
                reason = "Î™®Îì† ÏÖÄÏù¥ Ï†êÎ†πÎêòÏóàÏäµÎãàÎã§. ";
            } else {
                // Ï†úÍ±∞Îêú ÌîåÎ†àÏù¥Ïñ¥ ÌôïÏù∏
                for (const player of game.playerOrder) {
                    if (game.scores[player] <= 0) {
                        const playerName = playerInfo[player].displayName;
                        reason += `${playerName}Í∞Ä Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§. `;
                    }
                }
            }
            
            // Í≤∞Í≥º ÌëúÏãú
            if (isMultiWinner) {
                resultTitleEl.textContent = 'Î¨¥ÏäπÎ∂Ä!';
            } else {
                resultTitleEl.textContent = `${playerInfo[winner].displayName} ÏäπÎ¶¨!`;
            }
            
            // ÏàúÏúÑÌëú HTML ÏÉùÏÑ±
            let rankingHTML = '<div class="ranking-table">';
            rankingHTML += '<h3>ÏµúÏ¢Ö ÏàúÏúÑ</h3>';
            rankingHTML += '<table>';
            rankingHTML += '<tr><th>ÏàúÏúÑ</th><th>Íµ≠Í∞Ä</th><th>Ï†êÏàò</th></tr>';
            
            // Í∞Å ÌîåÎ†àÏù¥Ïñ¥Ïùò ÏàúÏúÑ Ï∂îÍ∞Ä
            rankedPlayers.forEach((player, index) => {
                const rank = index + 1;
                rankingHTML += `<tr class="${player}-rank">`;
                rankingHTML += `<td>${rank}ÏúÑ</td>`;
                rankingHTML += `<td>${playerInfo[player].displayName}</td>`;
                rankingHTML += `<td>${game.scores[player]}</td>`;
                rankingHTML += '</tr>';
            });
            
            rankingHTML += '</table></div>';
            
            // Í∞ÑÎã®Ìïú Ï†êÏàò Î¨∏ÏûêÏó¥ÎèÑ Ìï®Íªò ÌëúÏãú
            let scoreText = reason;
            
            // Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
            resultDescEl.innerHTML = scoreText + rankingHTML;
            resultModalEl.style.display = 'flex';
        }
        // Ï§ëÍµ≠ Íµ≠Í∏∞ Ïä§ÌÉÄÏùº ÏàòÏ†ï - Î≥ÑÏù¥ Ï†úÎåÄÎ°ú Î≥¥Ïù¥ÎèÑÎ°ù ÏàòÏ†ï
        const chinaStyleFix = `
        .china {
            background-color: #de2910 !important;
            position: relative !important;
            border-radius: 4px !important;
        }
        .china::after {
            content: "‚òÖ" !important;
            position: absolute !important;
            color: #ffde00 !important;
            font-size: 24px !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 100 !important;
        }
        `;
        
        const usaStyleFix = `
        .usa {
            background-color: #3c3b6e !important;
            border-radius: 50% !important;
            position: relative !important;
        }
        .usa::after {
            content: "USA" !important;
            position: absolute !important;
            color: white !important;
            font-size: 12px !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 100 !important;
        }
        `;
        
        const rowStyleFix = `
        .row {
            background-color: #607D8B !important;
            position: relative !important;
            border-radius: 5px !important;
        }
        .row::after {
            content: "üåç" !important;
            position: absolute !important;
            font-size: 20px !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 100 !important;
        }
        `;
        
        // ÌäπÎ≥Ñ Í∏∞Îä• Í¥ÄÎ†® Ï∂îÍ∞Ä Ïä§ÌÉÄÏùº
        const specialFeaturesStyleFix = `
        .disputed-cell {
            box-shadow: inset 0 0 0 2px #ff0000 !important;
        }
        .diagonal-available {
            box-shadow: inset 0 0 0 2px #ff9800 !important;
        }
        .breakable-wall {
            box-shadow: inset 0 0 0 3px #ffeb3b !important;
            cursor: pointer !important;
        }
        .wall-break-mode .wall:not(.breakable-wall) {
            opacity: 0.5 !important;
        }
        .special-turn-message {
            background-color: #ffe0b2 !important;
            color: #e65100 !important;
            padding: 8px 12px !important;
            border-radius: 5px !important;
            margin: 10px 0 !important;
            font-weight: bold !important;
            animation: pulse 1.5s infinite !important;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(230, 81, 0, 0.4) !important; }
            70% { box-shadow: 0 0 0 10px rgba(230, 81, 0, 0) !important; }
            100% { box-shadow: 0 0 0 0 rgba(230, 81, 0, 0) !important; }
        }
        `;
        
        // Ïû•Î≤Ω ÎÜìÍ∏∞ Í¥ÄÎ†® Ï∂îÍ∞Ä Ïä§ÌÉÄÏùº
        const wallPlacingStyleFix = `
        .placable-wall {
            box-shadow: inset 0 0 0 2px #4CAF50 !important;
            cursor: pointer !important;
        }
        
        .place-wall-mode .cell:not(.placable-wall) {
            opacity: 0.7 !important;
            cursor: not-allowed !important;
        }
        
        .place-wall-mode .placable-wall:hover {
            background-color: #555 !important;
            opacity: 0.7 !important;
        }
        `;
        
        // Ïä§ÌÉÄÏùº Ï†ÅÏö© Ìï®Ïàò ÏàòÏ†ï
        function fixStyles() {
            const styleEl = document.createElement('style');
            styleEl.textContent = chinaStyleFix + usaStyleFix + rowStyleFix + specialFeaturesStyleFix + wallPlacingStyleFix + `
                /* Ìù°Ïàò Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º */
                .capturing {
                    animation: pulse-capture 0.2s ease-in-out;
                    opacity: 0.5;
                    transition: all 0.2s ease;
                }
                
                @keyframes pulse-capture {
                    0% { transform: scale(1); opacity: 0.8; }
                    50% { transform: scale(1.2); opacity: 0.5; }
                    100% { transform: scale(1); opacity: 0.8; }
                }
                
                /* ÏÖÄ Ìù°Ïàò Ïãú ÏßÄÏó∞ Ìö®Í≥ºÎ•º ÏúÑÌïú Ìä∏ÎûúÏßÄÏÖò */
                .cell {
                    transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
                }
            }
            /* ÏûëÏùÄ ÏÖÄÏóê ÎßûÍ≤å ÏïÑÏù¥ÏΩò ÌÅ¨Í∏∞ Ï°∞Ï†ï */
               @media (max-width: 576px) {
                    .china::after {
                        font-size: 16px !important;
                    }
                    .usa::after {
                        font-size: 8px !important;
                    }
                    .row::after, .wto::after, .imf::after {
                        font-size: 14px !important;
                    }
                    .visited::after {
                        font-size: 14px !important;
                    }
            }
            
            /* Î≥¥Îìú ÎûòÌçº ÏµúÎåÄ ÎÜíÏù¥ ÏÑ§Ï†ï */
               .board-wrapper {
                   width: 100%;
                   max-width: 600px;
                   overflow-x: auto;
                   overflow-y: auto;
                   -webkit-overflow-scrolling: touch;
                   margin: 0 auto;
                }
                /* ÏûëÏùÄ ÎßµÏùÑ Ï§ëÏïôÏóê Ï†ïÎ†¨ */
                .board {
                    margin: 0 auto;
                }
                
                /* ÏàúÏúÑÌëú Ïä§ÌÉÄÏùº - Ïó¨Í∏∞Ïóê Ï∂îÍ∞Ä */
                .ranking-table {
                    margin-top: 15px;
                    width: 100%;
                }
                
                .ranking-table table {
                    width: 100%;
                    border-collapse: collapse;
                    margin-top: 10px;
                }
                
                .ranking-table th, .ranking-table td {
                    border: 1px solid #ddd;
                    padding: 8px;
                    text-align: center;
                }
                
                .ranking-table th {
                    background-color: #f5f5f5;
                    font-weight: bold;
                }
                
                .usa-rank td {
                    background-color: rgba(60, 59, 110, 0.2);
                }
                
                .china-rank td {
                    background-color: rgba(222, 41, 16, 0.2);
                }
                
                .row-rank td {
                    background-color: rgba(96, 125, 139, 0.2);
                }
                
                .wto-rank td {
                    background-color: rgba(33, 150, 243, 0.2);
                }
                
                .imf-rank td {
                    background-color: rgba(156, 39, 176, 0.2);
                }
                
                /* 1ÏúÑ Í∞ïÏ°∞ */
                .ranking-table tr:first-child td {
                    font-weight: bold;
                    font-size: 1.1em;
                }
            `;
            document.head.appendChild(styleEl);
        }
        // Ï¶âÏãú Ïä§ÌÉÄÏùº Ï†ÅÏö©
        fixStyles();
        
        // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî Ïãú Ïä§ÌÉÄÏùº ÏàòÏ†ï Ìï®Ïàò Ìò∏Ï∂ú
        const originalInitGame = initGame;
        initGame = function() {
            originalInitGame.apply(this, arguments);
            fixStyles(); // Ïä§ÌÉÄÏùº ÏàòÏ†ï Ï†ÅÏö©
        };
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú ÏãúÎèÑ Ï†ÅÏö©
        document.addEventListener('DOMContentLoaded', () => {
            fixStyles();
            showModeModal();
            
            // Ï∞Ω ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Ïãú Î≥¥Îìú Îã§Ïãú Î†åÎçîÎßÅ
            window.addEventListener('resize', () => {
                if (!game.isGameOver) {
                    renderBoard();
                }
            });
        });
</script>
</body>
</html>
