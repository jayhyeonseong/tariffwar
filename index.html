<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì„¸ê· ì „ ê´€ì„¸ì „ìŸ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .game-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .board {
            display: grid;
            gap: 2px;
            background-color: #ccc;
            padding: 5px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .cell {
            width: 55px;
            height: 55px;
            background-color: #fff;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        .cell:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }
        .usa {
            background-color: #3c3b6e;
            border-radius: 50%;
            position: relative;
        }
        .usa::after {
            content: "USA";
            position: absolute;
            color: white;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .china {
            background-color: #de2910;
            position: relative;
        }
        .china::after {
           content: "â˜…";
           position: absolute;
           color: #ffde00;
           font-size: 24px;
        }
        /* ìƒˆë¡œìš´ í”Œë ˆì´ì–´ ìŠ¤íƒ€ì¼: ROW */
        .row {
            background-color: #607D8B;
            position: relative;
            border-radius: 5px;
        }
        .row::after {
            content: "ğŸŒ";
            position: absolute;
            font-size: 20px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        /* ìƒˆë¡œìš´ í”Œë ˆì´ì–´ ìŠ¤íƒ€ì¼: WTO */
        .wto {
            background-color: #2196F3;
            position: relative;
            border-radius: 5px;
        }
        .wto::after {
            content: "WTO";
            position: absolute;
            color: white;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        /* ìƒˆë¡œìš´ í”Œë ˆì´ì–´ ìŠ¤íƒ€ì¼: IMF */
        .imf {
            background-color: #9C27B0;
            position: relative;
            border-radius: 5px;
        }
        .imf::after {
            content: "$";
            position: absolute;
            color: white;
            font-size: 20px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .wall {
            background-color: #555;
            position: relative;
        }
        .wall::before {
            content: "";
            position: absolute;
            width: 70%;
            height: 70%;
            background-color: #333;
            top: 15%;
            left: 15%;
        }
        .visited {
            background-color: #f0f0f0;
            position: relative;
            pointer-events: none;
        }
        .visited::after {
            content: "X";
            color: #999;
            font-size: 18px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
         .panel {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 250px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover:not(:disabled) {
            background-color: #45a049;
            transform: scale(1.05);
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        #message {
            margin: 10px 0;
            min-height: 20px;
            color: #d9534f;
        }
        #gameRules {
            margin-top: 20px;
            text-align: left;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        .lastMove {
            box-shadow: inset 0 0 0 3px yellow;
        }
        #turnCounter {
            font-weight: bold;
            color: #333;
            margin-top: 10px;
        }
        .map-selection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .map-option {
            width: 120px;
            height: 100px;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 5px;
        }
        .map-option:hover {
            border-color: #4CAF50;
            transform: scale(1.05);
        }
        .map-option.selected {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        .map-preview {
            width: 100px;
            height: 70px;
            margin-bottom: 5px;
            background-color: #ccc;
            position: relative;
        }
        .map-preview-5x5 {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="white" stroke="gray" stroke-width="1"/><line x1="5" y1="17" x2="95" y2="17" stroke="gray" stroke-width="1"/><line x1="5" y1="29" x2="95" y2="29" stroke="gray" stroke-width="1"/><line x1="5" y1="41" x2="95" y2="41" stroke="gray" stroke-width="1"/><line x1="5" y1="53" x2="95" y2="53" stroke="gray" stroke-width="1"/><line x1="23" y1="5" x2="23" y2="65" stroke="gray" stroke-width="1"/><line x1="41" y1="5" x2="41" y2="65" stroke="gray" stroke-width="1"/><line x1="59" y1="5" x2="59" y2="65" stroke="gray" stroke-width="1"/><line x1="77" y1="5" x2="77" y2="65" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-8x8 {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="white" stroke="gray" stroke-width="1"/><line x1="5" y1="12.5" x2="95" y2="12.5" stroke="gray" stroke-width="1"/><line x1="5" y1="20" x2="95" y2="20" stroke="gray" stroke-width="1"/><line x1="5" y1="27.5" x2="95" y2="27.5" stroke="gray" stroke-width="1"/><line x1="5" y1="35" x2="95" y2="35" stroke="gray" stroke-width="1"/><line x1="5" y1="42.5" x2="95" y2="42.5" stroke="gray" stroke-width="1"/><line x1="5" y1="50" x2="95" y2="50" stroke="gray" stroke-width="1"/><line x1="5" y1="57.5" x2="95" y2="57.5" stroke="gray" stroke-width="1"/><line x1="16.25" y1="5" x2="16.25" y2="65" stroke="gray" stroke-width="1"/><line x1="27.5" y1="5" x2="27.5" y2="65" stroke="gray" stroke-width="1"/><line x1="38.75" y1="5" x2="38.75" y2="65" stroke="gray" stroke-width="1"/><line x1="50" y1="5" x2="50" y2="65" stroke="gray" stroke-width="1"/><line x1="61.25" y1="5" x2="61.25" y2="65" stroke="gray" stroke-width="1"/><line x1="72.5" y1="5" x2="72.5" y2="65" stroke="gray" stroke-width="1"/><line x1="83.75" y1="5" x2="83.75" y2="65" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-usa {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><path d="M10,10 L90,10 L90,20 L80,20 L80,30 L70,30 L70,40 L80,40 L80,50 L70,50 L70,60 L10,60 Z" fill="white" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-china {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><path d="M30,10 L70,10 C85,10 90,30 90,40 C90,50 85,60 70,60 L30,60 C15,60 10,50 10,40 C10,30 15,10 30,10 Z" fill="white" stroke="gray" stroke-width="1"/></svg>');
        }
        /* ìƒˆë¡œìš´ ë§µ ë¯¸ë¦¬ë³´ê¸° */
        .map-preview-trident {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><path d="M40,5 L60,5 L60,25 L80,25 L80,45 L60,45 L60,65 L40,65 L40,45 L20,45 L20,25 L40,25 Z" fill="white" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-pacific {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="lightblue" stroke="gray" stroke-width="1"/><path d="M5,5 L20,10 L25,25 L15,35 L5,35 Z" fill="white" stroke="gray" stroke-width="1"/><path d="M70,5 L95,5 L95,20 L85,25 L75,20 L70,10 Z" fill="white" stroke="gray" stroke-width="1"/><path d="M5,45 L15,50 L15,65 L5,65 Z" fill="white" stroke="gray" stroke-width="1"/><path d="M75,50 L85,45 L95,45 L95,60 L80,65 L70,60 Z" fill="white" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-island {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="lightblue" stroke="gray" stroke-width="1"/><circle cx="50" cy="35" r="20" fill="white" stroke="gray" stroke-width="1"/><circle cx="15" cy="15" r="8" fill="white" stroke="gray" stroke-width="1"/><circle cx="85" cy="15" r="8" fill="white" stroke="gray" stroke-width="1"/><circle cx="15" cy="55" r="8" fill="white" stroke="gray" stroke-width="1"/><circle cx="85" cy="55" r="8" fill="white" stroke="gray" stroke-width="1"/></svg>');
        }
        .map-preview-maze {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 70"><rect x="5" y="5" width="90" height="60" fill="white" stroke="gray" stroke-width="1"/><path d="M20,5 L20,20 L35,20 L35,35 L20,35 L20,50 L35,50 L35,65 M50,5 L50,20 L65,20 L65,35 L50,35 L50,50 L65,50 L65,65 M80,5 L80,65" stroke="gray" stroke-width="2" fill="none" /></svg>');
        }
        .hidden-cell {
             background-color: #b0c4de; /* ì—°í•œ ì²­íšŒìƒ‰(Light Steel Blue) */
             border: 1px solid #a0b0c0;
             visibility: visible; /* ë³´ì´ê²Œ ì„¤ì • */
        }
        .mode-option {
            width: 200px;
            height: 150px;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 15px;
            margin: 10px;
            background-color: white;
        }
        .mode-option:hover {
            border-color: #4CAF50;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .mode-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        .mode-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .mode-desc {
            font-size: 14px;
            color: #666;
        }
        /* ë‹¤ì¤‘ ëª¨ë“œ ê´€ë ¨ ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ */
        /* ë‹¤ì¤‘ ëª¨ë“œ ë§µ ì„ íƒ ì»¨í…Œì´ë„ˆ */
        .multi-map-selection {
          display: flex;
          flex-direction: row; /* ê°€ë¡œë¡œ ë°°ì¹˜ */
          justify-content: flex-start; /* ì¢Œì¸¡ ì •ë ¬ */
          align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
          gap: 10px; /* ìš”ì†Œ ê°„ ê°„ê²© */
          margin: 20px 0;
          padding: 10px;
          overflow-x: auto; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
          width: 100%; /* ì»¨í…Œì´ë„ˆ ë„ˆë¹„ë¥¼ ë¶€ëª¨ì— ë§ì¶¤ */
          box-sizing: border-box;
          white-space: nowrap; /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }

        /* ê° ë§µ ì˜µì…˜ ìŠ¤íƒ€ì¼ - ê¸°ë³¸ (ëª¨ë°”ì¼) */
        .multi-map-option {
          flex: 0 0 auto; /* í¬ê¸° ê³ ì • */
          width: 90px; /* ëª¨ë°”ì¼ì—ì„œ ë” ì‘ì€ ë„ˆë¹„ */
          height: 80px; /* ëª¨ë°”ì¼ì—ì„œ ë” ì‘ì€ ë†’ì´ */
          border: 2px solid #ccc;
          border-radius: 5px;
          cursor: pointer;
          display: inline-flex; /* inline-flexë¡œ ë³€ê²½ */
          flex-direction: column;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
          padding: 5px;
          box-sizing: border-box;
        }

        .multi-map-option:hover {
          border-color: #4CAF50;
          transform: scale(1.05);
        }

        .multi-map-option.selected {
          border-color: #4CAF50;
          background-color: rgba(76, 175, 80, 0.1);
        }

        /* ë§µ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ í¬ê¸° - ê¸°ë³¸ (ëª¨ë°”ì¼) */
        .multi-map-preview {
          width: 70px; /* ëª¨ë°”ì¼ì—ì„œ ë” ì‘ì€ ë¯¸ë¦¬ë³´ê¸° */
          height: 50px; /* ëª¨ë°”ì¼ì—ì„œ ë” ì‘ì€ ë†’ì´ */
          margin-bottom: 5px;
          background-color: #f0f0f0;
          border-radius: 4px;
        }

        /* ë§µ ì´ë¦„ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ - ê¸°ë³¸ (ëª¨ë°”ì¼) */
        .multi-map-option span {
          font-size: 10px; /* ëª¨ë°”ì¼ì—ì„œ ë” ì‘ì€ í…ìŠ¤íŠ¸ */
          text-align: center;
          white-space: nowrap; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }

        /* ëª¨ë‹¬ íŒ¨ë„ ìŠ¤íƒ€ì¼ - ê¸°ë³¸ (ëª¨ë°”ì¼) */
        #multiMapModal .panel {
          width: 100%; /* ëª¨ë‹¬ ë„ˆë¹„ë¥¼ í™”ë©´ í¬ê¸°ì— ë§ì¶¤ */
          max-width: 400px; /* ìµœëŒ€ ë„ˆë¹„ ì œí•œ */
          background: white;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          box-sizing: border-box;
        }

        /* ë°ìŠ¤í¬í†± í™˜ê²½ (í™”ë©´ ë„ˆë¹„ 768px ì´ìƒ) */
        @media (min-width: 768px) {
          .multi-map-option {
            width: 180px; /* ë°ìŠ¤í¬í†±ì—ì„œ ë” í° ë„ˆë¹„ */
            height: 140px; /* ë°ìŠ¤í¬í†±ì—ì„œ ë” í° ë†’ì´ */
            padding: 10px; /* ë” í° íŒ¨ë”© */
          }

          .multi-map-preview {
            width: 160px; /* ë°ìŠ¤í¬í†±ì—ì„œ ë” í° ë¯¸ë¦¬ë³´ê¸° */
            height: 90px; /* ë°ìŠ¤í¬í†±ì—ì„œ ë” í° ë†’ì´ */
            margin-bottom: 8px;
          }

          .multi-map-option span {
            font-size: 14px; /* ë°ìŠ¤í¬í†±ì—ì„œ ë” í° í…ìŠ¤íŠ¸ */
          }

          #multiMapModal .panel {
            max-width: 800px; /* ë°ìŠ¤í¬í†±ì—ì„œ ë” ë„“ì€ ëª¨ë‹¬ */
          }

          .multi-map-selection {
            gap: 20px; /* ë°ìŠ¤í¬í†±ì—ì„œ ë” í° ê°„ê²© */
            justify-content: center; /* ë°ìŠ¤í¬í†±ì—ì„œëŠ” ì¤‘ì•™ ì •ë ¬ */
            overflow-x: hidden; /* ë°ìŠ¤í¬í†±ì—ì„œëŠ” ìŠ¤í¬ë¡¤ ë¹„í™œì„±í™” */
          }
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0,0,0,0.5);
          align-items: center;
          justify-content: center;
          z-index: 100;
          padding: 10px;
          box-sizing: border-box;
        }
        .player-selection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        .player-option {
            width: 120px;
            height: 120px;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 10px;
            background-color: white;
        }
        .player-option:hover {
            border-color: #4CAF50;
            transform: scale(1.05);
        }
        .player-option.selected {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        .player-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 8px;
        }
        .usa-icon {
            background-color: #3c3b6e;
        }
        .china-icon {
            background-color: #de2910;
        }
        .row-icon {
            background-color: #607D8B;
        }
        .wto-icon {
            background-color: #2196F3;
        }
        .imf-icon {
            background-color: #9C27B0;
        }
        #scoresDisplay {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin: 10px 0;
        }
        .score-item {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
        }
        .usa-score {
            background-color: #3c3b6e;
        }
        .china-score {
            background-color: #de2910;
        }
        .row-score {
            background-color: #607D8B;
        }
        .wto-score {
            background-color: #2196F3;
        }
        .imf-score {
            background-color: #9C27B0;
        }
        #playerOrderDisplay {
            margin: 10px 0;
            padding: 5px;
            border-radius: 5px;
            background-color: #f5f5f5;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <h1>ì„¸ê· ì „ ê´€ì„¸ì „ìŸ</h1>
    
    <div class="game-container">
        <div class="board" id="board"></div>
        
        <div class="panel">
            <div id="turnInfo">ê²Œì„ ì‹œì‘</div>
            <div id="scoresDisplay"></div>
            <div id="playerOrderDisplay"></div>
            <div id="turnCounter">í„´: 1/25</div>
            <div id="message"></div>
            <button id="restartBtn">ê²Œì„ ì¬ì‹œì‘</button>
            
            <div id="gameRules">
                <strong>ê²Œì„ ê·œì¹™:</strong>
                <ul>
                    <li>ê° í”Œë ˆì´ì–´ëŠ” ìì‹ ì˜ ì°¨ë¡€ì— ì¸ì ‘í•œ ì…€ì— ë§ì„ ë†“ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    <li>ëª¨ë“  ë§ì€ ìƒí•˜ì¢Œìš°ë¡œë§Œ ì›€ì§ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    <li>ìƒëŒ€ë°© ë§ê³¼ ì ‘ì´‰í•˜ë©´ ìƒëŒ€ë°© ë§ì´ ìì‹ ì˜ ë§ë¡œ ë°”ë€ë‹ˆë‹¤.</li>
                    <li><strong>í•œë²ˆ ë§ì„ ë†“ì€ ê³³ì—ëŠ” ë‹¤ì‹œ ë§ì„ ë†“ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</strong></li>
                    <li>ìµœëŒ€ í„´ì´ ì§€ë‚˜ê±°ë‚˜, ëª¨ë“  ì…€ì´ ì ë ¹ë˜ê±°ë‚˜, í•œ í”Œë ˆì´ì–´ì˜ ì ìˆ˜ê°€ 0ì´ ë˜ë©´ ê²Œì„ì´ ì¢…ë£Œë©ë‹ˆë‹¤.</li>
                </ul>
            </div>
        </div>
    </div>
    <!-- ëª¨ë“œ ì„ íƒ ëª¨ë‹¬ -->
    <div class="modal" id="modeModal">
        <div class="panel" style="width: 450px;">
            <h2>ê²Œì„ ëª¨ë“œ ì„ íƒ</h2>
            <div style="display: flex; justify-content: center; gap: 20px;">
                <div class="mode-option" id="oneVsOneMode">
                    <div class="mode-icon">ğŸ‘¥</div>
                    <div class="mode-title">ì†”ë¡œ ëª¨ë“œ</div>
                    <div class="mode-desc">ì»´í“¨í„°ì™€ 1:1ë¡œ ëŒ€ê²°í•©ë‹ˆë‹¤</div>
                </div>
                <div class="mode-option" id="multiMode">
                    <div class="mode-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                    <div class="mode-title">ë‹¤ì¤‘ ëª¨ë“œ</div>
                    <div class="mode-desc">ì—¬ëŸ¬ ì„¸ë ¥ì´ í•¨ê»˜ í”Œë ˆì´í•©ë‹ˆë‹¤</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ê¸°ì¡´ ë§µ ì„ íƒ ëª¨ë‹¬ (ì†”ë¡œ ëª¨ë“œ) -->
    <div class="modal" id="mapModal">
        <div class="panel" style="width: 350px;">
            <h2>ë§µ ì„ íƒ</h2>
            <div class="map-selection">
                <div class="map-option selected" data-map="standard">
                    <div class="map-preview map-preview-5x5"></div>
                    <span>5x5 ê¸°ë³¸</span>
                </div>
                <div class="map-option" data-map="large">
                    <div class="map-preview map-preview-8x8"></div>
                    <span>8x8 í°ë§µ</span>
                </div>
                <div class="map-option" data-map="usa">
                    <div class="map-preview map-preview-usa"></div>
                    <span>ë¯¸êµ­ ë§µ</span>
                </div>
                <div class="map-option" data-map="china">
                    <div class="map-preview map-preview-china"></div>
                    <span>ì¤‘êµ­ ë§µ</span>
                </div>
            </div>
            <p>í”Œë ˆì´í•  êµ­ê°€ë¥¼ ì„ íƒí•˜ì„¸ìš”:</p>
            <button id="selectUSA">ë¯¸êµ­</button>
            <button id="selectChina">ì¤‘êµ­</button>
        </div>
    </div>
    
    <!-- ë‹¤ì¤‘ ë§µ ì„ íƒ ëª¨ë‹¬ (ìˆ˜ì •ë¨) -->
    <div class="modal" id="multiMapModal">
        <div class="panel" style="width: 450px;">
            <h2>ë‹¤ì¤‘ ëª¨ë“œ ë§µ ì„ íƒ</h2>
            <div class="multi-map-selection" style="flex-wrap: wrap; max-width: 420px;">
                <div class="multi-map-option selected" data-map="trident" style="width: 180px; margin-bottom: 15px;">
                    <div class="multi-map-preview map-preview-trident"></div>
                    <span>ì‚¼ì§€ì°½ ë§µ (3ì¸)</span>
                </div>
                <div class="multi-map-option" data-map="pacific" style="width: 180px; margin-bottom: 15px;">
                    <div class="multi-map-preview map-preview-pacific"></div>
                    <span>íƒœí‰ì–‘ ë¶„ì§€ë„ ë§µ (4ì¸)</span>
                </div>
                <div class="multi-map-option" data-map="islandMap" style="width: 180px; margin-bottom: 15px;">
                    <div class="multi-map-preview map-preview-island"></div>
                    <span>ì„¬ ë§µ (4ì¸)</span>
                </div>
                <div class="multi-map-option" data-map="mazeMap" style="width: 180px; margin-bottom: 15px;">
                    <div class="multi-map-preview map-preview-maze"></div>
                    <span>ë¯¸ë¡œ ë§µ (3ì¸)</span>
                </div>
            </div>
            <button id="nextToPlayerSelect">ë‹¤ìŒ</button>
            <button id="backToModeSelect">ë’¤ë¡œ</button>
        </div>
    </div>
    
    <!-- 3ì¸ í”Œë ˆì´ì–´ ì„ íƒ ëª¨ë‹¬ (ì‚¼ì§€ì°½ ë§µ) -->
    <div class="modal" id="tridentPlayerModal">
        <div class="panel" style="width: 450px;">
            <h2>í”Œë ˆì´ì–´ ì„ íƒ</h2>
            <p>í”Œë ˆì´í•  ì„¸ë ¥ì„ ì„ íƒí•˜ì„¸ìš”:</p>
            <div class="player-selection">
                <div class="player-option" data-player="usa">
                    <div class="player-icon usa-icon">USA</div>
                    <span>ë¯¸êµ­</span>
                </div>
                <div class="player-option" data-player="china">
                    <div class="player-icon china-icon">â˜…</div>
                    <span>ì¤‘êµ­</span>
                </div>
                <div class="player-option" data-player="row">
                    <div class="player-icon row-icon">ğŸŒ</div>
                    <span>ROW</span>
                </div>
            </div>
            <button id="startTridentGame">ê²Œì„ ì‹œì‘</button>
            <button id="backToMultiMapSelect">ë’¤ë¡œ</button>
        </div>
    </div>
    
    <!-- 4ì¸ í”Œë ˆì´ì–´ ì„ íƒ ëª¨ë‹¬ (íƒœí‰ì–‘ ë¶„ì§€ë„ ë§µ) -->
    <div class="modal" id="pacificPlayerModal">
        <div class="panel" style="width: 520px;">
            <h2>í”Œë ˆì´ì–´ ì„ íƒ</h2>
            <p>í”Œë ˆì´í•  ì„¸ë ¥ì„ ì„ íƒí•˜ì„¸ìš”:</p>
            <div class="player-selection">
                <div class="player-option" data-player="usa">
                    <div class="player-icon usa-icon">USA</div>
                    <span>ë¯¸êµ­</span>
                </div>
                <div class="player-option" data-player="china">
                    <div class="player-icon china-icon">â˜…</div>
                    <span>ì¤‘êµ­</span>
                </div>
                <div class="player-option" data-player="wto">
                    <div class="player-icon wto-icon">WTO</div>
                    <span>WTO</span>
                </div>
                <div class="player-option" data-player="imf">
                    <div class="player-icon imf-icon">$</div>
                    <span>IMF</span>
                </div>
            </div>
            <button id="startPacificGame">ê²Œì„ ì‹œì‘</button>
            <button id="backToMultiMapSelect2">ë’¤ë¡œ</button>
        </div>
    </div>
    
    <!-- ê²Œì„ ê²°ê³¼ ëª¨ë‹¬ -->
    <div class="modal" id="resultModal" style="display: none;">
        <div class="panel">
            <h2 id="resultTitle">ê²Œì„ ì¢…ë£Œ!</h2>
            <p id="resultDesc"></p>
            <button id="newGameBtn">ìƒˆ ê²Œì„</button>
        </div>
    </div>
<script>
// ê²Œì„ ìƒíƒœ
        const game = {
            board: [], // ë³´ë“œ ìƒíƒœ (usa, china, wall, ë˜ëŠ” ë¹ˆì¹¸)
            visitedCells: [], // ë°©ë¬¸í•œ ì…€ (true, false)
            size: { width: 5, height: 5 }, // ê¸°ë³¸ ë§µ í¬ê¸°
            currentPlayer: 'usa',
            humanPlayer: '',
            computerPlayers: [], // ë‹¤ì¤‘ ëª¨ë“œë¥¼ ìœ„í•œ ì»´í“¨í„° í”Œë ˆì´ì–´ ë°°ì—´
            scores: { usa: 1, china: 1 }, // ê¸°ë³¸ ì ìˆ˜ (ë‹¤ì¤‘ ëª¨ë“œì—ì„œëŠ” í™•ì¥ë¨)
            turnCount: 1,
            maxTurns: 25, // ìµœëŒ€ í„´ ìˆ˜
            lastMove: { x: -1, y: -1 },  // ë§ˆì§€ë§‰ ì´ë™ ìœ„ì¹˜
            moveHistory: [],              // ì´ë™ ê¸°ë¡
            mapType: 'standard',          // ë§µ íƒ€ì… (standard, large, usa, china, trident, pacific)
            activeCells: [],              // í™œì„±í™”ëœ ì…€
            gameMode: '',                 // ê²Œì„ ëª¨ë“œ (oneVsOne, multi)
            multiMode: '',                // ë‹¤ì¤‘ ëª¨ë“œ íƒ€ì… (trident, pacific)
            playerOrder: [],              // í”Œë ˆì´ì–´ ìˆœì„œ ë°°ì—´
            isGameOver: false             // ê²Œì„ ì¢…ë£Œ ìƒíƒœ
        };

        // ë§µ ì„¤ì •
        const mapConfigs = {
            standard: {
                width: 5,
                height: 5,
                cellSize: 55,
                wallCount: { min: 2, max: 4 },
                maxTurns: 25
            },
            large: {
                width: 8,
                height: 8,
                cellSize: 45,
                wallCount: { min: 4, max: 8 },
                maxTurns: 64
            },
            usa: {
                width: 10,
                height: 8,
                cellSize: 40,
                wallCount: { min: 3, max: 6 },
                maxTurns: 50
            },
            china: {
                width: 10,
                height: 9,
                cellSize: 40,
                wallCount: { min: 3, max: 6 },
                maxTurns: 50
            },
            // ì‚¼ì§€ì°½ ë§µ (1:1:1 ëª¨ë“œ)
            trident: {
                width: 11,
                height: 11,
                cellSize: 38,
                wallCount: { min: 5, max: 10 },
                maxTurns: 81
            },
            // íƒœí‰ì–‘ ë¶„ì§€ë„ ë§µ (1:1:1:1 ëª¨ë“œ)
            pacific: {
                width: 8,
                height: 8,
                cellSize: 45,
                wallCount: { min: 3, max: 6 },
                maxTurns: 64
            },
            // ì„¬ë§µ (14x14 - 4ì¸ ëª¨ë“œë¡œ ìˆ˜ì •)
            islandMap: {
                width: 14,
                height: 14,
                cellSize: 32,
                wallCount: { min: 5, max: 10 },
                maxTurns: 130
            },
            // ë¯¸ë¡œë§µ (14x14 - 3ì¸ ëª¨ë“œë¡œ ìˆ˜ì •)
            mazeMap: {
                width: 10,
                height: 10,
                cellSize: 38,
                wallCount: { min: 3, max: 6 },
                maxTurns: 60
            }
        };

        // í”Œë ˆì´ì–´ ì •ë³´
        const playerInfo = {
            usa: { name: 'ë¯¸êµ­', displayName: 'ë¯¸êµ­', emoji: 'USA', color: '#3c3b6e' },
            china: { name: 'ì¤‘êµ­', displayName: 'ì¤‘êµ­', emoji: 'â˜…', color: '#de2910' },
            row: { name: 'ROW', displayName: 'ROW', emoji: 'ğŸŒ', color: '#607D8B' },
            wto: { name: 'WTO', displayName: 'WTO', emoji: 'WTO', color: '#2196F3' },
            imf: { name: 'IMF', displayName: 'IMF', emoji: '$', color: '#9C27B0' }
        };

        // ë¯¸êµ­ ë§µ í˜•íƒœ (1ì€ í™œì„± ì…€, 0ì€ ë¹„í™œì„± ì…€)
        const usaMapTemplate = [
            [0,0,0,0,0,0,0,0,0,0],
            [0,1,1,1,1,1,1,1,1,0],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,0],
            [0,1,1,1,1,1,1,0,0,0],
            [0,0,0,0,0,0,0,0,0,0]
        ];

        // ì¤‘êµ­ ë§µ í˜•íƒœ (1ì€ í™œì„± ì…€, 0ì€ ë¹„í™œì„± ì…€)
        const chinaMapTemplate = [
            [0,0,0,1,1,1,1,0,0,0],
            [0,0,1,1,1,1,1,1,0,0],
            [0,1,1,1,1,1,1,1,1,0],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [0,1,1,1,1,1,1,1,1,0],
            [0,0,1,1,1,1,1,1,0,0],
            [0,0,0,1,1,1,1,0,0,0]
        ];

        // ì‚¼ì§€ì°½ ë§µ í˜•íƒœ (1ì€ í™œì„± ì…€, 0ì€ ë¹„í™œì„± ì…€)
        const tridentMapTemplate = [
            [0,0,0,0,0,1,0,0,0,0,0],
            [0,0,0,0,1,1,1,0,0,0,0],
            [0,0,0,0,1,1,1,0,0,0,0],
            [0,0,0,1,1,1,1,1,0,0,0],
            [0,0,0,1,1,1,1,1,0,0,0],
            [0,0,1,1,1,1,1,1,1,0,0],
            [0,0,1,1,1,1,1,1,1,0,0],
            [0,1,1,1,1,1,1,1,1,1,0],
            [1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,0,0,0,0,0,1,1,1],
            [1,1,0,0,0,0,0,0,0,1,1]
        ];

        // íƒœí‰ì–‘ ë¶„ì§€ë„ ë§µ í˜•íƒœ (1ì€ í™œì„± ì…€, 0ì€ ë¹„í™œì„± ì…€, ê° ëŒ€ë¥™ì— í”Œë ˆì´ì–´ ë°°ì¹˜)
        const pacificBasinMapTemplate = [
            [1,1,1,1,1,1,1,1],
            [1,0,1,1,1,1,0,1],
            [1,1,1,1,1,1,1,1],
            [1,1,1,0,0,1,1,1],
            [1,1,1,0,0,1,1,1],
            [1,1,1,1,1,1,1,1],
            [1,0,1,1,1,1,0,1],
            [1,1,1,1,1,1,1,1]
        ];
        
        // ìˆ˜ì •ëœ ì„¬ë§µ í…œí”Œë¦¿ (14x14 - 4ì¸ ëª¨ë“œ, ëª¨ë“  ì‘ì€ ì„¬ì—ì„œ ì¤‘ì•™ ì„¬ìœ¼ë¡œ ê°€ëŠ” ê²½ë¡œ ì¶”ê°€ë¨)
        const islandMapTemplate = [
            [0,0,0,0,1,1,1,1,1,1,0,0,0,0],
            [0,0,0,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,1,1,0,0,1,1,0,0,1,1,0,0],
            [0,1,1,0,0,0,1,1,0,0,0,1,1,0],
            [1,1,0,0,0,1,1,1,1,0,0,0,1,1],
            [1,1,0,0,1,1,1,1,1,1,0,0,1,1],
            [1,1,1,0,1,1,1,1,1,1,1,1,1,1], 
            [1,1,1,0,1,1,1,1,1,1,0,1,1,1], 
            [1,1,0,0,1,1,1,1,1,1,0,0,1,1],
            [1,1,0,1,1,1,1,1,1,1,0,1,1,1], 
            [0,1,1,1,0,1,1,1,1,0,1,1,1,0], 
            [0,0,1,1,0,0,1,1,0,0,1,1,0,0],
            [0,0,0,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,0,0,1,1,1,1,1,1,0,0,0,0]
        ];
    // ë” ë³µì¡í•œ ë¯¸ë¡œë§µ í…œí”Œë¦¿ - 
        const mazeMapTemplate = [
            [1,1,1,1,1,1,1,1,1,1],
            [1,0,0,1,0,0,1,0,0,1],
            [1,0,1,1,1,1,1,1,0,1],
            [1,0,1,0,0,1,0,1,0,1],
            [1,1,1,0,1,1,0,1,1,1],
            [1,0,1,0,1,0,0,1,0,1],
            [1,0,1,0,1,1,1,1,0,1],
            [1,0,1,1,1,0,0,1,0,1],
            [1,0,0,0,1,1,0,1,0,1],
            [1,1,1,1,1,1,1,1,1,1]
        ];
        // DOM ìš”ì†Œ
        const boardEl = document.getElementById('board');
        const turnInfoEl = document.getElementById('turnInfo');
        const scoresDisplayEl = document.getElementById('scoresDisplay');
        const turnCounterEl = document.getElementById('turnCounter');
        const messageEl = document.getElementById('message');
        const modeModalEl = document.getElementById('modeModal');
        const mapModalEl = document.getElementById('mapModal');
        const multiMapModalEl = document.getElementById('multiMapModal');
        const tridentPlayerModalEl = document.getElementById('tridentPlayerModal');
        const pacificPlayerModalEl = document.getElementById('pacificPlayerModal');
        const resultModalEl = document.getElementById('resultModal');
        const resultTitleEl = document.getElementById('resultTitle');
        const resultDescEl = document.getElementById('resultDesc');
        const playerOrderDisplayEl = document.getElementById('playerOrderDisplay');

        // ê¸°ë³¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('oneVsOneMode').addEventListener('click', () => selectGameMode('oneVsOne'));
        document.getElementById('multiMode').addEventListener('click', () => selectGameMode('multi'));
        document.getElementById('selectUSA').addEventListener('click', () => selectCountry('usa'));
        document.getElementById('selectChina').addEventListener('click', () => selectCountry('china'));
        document.getElementById('restartBtn').addEventListener('click', showModeModal);
        document.getElementById('newGameBtn').addEventListener('click', showModeModal);

        // ë§µ ì˜µì…˜ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelectorAll('.map-option').forEach(option => {
            option.addEventListener('click', function() {
                // ëª¨ë“  ì˜µì…˜ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
                document.querySelectorAll('.map-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                // í´ë¦­í•œ ì˜µì…˜ì— selected í´ë˜ìŠ¤ ì¶”ê°€
                this.classList.add('selected');
                
                // ì„ íƒëœ ë§µ íƒ€ì… ì €ì¥
                game.mapType = this.dataset.map;
            });
        });

        // ë‹¤ì¤‘ ëª¨ë“œ ë§µ ì˜µì…˜ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll('.multi-map-option').forEach(option => {
            option.addEventListener('click', function() {
                // ëª¨ë“  ì˜µì…˜ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
                document.querySelectorAll('.multi-map-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                // í´ë¦­í•œ ì˜µì…˜ì— selected í´ë˜ìŠ¤ ì¶”ê°€
                this.classList.add('selected');
                
                // ì„ íƒëœ ë‹¤ì¤‘ ëª¨ë“œ ë§µ íƒ€ì… ì €ì¥
                game.multiMode = this.dataset.map;
            });
        });

        // ë‹¤ì¤‘ ëª¨ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('nextToPlayerSelect').addEventListener('click', showPlayerSelectionModal);
        document.getElementById('backToModeSelect').addEventListener('click', showModeModal);
        document.getElementById('backToMultiMapSelect').addEventListener('click', showMultiMapModal);
        document.getElementById('backToMultiMapSelect2').addEventListener('click', showMultiMapModal);
        document.getElementById('startTridentGame').addEventListener('click', startMultiGame);
        document.getElementById('startPacificGame').addEventListener('click', startMultiGame);

        // í”Œë ˆì´ì–´ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll('.player-option').forEach(option => {
            option.addEventListener('click', function() {
                const modalId = this.closest('.modal').id;
                const playerOptions = document.querySelectorAll(`#${modalId} .player-option`);
                
                // ëª¨ë“  ì˜µì…˜ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
                playerOptions.forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // í´ë¦­í•œ ì˜µì…˜ì— selected í´ë˜ìŠ¤ ì¶”ê°€
                this.classList.add('selected');
            });
        });

        // ê²Œì„ ëª¨ë“œ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
        function showModeModal() {
            modeModalEl.style.display = 'flex';
            mapModalEl.style.display = 'none';
            multiMapModalEl.style.display = 'none';
            tridentPlayerModalEl.style.display = 'none';
            pacificPlayerModalEl.style.display = 'none';
            resultModalEl.style.display = 'none';
            
            // ê²Œì„ ëª¨ë“œ ì´ˆê¸°í™”
            game.gameMode = '';
            game.multiMode = '';
        }

        // ê²Œì„ ëª¨ë“œ ì„ íƒ
        function selectGameMode(mode) {
            game.gameMode = mode;
            modeModalEl.style.display = 'none';
            
            if (mode === 'oneVsOne') {
                showMapModal();
            } else if (mode === 'multi') {
                showMultiMapModal();
            }
        }

        // ë§µ ëª¨ë‹¬ í‘œì‹œ (ì†”ë¡œ ëª¨ë“œ)
        function showMapModal() {
            // ê¸°ë³¸ ë§µ ì„ íƒ
            document.querySelectorAll('.map-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`.map-option[data-map="standard"]`).classList.add('selected');
            game.mapType = 'standard';
            
            mapModalEl.style.display = 'flex';
            resultModalEl.style.display = 'none';
        }

        // ë‹¤ì¤‘ ëª¨ë“œ ë§µ ëª¨ë‹¬ í‘œì‹œ
        function showMultiMapModal() {
            // ê¸°ë³¸ ë‹¤ì¤‘ ë§µ ì„ íƒ
            document.querySelectorAll('.multi-map-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`.multi-map-option[data-map="trident"]`).classList.add('selected');
            game.multiMode = 'trident';
            
            multiMapModalEl.style.display = 'flex';
            tridentPlayerModalEl.style.display = 'none';
            pacificPlayerModalEl.style.display = 'none';
            modeModalEl.style.display = 'none';
        }

        // í”Œë ˆì´ì–´ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
        function showPlayerSelectionModal() {
            multiMapModalEl.style.display = 'none';
            
            // í”Œë ˆì´ì–´ ì„ íƒ ì´ˆê¸°í™”
            document.querySelectorAll('.player-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            if (game.multiMode === 'trident') {
                tridentPlayerModalEl.style.display = 'flex';
                document.querySelector('#tridentPlayerModal .player-option[data-player="usa"]').classList.add('selected');
            } else if (game.multiMode === 'pacific') {
                pacificPlayerModalEl.style.display = 'flex';
                document.querySelector('#pacificPlayerModal .player-option[data-player="usa"]').classList.add('selected');
            } else if (game.multiMode === 'islandMap') {
                pacificPlayerModalEl.style.display = 'flex';
                document.querySelector('#pacificPlayerModal .player-option[data-player="usa"]').classList.add('selected');
            } else if (game.multiMode === 'mazeMap') {
                tridentPlayerModalEl.style.display = 'flex';
                document.querySelector('#tridentPlayerModal .player-option[data-player="usa"]').classList.add('selected');
            }
        }

        // êµ­ê°€ ì„ íƒ (ì†”ë¡œ ëª¨ë“œ)
        function selectCountry(country) {
            game.humanPlayer = country;
            game.computerPlayers = [country === 'usa' ? 'china' : 'usa'];
            
            // ì„ íƒëœ ë§µ íƒ€ì… ì ìš©
            const config = mapConfigs[game.mapType];
            game.size = { width: config.width, height: config.height };
            game.maxTurns = config.maxTurns;
            
            // í”Œë ˆì´ì–´ ìˆœì„œ ì„¤ì •
            game.playerOrder = shuffleArray(['usa', 'china']);
            
            // íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
            document.title = `ì„¸ê· ì „ ê´€ì„¸ì „ìŸ ${config.width}x${config.height}`;
            
            mapModalEl.style.display = 'none';
            initGame();
            
            // ì»´í“¨í„° ì°¨ë¡€ì¼ ê²½ìš°
            if (game.currentPlayer !== game.humanPlayer) {
                setTimeout(computerTurn, 1000);
            }
        }

        // ë‹¤ì¤‘ ëª¨ë“œ ê²Œì„ ì‹œì‘
        function startMultiGame() {
            let selectedPlayerEl;
            
            if (game.multiMode === 'trident') {
                tridentPlayerModalEl.style.display = 'none';
                selectedPlayerEl = document.querySelector('#tridentPlayerModal .player-option.selected');
                game.mapType = 'trident';
                
                // íŠ¸ë¼ì´ë˜íŠ¸ ëª¨ë“œì—ì„œëŠ” 3ëª…ì˜ í”Œë ˆì´ì–´, ìˆœì„œë¥¼ ëœë¤í™”
                game.playerOrder = shuffleArray(['usa', 'china', 'row']);
            } else if (game.multiMode === 'pacific') {
                pacificPlayerModalEl.style.display = 'none';
                selectedPlayerEl = document.querySelector('#pacificPlayerModal .player-option.selected');
                game.mapType = 'pacific';
                
                // íƒœí‰ì–‘ ëª¨ë“œì—ì„œëŠ” 4ëª…ì˜ í”Œë ˆì´ì–´, ìˆœì„œë¥¼ ëœë¤í™”
                game.playerOrder = shuffleArray(['usa', 'china', 'wto', 'imf']);
            } else if (game.multiMode === 'islandMap') {
                pacificPlayerModalEl.style.display = 'none';
                selectedPlayerEl = document.querySelector('#pacificPlayerModal .player-option.selected');
                game.mapType = 'islandMap';
                
                // ì„¬ë§µ ëª¨ë“œì—ì„œëŠ” 4ëª…ì˜ í”Œë ˆì´ì–´, ìˆœì„œë¥¼ ëœë¤í™”
                game.playerOrder = shuffleArray(['usa', 'china', 'wto', 'imf']);
            } else if (game.multiMode === 'mazeMap') {
                tridentPlayerModalEl.style.display = 'none';
                selectedPlayerEl = document.querySelector('#tridentPlayerModal .player-option.selected');
                game.mapType = 'mazeMap';
                
                // ë¯¸ë¡œë§µ ëª¨ë“œì—ì„œëŠ” 3ëª…ì˜ í”Œë ˆì´ì–´, ìˆœì„œë¥¼ ëœë¤í™”
                game.playerOrder = shuffleArray(['usa', 'china', 'row']);
            }
            
            // ì‚¬ëŒ í”Œë ˆì´ì–´ ì„¤ì •
            game.humanPlayer = selectedPlayerEl ? selectedPlayerEl.dataset.player : game.playerOrder[0];
            
            // ì»´í“¨í„° í”Œë ˆì´ì–´ ì„¤ì • (ì‚¬ëŒ í”Œë ˆì´ì–´ë¥¼ ì œì™¸í•œ ëª¨ë“  í”Œë ˆì´ì–´)
            game.computerPlayers = game.playerOrder.filter(player => player !== game.humanPlayer);
            
            // ë§µ ì„¤ì • ì ìš©
            const config = mapConfigs[game.mapType];
            game.size = { width: config.width, height: config.height };
            game.maxTurns = config.maxTurns;
            
            // íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
            document.title = `ì„¸ê· ì „ ê´€ì„¸ì „ìŸ - ë‹¤ì¤‘ ëª¨ë“œ ${config.width}x${config.height}`;
            
            initGame();
            
            // ì»´í“¨í„° ì°¨ë¡€ì¼ ê²½ìš°
            if (game.currentPlayer !== game.humanPlayer) {
                setTimeout(computerTurn, 1000);
            }
        }

        // ê²Œì„ ì´ˆê¸°í™”
        function initGame() {
            const config = mapConfigs[game.mapType];
            game.isGameOver = false;
            
            // ë³´ë“œ ì´ˆê¸°í™”
            game.board = Array(config.height).fill().map(() => Array(config.width).fill(''));
            
            // ë°©ë¬¸í•œ ì…€ ì´ˆê¸°í™” (ëª¨ë‘ falseë¡œ ì„¤ì •)
            game.visitedCells = Array(config.height).fill().map(() => Array(config.width).fill(false));
            
            // í™œì„± ì…€ ì´ˆê¸°í™”
            game.activeCells = Array(config.height).fill().map(() => Array(config.width).fill(true));
            
            // ë§µ íƒ€ì…ì— ë”°ë¥¸ í™œì„± ì…€ ì„¤ì •
            if (game.mapType === 'usa') {
                setActiveCellsFromTemplate(usaMapTemplate);
            } else if (game.mapType === 'china') {
                setActiveCellsFromTemplate(chinaMapTemplate);
            } else if (game.mapType === 'trident') {
                setActiveCellsFromTemplate(tridentMapTemplate);
            } else if (game.mapType === 'pacific') {
                setActiveCellsFromTemplate(pacificBasinMapTemplate);
            } else if (game.mapType === 'islandMap') {
                setActiveCellsFromTemplate(islandMapTemplate);
            } else if (game.mapType === 'mazeMap') {
                setActiveCellsFromTemplate(mazeMapTemplate);
            }
            
            // ì´ˆê¸° ì ìˆ˜ ì„¤ì •
            initializeScores();
            
            // ì´ˆê¸° ë°°ì¹˜ ì„¤ì •
            placeInitialPieces();
            
            // ë§µ íƒ€ì…ì— ë”°ë¥¸ ë²½ ë°°ì¹˜
            const wallCount = Math.floor(Math.random() * 
                (config.wallCount.max - config.wallCount.min + 1)) + config.wallCount.min;
            placeRandomWalls(wallCount);
            
            // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
            game.currentPlayer = game.playerOrder[0]; // ì²« ë²ˆì§¸ í”Œë ˆì´ì–´ë¶€í„° ì‹œì‘
            game.turnCount = 1;
            game.lastMove = { x: -1, y: -1 };
            game.moveHistory = [];
            
            // UI ì—…ë°ì´íŠ¸
            renderBoard();
            updateInfo();
            
            // ê²°ê³¼ ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
            resultModalEl.style.display = 'none';
            messageEl.textContent = '';
        }

        // í™œì„± ì…€ í…œí”Œë¦¿ ì„¤ì •
        function setActiveCellsFromTemplate(template) {
            for (let y = 0; y < template.length; y++) {
                for (let x = 0; x < template[y].length; x++) {
                    game.activeCells[y][x] = template[y][x] === 1;
                    if (!game.activeCells[y][x]) {
                        game.visitedCells[y][x] = true; // ë¹„í™œì„± ì…€ì€ ë°©ë¬¸í•œ ê²ƒìœ¼ë¡œ í‘œì‹œ
                    }
                }
            }
        }

        // ì´ˆê¸° ì ìˆ˜ ì„¤ì •
        function initializeScores() {
            game.scores = {};
            
            // ëª¨ë“  í”Œë ˆì´ì–´ì˜ ì ìˆ˜ ì´ˆê¸°í™”
            game.playerOrder.forEach(player => {
                game.scores[player] = 0;
            });
        }

        // ì´ˆê¸° ë°°ì¹˜ ì„¤ì •
        function placeInitialPieces() {
            if (game.mapType === 'standard') {
                // ê¸°ë³¸ ë§µì—ì„œëŠ” ëª¨ì„œë¦¬ì— ëœë¤í•˜ê²Œ ë°°ì¹˜
                const startPositions = [
                    {x: 0, y: 0},
                    {x: game.size.width-1, y: game.size.height-1}
                ];
                
                // í”Œë ˆì´ì–´ ìˆœì„œ ëœë¤í™”
                const shuffledPlayers = shuffleArray([...game.playerOrder]);
                
                // ì´ˆê¸° ì ìˆ˜ ì´ˆê¸°í™”
                game.playerOrder.forEach(player => {
                    game.scores[player] = 0;
                });
                
                // ê° ìœ„ì¹˜ì— í”Œë ˆì´ì–´ ë°°ì¹˜
                for (let i = 0; i < shuffledPlayers.length; i++) {
                    const pos = startPositions[i];
                    const player = shuffledPlayers[i];
                    
                    game.board[pos.y][pos.x] = player;
                    game.visitedCells[pos.y][pos.x] = true;
                    game.scores[player]++;
                }
            } 
            else if (game.mapType === 'large') {
                // 8x8 ë§µì˜ ê²½ìš° Xì í˜•íƒœë¡œ ë‘ ê°œì”© ë°°ì¹˜
                const startPositions = [
                    [{x: 0, y: 0}, {x: game.size.width-1, y: game.size.height-1}],
                    [{x: game.size.width-1, y: 0}, {x: 0, y: game.size.height-1}]
                ];
                
                // í”Œë ˆì´ì–´ ìˆœì„œ ëœë¤í™”
                const shuffledPlayers = shuffleArray([...game.playerOrder]);
                
                // ì´ˆê¸° ì ìˆ˜ ì´ˆê¸°í™”
                game.playerOrder.forEach(player => {
                    game.scores[player] = 0;
                });
                
                // ê° ìœ„ì¹˜ì— í”Œë ˆì´ì–´ ë°°ì¹˜
                for (let i = 0; i < shuffledPlayers.length; i++) {
                    const positions = startPositions[i];
                    const player = shuffledPlayers[i];
                    
                    // ê° í”Œë ˆì´ì–´ëŠ” ëŒ€ê°ì„  ë°˜ëŒ€í¸ì— 2ê°œì”© ë°°ì¹˜
                    for (const pos of positions) {
                        game.board[pos.y][pos.x] = player;
                        game.visitedCells[pos.y][pos.x] = true;
                        game.scores[player]++;
                    }
                }
            } 
            else if (game.mapType === 'usa' || game.mapType === 'china') {
                // í”Œë ˆì´ì–´ ëœë¤í•˜ê²Œ ì„ íƒ
                const shuffledPlayers = shuffleArray([...game.playerOrder]);
                placeFourCornerPieces(shuffledPlayers);
            }
            else if (game.mapType === 'trident') {
                // ì‚¼ì§€ì°½ ë§µì—ì„œëŠ” ê° ê°€ì§€ ëì— í”Œë ˆì´ì–´ ë°°ì¹˜
                const activeCells = findActiveCellsEdges();
                
                // ì‹œì‘ ìœ„ì¹˜ ì •ì˜
                const startPositions = [
                    // ë¶ìª½ ë
                    activeCells.find(cell => cell.y === 0),
                    // ì™¼ìª½ í•˜ë‹¨ ë
                    activeCells.find(cell => 
                        cell.y === game.size.height - 1 && cell.x < game.size.width / 2),
                    // ì˜¤ë¥¸ìª½ í•˜ë‹¨ ë
                    activeCells.filter(cell => 
                        cell.y === game.size.height - 1 && cell.x >= game.size.width / 2)
                        .sort((a, b) => b.x - a.x)[0]
                ];
                
                // í”Œë ˆì´ì–´ ìˆœì„œ ëœë¤í™”
                const shuffledPlayers = shuffleArray([...game.playerOrder]);
                
                // ì´ˆê¸° ì ìˆ˜ ì´ˆê¸°í™”
                game.playerOrder.forEach(player => {
                    game.scores[player] = 0;
                });
                
                // ê° ìœ„ì¹˜ì— í”Œë ˆì´ì–´ ë°°ì¹˜
                for (let i = 0; i < shuffledPlayers.length; i++) {
                    const pos = startPositions[i];
                    const player = shuffledPlayers[i];
                    
                    if (pos) {
                        game.board[pos.y][pos.x] = player;
                        game.visitedCells[pos.y][pos.x] = true;
                        game.scores[player]++;
                    }
                }
            }
            else if (game.mapType === 'pacific') {
                // íƒœí‰ì–‘ ë¶„ì§€ë„ ë§µì—ì„œëŠ” ê° ëŒ€ë¥™ì— í”Œë ˆì´ì–´ ë°°ì¹˜
                const activeCells = findActiveCellsEdges();
                
                // ì‹œì‘ ìœ„ì¹˜ ì •ì˜
                const startPositions = [
                    // ë¶ë¯¸(ì™¼ìª½ ìƒë‹¨)
                    activeCells.find(cell => 
                        cell.y === 0 && cell.x < game.size.width / 3),
                    // ì•„ì‹œì•„(ì˜¤ë¥¸ìª½ ìƒë‹¨)
                    activeCells.filter(cell => 
                        cell.y === 0 && cell.x >= game.size.width * 2 / 3)
                        .sort((a, b) => b.x - a.x)[0],
                    // í˜¸ì£¼(ì˜¤ë¥¸ìª½ í•˜ë‹¨)
                    activeCells.filter(cell => 
                        cell.y === game.size.height - 1 && cell.x >= game.size.width * 2 / 3)
                        .sort((a, b) => b.x - a.x)[0],
                    // ë‚¨ë¯¸(ì™¼ìª½ í•˜ë‹¨)
                    activeCells.find(cell => 
                        cell.y === game.size.height - 1 && cell.x < game.size.width / 3)
                ];
                
                // í”Œë ˆì´ì–´ ìˆœì„œ ëœë¤í™”
                const shuffledPlayers = shuffleArray([...game.playerOrder]);
                
                // ì´ˆê¸° ì ìˆ˜ ì´ˆê¸°í™”
                game.playerOrder.forEach(player => {
                    game.scores[player] = 0;
                });
                
                // ê° ìœ„ì¹˜ì— í”Œë ˆì´ì–´ ë°°ì¹˜
                for (let i = 0; i < shuffledPlayers.length; i++) {
                    const pos = startPositions[i];
                    const player = shuffledPlayers[i];
                    
                    if (pos) {
                        game.board[pos.y][pos.x] = player;
                        game.visitedCells[pos.y][pos.x] = true;
                        game.scores[player]++;
                    }
                }
            }
            else if (game.mapType === 'islandMap') {
                // ì„¬ë§µ ì „ìš© ì´ˆê¸° ë°°ì¹˜ í•¨ìˆ˜ í˜¸ì¶œ
                placeInitialPiecesIslandMap();
            }
            else if (game.mapType === 'mazeMap') {
                // ë¯¸ë¡œë§µ ì „ìš© ì´ˆê¸° ë°°ì¹˜ í•¨ìˆ˜ í˜¸ì¶œ
                placeInitialPiecesMazeMap();
            }
        }

        // í”Œë ˆì´ì–´ ì´ˆê¸° ë°°ì¹˜ë¥¼ ìˆ˜ì •í•˜ëŠ” í•¨ìˆ˜ - ì„¬ë§µìš©
        function placeInitialPiecesIslandMap() {
            // ì„¬ë§µì—ì„œ ê° í”Œë ˆì´ì–´ ìœ„ì¹˜ ì •ì˜
            const startPositions = [
                {x: 2, y: 2},     // ì™¼ìª½ ìƒë‹¨ ì‘ì€ ì„¬
                {x: 11, y: 2},    // ì˜¤ë¥¸ìª½ ìƒë‹¨ ì‘ì€ ì„¬
                {x: 2, y: 11},    // ì™¼ìª½ í•˜ë‹¨ ì‘ì€ ì„¬
                {x: 11, y: 11}    // ì˜¤ë¥¸ìª½ í•˜ë‹¨ ì‘ì€ ì„¬
            ];
            
            // í”Œë ˆì´ì–´ ìˆœì„œ ëœë¤í™”
            const shuffledPlayers = shuffleArray([...game.playerOrder]);
            
            // ì´ˆê¸° ì ìˆ˜ ì´ˆê¸°í™”
            game.playerOrder.forEach(player => {
                game.scores[player] = 0;
            });
            
            // ê° ìœ„ì¹˜ì— í”Œë ˆì´ì–´ ë°°ì¹˜
            for (let i = 0; i < shuffledPlayers.length; i++) {
                const pos = startPositions[i];
                const player = shuffledPlayers[i];
                
                // ë§ì„ í™•ì‹¤íˆ ë°°ì¹˜í•˜ê¸° ìœ„í•´ í™œì„± ì…€ ì—¬ë¶€ ì²´í¬ í›„ ë°°ì¹˜
                if (game.activeCells[pos.y][pos.x]) {
                    game.board[pos.y][pos.x] = player;
                    game.visitedCells[pos.y][pos.x] = true;
                    game.scores[player]++;
                } else {
                    // ë§Œì•½ ì§€ì •ëœ ìœ„ì¹˜ê°€ ë¹„í™œì„± ì…€ì´ë©´ ê·¼ì²˜ì˜ í™œì„± ì…€ ì°¾ê¸°
                    for (let dy = -1; dy <= 1; dy++) {
                        for (let dx = -1; dx <= 1; dx++) {
                            const nx = pos.x + dx;
                            const ny = pos.y + dy;
                            if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height && 
                                game.activeCells[ny][nx] && !game.visitedCells[ny][nx]) {
                                game.board[ny][nx] = player;
                                game.visitedCells[ny][nx] = true;
                                game.scores[player]++;
                                return; // ë§ì„ ë†“ì•˜ìœ¼ë©´ í•¨ìˆ˜ ì¢…ë£Œ
                            }
                        }
                    }
                }
            }
        }

        // í”Œë ˆì´ì–´ ì´ˆê¸° ë°°ì¹˜ë¥¼ ìˆ˜ì •í•˜ëŠ” í•¨ìˆ˜ - ë¯¸ë¡œë§µìš©
        function placeInitialPiecesMazeMap() {
            // ë¯¸ë¡œë§µì—ì„œ ê° í”Œë ˆì´ì–´ ìœ„ì¹˜ ì •ì˜
            const startPositions = [
                {x: 2, y: 2},     // ì™¼ìª½ ìƒë‹¨
                {x: 7, y: 2},     // ì˜¤ë¥¸ìª½ ìƒë‹¨
                {x: 2, y: 7}      // ì™¼ìª½ í•˜ë‹¨
            ];
            
            // í”Œë ˆì´ì–´ ìˆœì„œ ëœë¤í™”
            const shuffledPlayers = shuffleArray([...game.playerOrder]);
            
            // ì´ˆê¸° ì ìˆ˜ ì´ˆê¸°í™”
            game.playerOrder.forEach(player => {
                game.scores[player] = 0;
            });
            
            // ê° ìœ„ì¹˜ì— í”Œë ˆì´ì–´ ë°°ì¹˜
            for (let i = 0; i < shuffledPlayers.length; i++) {
                const pos = startPositions[i];
                const player = shuffledPlayers[i];
                
                // ì…€ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                if (game.activeCells[pos.y][pos.x]) {
                    game.board[pos.y][pos.x] = player;
                    game.visitedCells[pos.y][pos.x] = true;
                    game.scores[player]++;
                }
            }
        }

        // ë°°ì—´ ëœë¤ ì„ê¸° í•¨ìˆ˜ (Fisher-Yates ì•Œê³ ë¦¬ì¦˜)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Xì í˜•íƒœë¡œ ì½”ë„ˆì— ë§ ë°°ì¹˜
        function placeFourCornerPieces(players) {
            let activeCellsList = [];
            
            // í™œì„± ì…€ ëª©ë¡ ìƒì„±
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    if (game.activeCells[y][x]) {
                        activeCellsList.push({x, y});
                    }
                }
            }
            
            // ë§µì˜ ë„¤ ëª¨ì„œë¦¬ì— ê°€ê¹Œìš´ í™œì„± ì…€ ì°¾ê¸°
            let topLeft = null, topRight = null, bottomLeft = null, bottomRight = null;
            let minTLDist = Infinity, minTRDist = Infinity, minBLDist = Infinity, minBRDist = Infinity;
            
            for (const cell of activeCellsList) {
                // ì™¼ìª½ ìƒë‹¨ê¹Œì§€ì˜ ê±°ë¦¬
                const tlDist = Math.sqrt(cell.x * cell.x + cell.y * cell.y);
                // ì˜¤ë¥¸ìª½ ìƒë‹¨ê¹Œì§€ì˜ ê±°ë¦¬
                const trDist = Math.sqrt((game.size.width - 1 - cell.x) * (game.size.width - 1 - cell.x) + cell.y * cell.y);
                // ì™¼ìª½ í•˜ë‹¨ê¹Œì§€ì˜ ê±°ë¦¬
                const blDist = Math.sqrt(cell.x * cell.x + (game.size.height - 1 - cell.y) * (game.size.height - 1 - cell.y));
                // ì˜¤ë¥¸ìª½ í•˜ë‹¨ê¹Œì§€ì˜ ê±°ë¦¬
                const brDist = Math.sqrt((game.size.width - 1 - cell.x) * (game.size.width - 1 - cell.x) + (game.size.height - 1 - cell.y) * (game.size.height - 1 - cell.y));
                
                if (tlDist < minTLDist) {
                    minTLDist = tlDist;
                    topLeft = cell;
                }
                if (trDist < minTRDist) {
                    minTRDist = trDist;
                    topRight = cell;
                }
                if (blDist < minBLDist) {
                    minBLDist = blDist;
                    bottomLeft = cell;
                }
                if (brDist < minBRDist) {
                    minBRDist = brDist;
                    bottomRight = cell;
                }
            }
            
            // Xì í˜•íƒœë¡œ ë°°ì¹˜ (ë¯¸êµ­ê³¼ ì¤‘êµ­ì´ ëŒ€ê°ì„ ìœ¼ë¡œ ë§ˆì£¼ë³´ê²Œ)
            if (topLeft && bottomRight && topRight && bottomLeft) {
                game.board[topLeft.y][topLeft.x] = players[0];
                game.board[bottomRight.y][bottomRight.x] = players[0];
                game.visitedCells[topLeft.y][topLeft.x] = true;
                game.visitedCells[bottomRight.y][bottomRight.x] = true;
                
                game.board[topRight.y][topRight.x] = players[1];
                game.board[bottomLeft.y][bottomLeft.x] = players[1];
                game.visitedCells[topRight.y][topRight.x] = true;
                game.visitedCells[bottomLeft.y][bottomLeft.x] = true;
                
                // ì ìˆ˜ ì´ˆê¸°í™” (ê° 2ê°œì”©)
                players.forEach(player => {
                    game.scores[player] = 2;
                });
            } else {
                // ì˜ˆìƒì¹˜ ëª»í•œ ìƒí™©ì— ëŒ€ë¹„í•œ ê¸°ë³¸ ë°°ì¹˜
                const centerX = Math.floor(game.size.width / 2);
                const centerY = Math.floor(game.size.height / 2);
                
                game.board[centerY-1][centerX-1] = players[0];
                game.board[centerY+1][centerX+1] = players[0];
                game.visitedCells[centerY-1][centerX-1] = true;
                game.visitedCells[centerY+1][centerX+1] = true;
                
                game.board[centerY-1][centerX+1] = players[1];
                game.board[centerY+1][centerX-1] = players[1];
                game.visitedCells[centerY-1][centerX+1] = true;
                game.visitedCells[centerY+1][centerX-1] = true;
                
                // ì ìˆ˜ ì´ˆê¸°í™” (ê° 2ê°œì”©)
                players.forEach(player => {
                    game.scores[player] = 2;
                });
            }
        }

        // í™œì„± ì…€ì˜ ê°€ì¥ìë¦¬ ì°¾ê¸°
        function findActiveCellsEdges() {
            const edges = [];
            
            // ëª¨ë“  í™œì„± ì…€ ì¤‘ì—ì„œ ê°€ì¥ìë¦¬ì— ìˆëŠ” ì…€ ì°¾ê¸°
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    if (game.activeCells[y][x]) {
                        // ê°€ì¥ìë¦¬ ì²´í¬: ìƒí•˜ì¢Œìš° ì¤‘ í•˜ë‚˜ë¼ë„ ë¹„í™œì„± ì…€ì´ ìˆê±°ë‚˜ ë³´ë“œ ë°–ì´ë©´ ê°€ì¥ìë¦¬
                        const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
                        let isEdge = false;
                        
                        for (const [dx, dy] of directions) {
                            const nx = x + dx;
                            const ny = y + dy;
                            
                            if (nx < 0 || ny < 0 || nx >= game.size.width || ny >= game.size.height || 
                                !game.activeCells[ny][nx]) {
                                isEdge = true;
                                break;
                            }
                        }
                        
                        if (isEdge) {
                            edges.push({x, y});
                        }
                    }
                }
            }
            
            return edges;
        }

        // ëœë¤ ë²½ ë°°ì¹˜
        function placeRandomWalls(count) {
            let wallsPlaced = 0;
            let attempts = 0;
            const maxAttempts = 100; // ë¬´í•œ ë£¨í”„ ë°©ì§€
            
            while (wallsPlaced < count && attempts < maxAttempts) {
                attempts++;
                const x = Math.floor(Math.random() * game.size.width);
                const y = Math.floor(Math.random() * game.size.height);
                
                // ì´ˆê¸° ìœ„ì¹˜ë‚˜ ì´ë¯¸ ë²½ì´ ìˆëŠ” ê³³, ë¹„í™œì„± ì…€ì€ ì œì™¸
                if (!game.activeCells[y][x] || game.visitedCells[y][x]) {
                    continue;
                }
                
                // ë²½ ë°°ì¹˜
                game.board[y][x] = 'wall';
                game.visitedCells[y][x] = true; // ë²½ë„ ë°©ë¬¸í•œ ì…€ë¡œ í‘œì‹œ
                wallsPlaced++;
            }
        }

        // ë³´ë“œ ë Œë”ë§
        function renderBoard() {
            boardEl.innerHTML = '';
            const config = mapConfigs[game.mapType];
            
            // ë³´ë“œ ìŠ¤íƒ€ì¼ ì„¤ì •
            boardEl.style.gridTemplateColumns = `repeat(${config.width}, ${config.cellSize}px)`;
            boardEl.style.gridTemplateRows = `repeat(${config.height}, ${config.cellSize}px)`;
            
           for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    const cell = document.createElement('div');
                    
                    // ì…€ ìŠ¤íƒ€ì¼ ì„¤ì •
                    cell.style.width = `${config.cellSize}px`;
                    cell.style.height = `${config.cellSize}px`;
                    
                    // í™œì„± ì…€ì¸ì§€ í™•ì¸
                    if (!game.activeCells[y][x]) {
                        cell.className = 'hidden-cell';
                        boardEl.appendChild(cell);
                        continue;
                    }
                    
                    cell.className = 'cell';
                    
                    const value = game.board[y][x];
                    if (value && value !== 'wall') {
                        cell.classList.add(value); // í”Œë ˆì´ì–´ í´ë˜ìŠ¤ ì¶”ê°€
                    } else if (value === 'wall') {
                        cell.classList.add('wall');
                    } else if (game.visitedCells[y][x]) {
                        // ë¹ˆ ì…€ì´ì§€ë§Œ ë°©ë¬¸í•œ ê²½ìš°
                        cell.classList.add('visited');
                    }
                    
                    // ë§ˆì§€ë§‰ ì´ë™ ìœ„ì¹˜ í‘œì‹œ
                    if (x === game.lastMove.x && y === game.lastMove.y) {
                        cell.classList.add('lastMove');
                    }
                    
                    cell.addEventListener('click', () => handleCellClick(x, y));
                    boardEl.appendChild(cell);
                }
            }
        }

        // ê²Œì„ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateInfo() {
            // í˜„ì¬ í”Œë ˆì´ì–´ ì •ë³´ ì—…ë°ì´íŠ¸
            turnInfoEl.textContent = `${playerInfo[game.currentPlayer].displayName}ì˜ í„´`;
            
            // ì ìˆ˜ ì •ë³´ ì—…ë°ì´íŠ¸
            updateScoresDisplay();
            
            // í„´ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            turnCounterEl.textContent = `í„´: ${game.turnCount}/${game.maxTurns}`;

            // í”Œë ˆì´ì–´ ìˆœì„œ ì •ë³´ ì—…ë°ì´íŠ¸
            updatePlayerOrderDisplay();
        }
        
        // í”Œë ˆì´ì–´ ìˆœì„œ í‘œì‹œ í•¨ìˆ˜ ì¶”ê°€
        function updatePlayerOrderDisplay() {
            if (!playerOrderDisplayEl) return;
            
            let orderText = 'ê²Œì„ ìˆœì„œ: ';
            game.playerOrder.forEach((player, index) => {
                orderText += playerInfo[player].displayName;
                if (index < game.playerOrder.length - 1) {
                    orderText += ' â†’ ';
                }
            });
            playerOrderDisplayEl.textContent = orderText;
        }
        
        // ì ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateScoresDisplay() {
            scoresDisplayEl.innerHTML = '';
            
            // ì ìˆ˜ ì•„ì´í…œ ìƒì„± ë° í‘œì‹œ
            for (const player of game.playerOrder) {
                const scoreItem = document.createElement('div');
                scoreItem.className = `score-item ${player}-score`;
                scoreItem.textContent = `${playerInfo[player].displayName}: ${game.scores[player]}`;
                scoresDisplayEl.appendChild(scoreItem);
            }
        }

        // ì…€ í´ë¦­ ì²˜ë¦¬ (ìˆ˜ì •ë¨)
        function handleCellClick(x, y) {
            if (game.isGameOver || game.currentPlayer !== game.humanPlayer) {
                return;
            }
            
            // ì´ë¯¸ ë°©ë¬¸í•œ ì…€ì¸ì§€ í™•ì¸
            if (game.visitedCells[y][x]) {
                messageEl.textContent = 'ì´ë¯¸ ë°©ë¬¸í•œ ê³³ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ê³³ì„ ì„ íƒí•˜ì„¸ìš”.';
                return;
            }
            
            const value = game.board[y][x];
            
            // ë²½ì´ë‚˜ ìê¸° ì˜ì—­ì€ ì„ íƒ ë¶ˆê°€
            if (value === 'wall' || value === game.currentPlayer) {
                return;
            }
            
            // ì¸ì ‘í•œ ì…€ í™•ì¸
            if (!hasAdjacentCell(x, y, game.currentPlayer)) {
                messageEl.textContent = 'ì¸ì ‘í•œ ì¹¸ì—ë§Œ ë†“ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                return;
            }
            
            // ë¹ˆ ì…€ì´ë‚˜ ìƒëŒ€ë°© ì˜ì—­ ì ë ¹
            if (value === '' || game.playerOrder.includes(value)) {
                // ìƒëŒ€ë°© ì˜ì—­ì´ë©´ ì ìˆ˜ ì¡°ì •
                if (value && value !== game.currentPlayer) {
                    game.scores[value]--;
                }
                
                // ì„ íƒí•œ ì…€ ì ë ¹
                game.board[y][x] = game.currentPlayer;
                game.scores[game.currentPlayer]++;
                
                // ë°©ë¬¸í•œ ì…€ë¡œ í‘œì‹œ
                game.visitedCells[y][x] = true;
                
                // ì„¸ê· ì „ ë°©ì‹ìœ¼ë¡œ ì£¼ë³€ ìƒëŒ€ë°© ì…€ í¡ìˆ˜
                const capturedCells = absorbAdjacentCells(x, y);
                
                // ë§ˆì§€ë§‰ ì´ë™ ìœ„ì¹˜ ê¸°ë¡
                game.lastMove = { x, y };
                
                // ì´ë™ ê¸°ë¡ ì¶”ê°€
                game.moveHistory.push({ x, y, player: game.currentPlayer });
                
                if (capturedCells > 0) {
                    messageEl.textContent = `${capturedCells}ê°œì˜ ìƒëŒ€ë°© ë§ì„ í¡ìˆ˜í–ˆìŠµë‹ˆë‹¤!`;
                } else {
                    messageEl.textContent = '';
                }
                
                // UI ì—…ë°ì´íŠ¸ë¥¼ ë¨¼ì € ìˆ˜í–‰í•˜ê³  ì§€ì—° í›„ ê²Œì„ ìƒíƒœ í™•ì¸
                renderBoard();
                updateInfo();
                
                // ì•½ê°„ì˜ ì§€ì—° í›„ í„´ ì¢…ë£Œ ì²˜ë¦¬
                setTimeout(() => {
                    // ì ìˆ˜ ì¬ê³„ì‚°
                    recalculateScores();
                    
                    // ê²Œì„ ì¢…ë£Œ í™•ì¸ (ìë™ ì¢…ë£Œ ì•ˆí•¨)
                    endTurn(); // í„´ ì¢…ë£Œ ì²˜ë¦¬
                }, 100);
            }
        }

        // ì¸ì ‘í•œ ì…€ í™•ì¸
        function hasAdjacentCell(x, y, player) {
            // ìƒí•˜ì¢Œìš° 4ë°©í–¥ í™•ì¸
            const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]];
            
            for (const [dx, dy] of directions) {
                const nx = x + dx;
                const ny = y + dy;
                
                if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                    if (game.board[ny][nx] === player) {
                        return true;
                    }
                }
            }
            
            return false;
        }

        // ì£¼ë³€ ìƒëŒ€ë°© ì…€ ê°œìˆ˜ ì„¸ê¸°
        function countAdjacentOpponentCells(x, y, player = game.currentPlayer) {
            const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]]; // ìƒí•˜ì¢Œìš° 4ë°©í–¥
            let count = 0;
            
            for (const [dx, dy] of directions) {
                const nx = x + dx;
                const ny = y + dy;
                
                // ë²”ìœ„ í™•ì¸
                if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                    // ìƒëŒ€ë°© ì…€ë§Œ ì¹´ìš´íŠ¸
                    const cellValue = game.board[ny][nx];
                    if (cellValue && cellValue !== player && cellValue !== 'wall') {
                        count++;
                    }
                }
            }
            
            return count;
        }

        // ì£¼ë³€ ìƒëŒ€ë°© ì…€ í¡ìˆ˜ (ì„¸ê· ì „ ë°©ì‹ - ì ‘ì´‰í•˜ë©´ í¡ìˆ˜)
        function absorbAdjacentCells(x, y) {
            const player = game.currentPlayer;
            const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]]; // ìƒí•˜ì¢Œìš° 4ë°©í–¥
            let capturedCells = 0;
            
            for (const [dx, dy] of directions) {
                const nx = x + dx;
                const ny = y + dy;
                
                // ë²”ìœ„ í™•ì¸
                if (nx >= 0 && nx < game.size.width && ny >= 0 && ny < game.size.height) {
                    // ìƒëŒ€ë°© ì…€ë§Œ ë³€ê²½
                    const opponent = game.board[ny][nx];
                    if (opponent && opponent !== player && opponent !== 'wall') {
                        game.board[ny][nx] = player;
                        game.scores[player]++;
                        game.scores[opponent]--;
                        capturedCells++;
                    }
                }
            }
            
            return capturedCells;
        }

        // í„´ ì¢…ë£Œ
        function endTurn() {
            // ì ìˆ˜ë¥¼ ì¬ê³„ì‚°
            recalculateScores();
            
            // ê²Œì„ ì¢…ë£Œ ì¡°ê±´ ì²´í¬
            if (checkGameOver()) {
                return;
            }
            
            // ë‹¤ìŒ í”Œë ˆì´ì–´ë¡œ ë³€ê²½
            changeToNextPlayer();
            
            // UI ì—…ë°ì´íŠ¸
            renderBoard();
            updateInfo();
            
            // í˜„ì¬ í”Œë ˆì´ì–´ê°€ ì´ë™í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸
            const currentPlayerCanMove = hasValidMove(game.currentPlayer);
            
            // í˜„ì¬ í”Œë ˆì´ì–´ê°€ ì´ë™í•  ìˆ˜ ì—†ìœ¼ë©´ ë‹¤ìŒ í”Œë ˆì´ì–´ë¡œ
            if (!currentPlayerCanMove) {
                // ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì´ë™í•  ìˆ˜ ì—†ìœ¼ë©´ ê²Œì„ ì¢…ë£Œ
                if (allPlayersStuck()) {
                    messageEl.textContent = 'ëª¨ë“  ì´ë™ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤...';
                    setTimeout(gameOver, 1000);
                    return;
                }
                
                messageEl.textContent = 'ì´ë™í•  ê³³ì´ ì—†ìŠµë‹ˆë‹¤. í„´ì„ ë„˜ê¹ë‹ˆë‹¤.';
                endTurn(); // ë‹¤ìŒ í„´ìœ¼ë¡œ
                return;
            }
            
            // ì»´í“¨í„° ì°¨ë¡€ì¼ ê²½ìš°
            if (game.computerPlayers.includes(game.currentPlayer)) {
                setTimeout(computerTurn, 1000);
            }
        }

        // ë‹¤ìŒ í”Œë ˆì´ì–´ë¡œ ë³€ê²½
        function changeToNextPlayer() {
            // í˜„ì¬ í”Œë ˆì´ì–´ì˜ ì¸ë±ìŠ¤ ì°¾ê¸°
            const currentIndex = game.playerOrder.indexOf(game.currentPlayer);
            
            // ë‹¤ìŒ í”Œë ˆì´ì–´ ê²°ì •
            const nextIndex = (currentIndex + 1) % game.playerOrder.length;
            game.currentPlayer = game.playerOrder[nextIndex];
            
            // í„´ ìˆ˜ ì¦ê°€ (ì²« ë²ˆì§¸ í”Œë ˆì´ì–´ ì°¨ë¡€ê°€ ë˜ë©´)
            if (nextIndex === 0) {
                game.turnCount++;
            }
        }

        // ëª¨ë“  í”Œë ˆì´ì–´ê°€ ë” ì´ë™í•  ìˆ˜ ì—†ëŠ”ì§€ í™•ì¸
        function allPlayersStuck() {
            // ë¹ˆ ì…€ì´ ìˆëŠ”ì§€ ë¨¼ì € í™•ì¸
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // í™œì„± ì…€ì´ë©´ì„œ ì•„ì§ ë°©ë¬¸í•˜ì§€ ì•Šì€ ê²½ìš°(ë¹ˆ ì…€)ê°€ ìˆë‹¤ë©´
                    if (game.activeCells[y][x] && !game.visitedCells[y][x]) {
                        // ì–´ë–¤ í”Œë ˆì´ì–´ë“  ì´ ì…€ì— ë†“ì„ ìˆ˜ ìˆëŠ”ì§€ í™•ì¸
                        for (const player of game.playerOrder) {
                            if (game.scores[player] > 0 && hasAdjacentCell(x, y, player)) {
                                return false; // ì ì–´ë„ í•œ í”Œë ˆì´ì–´ëŠ” ì´ë™í•  ìˆ˜ ìˆìŒ
                            }
                        }
                    }
                }
            }
            
            // ëª¨ë“  ë¹ˆ ì…€ì„ ê²€ì‚¬í–ˆëŠ”ë° ì•„ë¬´ë„ ë†“ì„ ìˆ˜ ì—†ìœ¼ë©´ true
            return true;
        }

        // ì´ë™ ê°€ëŠ¥í•œ ìœ„ì¹˜ê°€ ìˆëŠ”ì§€ í™•ì¸
        function hasValidMove(player) {
            // ì ìˆ˜ê°€ 0ì´ë©´ ì´ë™ ë¶ˆê°€
            if (game.scores[player] === 0) {
                return false;
            }
            
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // ë°©ë¬¸í•˜ì§€ ì•Šì€ ì…€ì´ê³ , ë¹ˆ ì…€ì´ê±°ë‚˜ ë‹¤ë¥¸ í”Œë ˆì´ì–´ ì˜ì—­ì¸ ê²½ìš°
                    if (game.activeCells[y][x] && !game.visitedCells[y][x] && 
                        (game.board[y][x] === '' || 
                        (game.board[y][x] !== player && game.board[y][x] !== 'wall')) && 
                        hasAdjacentCell(x, y, player)) {
                        return true;
                    }
                }
            }
            return false;
        }

        // ê²Œì„ ì¢…ë£Œ ì¡°ê±´ í™•ì¸ (ìˆ˜ì •ë¨)
        function checkGameOver() {
            // ìµœëŒ€ í„´ì— ë„ë‹¬í–ˆëŠ”ì§€ í™•ì¸
            if (game.turnCount > game.maxTurns) {
                gameOver();
                return true;
            }
            
            // í”Œë ˆì´ì–´ê°€ í•œ ëª…ë§Œ ë‚¨ì•˜ëŠ”ì§€ í™•ì¸
            let activePlayers = 0;
            for (const player of game.playerOrder) {
                if (game.scores[player] > 0) {
                    activePlayers++;
                }
            }
            
            if (activePlayers <= 1) {
                gameOver();
                return true;
            }
            
            // ë³´ë“œê°€ ì™„ì „íˆ ê°€ë“ ì°¼ëŠ”ì§€ í™•ì¸
            // ë¹ˆ ì…€ì´ ìˆëŠ”ì§€ í™•ì¸
            let hasEmptyCell = false;
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // í™œì„± ì…€ì´ë©´ì„œ ì•„ì§ ë°©ë¬¸í•˜ì§€ ì•Šì€ ê²½ìš°ê°€ ìˆë‹¤ë©´ ë³´ë“œê°€ ê°€ë“ ì°¨ì§€ ì•ŠìŒ
                    if (game.activeCells[y][x] && !game.visitedCells[y][x]) {
                        hasEmptyCell = true;
                        break;
                    }
                }
                if (hasEmptyCell) break;
            }
            
            // ë¹ˆ ì…€ì´ ì—†ì„ ë•Œë§Œ ê²Œì„ ì¢…ë£Œ
            if (!hasEmptyCell) {
                gameOver();
                return true;
            }
            
            // ëª¨ë“  í”Œë ˆì´ì–´ê°€ ë” ì´ìƒ ì´ë™í•  ìˆ˜ ì—†ëŠ” ìƒíƒœì¸ì§€ í™•ì¸
            if (allPlayersStuck()) {
                gameOver();
                return true;
            }
            
            return false;
        }

        // ë³´ë“œê°€ ê°€ë“ ì°¼ëŠ”ì§€ í™•ì¸
        function isBoardFull() {
            for (let y = 0; y < game.size.height; y++) {
                for (let x = 0; x < game.size.width; x++) {
                    // í™œì„± ì…€ì´ë©´ì„œ ì•„ì§ ë°©ë¬¸í•˜ì§€ ì•Šì€ ê²½ìš°ê°€ ìˆë‹¤ë©´ ë³´ë“œê°€ ê°€ë“ ì°¨ì§€ ì•ŠìŒ
                    if (game.activeCells[y][x] && !game.visitedCells[y][x]) {
                       return false; // ì•„ì§ ë°©ë¬¸í•˜ì§€ ì•Šì€ í™œì„± ì…€ì´ ìˆìŒ
                   }
               }
           }
           return true; // ëª¨ë“  í™œì„± ì…€ì´ ë°©ë¬¸ë¨
       }

       // ì ìˆ˜ ì¬ê³„ì‚°
       function recalculateScores() {
           const scores = {};
           
           // ëª¨ë“  í”Œë ˆì´ì–´ì˜ ì ìˆ˜ ì´ˆê¸°í™”
           game.playerOrder.forEach(player => {
               scores[player] = 0;
           });
           
           // ë³´ë“œë¥¼ ê²€ì‚¬í•˜ì—¬ ì ìˆ˜ ê³„ì‚°
           for (let y = 0; y < game.size.height; y++) {
               for (let x = 0; x < game.size.width; x++) {
                   const cell = game.board[y][x];
                   if (game.playerOrder.includes(cell)) {
                       scores[cell]++;
                   }
               }
           }
           
           game.scores = scores;
       }

       // ê²Œì„ ì¢…ë£Œ
       function gameOver() {
           game.isGameOver = true;
           
           // ìµœì¢… ì ìˆ˜ ì¬ê³„ì‚°
           recalculateScores();
           
           // ìŠ¹ì í™•ì¸
           const winningSortedPlayers = [...game.playerOrder].sort((a, b) => 
               game.scores[b] - game.scores[a]);
           
           const winner = winningSortedPlayers[0];
           const isMultiWinner = winningSortedPlayers.length > 1 && 
               game.scores[winningSortedPlayers[0]] === game.scores[winningSortedPlayers[1]];
           
           // ê²Œì„ ì¢…ë£Œ ì´ìœ  íŒŒì•…
           let reason = "";
           if (game.turnCount >= game.maxTurns) {
               reason = `${game.maxTurns}í„´ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. `;
           } else if (isBoardFull()) {
               reason = "ëª¨ë“  ì…€ì´ ì ë ¹ë˜ì—ˆìŠµë‹ˆë‹¤. ";
           } else {
               // ì œê±°ëœ í”Œë ˆì´ì–´ í™•ì¸
               for (const player of game.playerOrder) {
                   if (game.scores[player] <= 0) {
                       const playerName = playerInfo[player].displayName;
                       reason += `${playerName}ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. `;
                   }
               }
           }
           
           // ê²°ê³¼ í‘œì‹œ
           if (isMultiWinner) {
               resultTitleEl.textContent = 'ë¬´ìŠ¹ë¶€!';
           } else {
               resultTitleEl.textContent = `${playerInfo[winner].displayName} ìŠ¹ë¦¬!`;
           }
           
           // ìµœì¢… ì ìˆ˜ ë¬¸ìì—´ ìƒì„±
           let scoreText = 'ìµœì¢… ì ìˆ˜ - ';
           for (const player of game.playerOrder) {
               scoreText += `${playerInfo[player].displayName}: ${game.scores[player]} `;
           }
           
           resultDescEl.textContent = `${reason}${scoreText}`;
           resultModalEl.style.display = 'flex';
       }

       // ì»´í“¨í„° í„´
       function computerTurn() {
           if (game.isGameOver || !game.computerPlayers.includes(game.currentPlayer)) {
               return;
           }
           
           // ê°€ëŠ¥í•œ ì´ë™ ì°¾ê¸°
           const validMoves = findValidMoves(game.currentPlayer);
           
           if (validMoves.length > 0) {
               // ì ìˆ˜ ê¸°ì¤€ ì •ë ¬
               validMoves.sort((a, b) => b.score - a.score);
               
               // ìµœê³  ì ìˆ˜ ì´ë™ ì„ íƒ (ì „ëµì  ëœë¤ì„± ì¶”ê°€)
               let selectedIndex = 0;
               
               // ëœë¤ ìš”ì†Œ ì ìš©
               if (Math.random() < 0.3 + (game.turnCount / 50)) {
                   // í„´ì´ ì§„í–‰ë ìˆ˜ë¡ ëœë¤ì„± ì¦ê°€
                   const randomFactor = Math.min(0.5, 0.3 + (game.turnCount / 50));
                   
                   if (Math.random() < randomFactor && validMoves.length > 1) {
                       // ê°€ë”ì€ ìµœê³  ì ìˆ˜ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì´ë™ ì„ íƒ
                       selectedIndex = Math.floor(Math.random() * Math.min(validMoves.length, 3));
                   }
               }
               
               const move = validMoves[selectedIndex];
               
               // ìƒëŒ€ë°© ì˜ì—­ì´ë©´ ì ìˆ˜ ì¡°ì •
               const opponent = game.board[move.y][move.x];
               if (opponent && opponent !== game.currentPlayer) {
                   game.scores[opponent]--;
               }
               
               // ì´ë™ ì‹¤í–‰
               game.board[move.y][move.x] = game.currentPlayer;
               game.scores[game.currentPlayer]++;
               
               // ë°©ë¬¸í•œ ì…€ë¡œ í‘œì‹œ
               game.visitedCells[move.y][move.x] = true;
               
               // ë§ˆì§€ë§‰ ì´ë™ ìœ„ì¹˜ ê¸°ë¡
               game.lastMove = { x: move.x, y: move.y };
               
               // ì´ë™ ê¸°ë¡ ì¶”ê°€
               game.moveHistory.push({ x: move.x, y: move.y, player: game.currentPlayer });
               
               // ì£¼ë³€ ìƒëŒ€ë°© ì…€ í¡ìˆ˜
               const capturedCells = absorbAdjacentCells(move.x, move.y);
               
               if (capturedCells > 0) {
                   messageEl.textContent = `ì»´í“¨í„°(${playerInfo[game.currentPlayer].displayName})ê°€ ${capturedCells}ê°œì˜ ë§ì„ í¡ìˆ˜í–ˆìŠµë‹ˆë‹¤!`;
               } else {
                   messageEl.textContent = `ì»´í“¨í„°(${playerInfo[game.currentPlayer].displayName})ê°€ ì´ë™í–ˆìŠµë‹ˆë‹¤`;
               }
               
               endTurn();
           } else {
               messageEl.textContent = `ì»´í“¨í„°(${playerInfo[game.currentPlayer].displayName})ê°€ ì´ë™í•  ê³³ì´ ì—†ìŠµë‹ˆë‹¤`;
               endTurn();
           }
       }

       // ìœ íš¨í•œ ì´ë™ ëª©ë¡ ì°¾ê¸°
       function findValidMoves(player) {
           const validMoves = [];
           
           for (let y = 0; y < game.size.height; y++) {
               for (let x = 0; x < game.size.width; x++) {
                   // ë°©ë¬¸í•˜ì§€ ì•Šì€ ì…€ì´ê³ , ë¹ˆ ì¹¸ì´ë‚˜ ìƒëŒ€ ì˜ì—­ì¸ ê²½ìš°
                   if (game.activeCells[y][x] && !game.visitedCells[y][x] && 
                       (game.board[y][x] === '' || 
                        (game.board[y][x] !== player && game.board[y][x] !== 'wall')) && 
                       hasAdjacentCell(x, y, player)) {
                       
                       // ì ìˆ˜ ê³„ì‚°: ì–¼ë§ˆë‚˜ ë§ì€ ìƒëŒ€ ì…€ì„ í¡ìˆ˜í•  ìˆ˜ ìˆëŠ”ì§€
                       let absorptionScore = countAdjacentOpponentCells(x, y, player);
                       
                       // ê¸°ë³¸ ì ìˆ˜ + í¡ìˆ˜ ì ìˆ˜
                       let score = 1 + absorptionScore;
                       
                       // ìƒëŒ€ë°© ì˜ì—­ì´ë©´ ì¶”ê°€ ì ìˆ˜
                       if (game.board[y][x] && game.board[y][x] !== player) {
                           score += 1;
                       }

                       // ì „ëµì  ì ìˆ˜ ì¡°ì •
                       // 1. ì½”ë„ˆë‚˜ ê°€ì¥ìë¦¬ëŠ” ê°€ì¹˜ê°€ ë†’ìŒ
                       if ((x === 0 || x === game.size.width-1) && (y === 0 || y === game.size.height-1)) {
                           // ì½”ë„ˆ
                           score += 3;
                       } else if (x === 0 || x === game.size.width-1 || y === 0 || y === game.size.height-1) {
                           // ê°€ì¥ìë¦¬
                           score += 1;
                       }
                       
                       // 2. ê²Œì„ ì§„í–‰ ìƒí™©ì— ë”°ë¥¸ ì „ëµ ë³€ê²½
                       if (game.turnCount > 10) {
                           // ê²Œì„ í›„ë°˜ì—ëŠ” ë” ê³µê²©ì ìœ¼ë¡œ
                           
                           // ì ìˆ˜ê°€ ê°€ì¥ ë†’ì€ í”Œë ˆì´ì–´ ì°¾ê¸°
                           const maxScore = Math.max(...Object.values(game.scores));
                           const topPlayers = game.playerOrder.filter(p => game.scores[p] === maxScore);
                           
                           if (game.scores[player] < maxScore) {
                               // ì§€ê³  ìˆì„ ë•ŒëŠ” ë” ìœ„í—˜í•œ ì´ë™ë„ ê°ìˆ˜
                               score += absorptionScore; // í¡ìˆ˜ ì ìˆ˜ ë‘ ë°°ë¡œ
                               
                               // 1ë“± í”Œë ˆì´ì–´ë¥¼ ê³µê²©í•  ê¸°íšŒê°€ ìˆìœ¼ë©´ ì¶”ê°€ ì ìˆ˜
                               if (game.board[y][x] && topPlayers.includes(game.board[y][x])) {
                                   score += 5;
                               }
                           } else if (topPlayers.includes(player)) {
                               // 1ë“±ì¼ ë•ŒëŠ” ë°©ì–´ì ìœ¼ë¡œ
                               score += 2; // ì•ˆì „í•œ ì´ë™ì— ê°€ì¤‘ì¹˜
                           }
                       }
                       
                       // ë‹¤ì¤‘ ëª¨ë“œì—ì„œì˜ ì¶”ê°€ ì „ëµ
                       if (game.gameMode === 'multi') {
                           // ì•½í•œ í”Œë ˆì´ì–´ ê³µëµ
                           const weakPlayers = game.playerOrder.filter(p => 
                               p !== player && game.scores[p] > 0 && game.scores[p] < game.scores[player] / 2);
                           
                           if (game.board[y][x] && weakPlayers.includes(game.board[y][x])) {
                               score += 3; // ì•½í•œ í”Œë ˆì´ì–´ ê³µëµì— ì¶”ê°€ ì ìˆ˜
                           }
                       }
                       
                       validMoves.push({x, y, score});
                   }
               }
           }
           
           return validMoves;
       }

    // ì¤‘êµ­ êµ­ê¸° ìŠ¤íƒ€ì¼ ìˆ˜ì • - ë³„ì´ ì œëŒ€ë¡œ ë³´ì´ë„ë¡ ìˆ˜ì •
        const chinaStyleFix = `
        .china {
            background-color: #de2910 !important;
            position: relative !important;
            border-radius: 4px !important;
        }
        .china::after {
            content: "â˜…" !important;
            position: absolute !important;
            color: #ffde00 !important;
            font-size: 24px !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 100 !important;
        }
        `;

        const usaStyleFix = `
        .usa {
            background-color: #3c3b6e !important;
            border-radius: 50% !important;
            position: relative !important;
        }
        .usa::after {
            content: "USA" !important;
            position: absolute !important;
            color: white !important;
            font-size: 12px !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 100 !important;
        }
        `;
        
        const rowStyleFix = `
        .row {
            background-color: #607D8B !important;
            position: relative !important;
            border-radius: 5px !important;
        }
        .row::after {
            content: "ğŸŒ" !important;
            position: absolute !important;
            font-size: 20px !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 100 !important;
        }
        `;
        // ìŠ¤íƒ€ì¼ ì ìš© í•¨ìˆ˜ ìˆ˜ì •
        function fixStyles() {
            const styleEl = document.createElement('style');
            styleEl.textContent = chinaStyleFix + usaStyleFix + rowStyleFix;
            document.head.appendChild(styleEl);
        }

        // ì¦‰ì‹œ ìŠ¤íƒ€ì¼ ì ìš©
        fixStyles();

        // ê²Œì„ ì´ˆê¸°í™” ì‹œ ìŠ¤íƒ€ì¼ ìˆ˜ì • í•¨ìˆ˜ í˜¸ì¶œ
        const originalInitGame = initGame;
        initGame = function() {
            originalInitGame.apply(this, arguments);
            fixStyles(); // ìŠ¤íƒ€ì¼ ìˆ˜ì • ì ìš©
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œë„ ì ìš©
        document.addEventListener('DOMContentLoaded', () => {
            fixStyles();
            showModeModal();
        });
</script>
</body>
